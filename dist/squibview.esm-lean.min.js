import e from"tiny-emitter";import t from"diff-match-patch";import n from"markdown-it";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,f(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=v(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function l(e,t,n){return(t=f(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(){h=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof y?t:y,a=Object.create(o.prototype),s=new M(r||[]);return i(a,"_invoke",{value:_(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",f="suspendedYield",v="executing",g="completed",m={};function y(){}function b(){}function w(){}var x={};l(x,a,(function(){return this}));var k=Object.getPrototypeOf,S=k&&k(k(O([])));S&&S!==n&&r.call(S,a)&&(x=S);var C=w.prototype=y.prototype=Object.create(x);function T(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,o,a,s){var c=d(e[i],e,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function _(t,n,r){var i=p;return function(o,a){if(i===v)throw Error("Generator is already running");if(i===g){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=L(s,r);if(c){if(c===m)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=v;var l=d(t,n,r);if("normal"===l.type){if(i=r.done?g:f,l.arg===m)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=g,r.method="throw",r.arg=l.arg)}}}function L(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,L(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=d(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return b.prototype=w,i(C,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=l(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,l(e,c,"GeneratorFunction")),e.prototype=Object.create(C),e},t.awrap=function(e){return{__await:e}},T(E.prototype),l(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new E(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(C),l(C,c,"Generator"),l(C,a,(function(){return this})),l(C,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function v(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function g(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var c,l,u=this._events[s],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,o),!0;case 6:return u.fn.call(u.context,t,r,i,o,a),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,i);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var c=0,l=[],u=s.length;c<u;c++)(s[c].fn!==t||i&&!s[c].once||r&&s[c].context!==r)&&l.push(s[c]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}({exports:{}});var m={exports:{}},y=g(m.exports=function e(){var t,n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},r=!n.document&&!!n.postMessage,i=n.IS_PAPA_WORKER||!1,o={},a=0,s={};function c(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=b(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new p(t),(this._handle.streamer=this)._config=t}.call(this,e),this.parseChunk=function(e,t){var r=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<r){let t=this._config.newline;t||(o=this._config.quoteChar||'"',t=this._handle.guessLineEndings(e,o)),e=[...e.split(t).slice(r)].join(t)}this.isFirstChunk&&x(this._config.beforeFirstChunk)&&void 0!==(o=this._config.beforeFirstChunk(e))&&(e=o),this.isFirstChunk=!1,this._halted=!1,r=this._partialLine+e;var o=(this._partialLine="",this._handle.parse(r,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(e=o.meta.cursor,this._finished||(this._partialLine=r.substring(e-this._baseIndex),this._baseIndex=e),o&&o.data&&(this._rowCount+=o.data.length),r=this._finished||this._config.preview&&this._rowCount>=this._config.preview,i)n.postMessage({results:o,workerId:s.WORKER_ID,finished:r});else if(x(this._config.chunk)&&!t){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=o=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),this._completed||!r||!x(this._config.complete)||o&&o.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),r||o&&o.meta.paused||this._nextChunk(),o}this._halted=!0},this._sendError=function(e){x(this._config.error)?this._config.error(e):i&&this._config.error&&n.postMessage({workerId:s.WORKER_ID,error:e,finished:!1})}}function l(e){var t;(e=e||{}).chunkSize||(e.chunkSize=s.RemoteChunkSize),c.call(this,e),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),r||(t.onload=w(this._chunkLoaded,this),t.onerror=w(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var e,n=this._config.downloadRequestHeaders;for(e in n)t.setRequestHeader(e,n[e])}var i;this._config.chunkSize&&(i=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+i));try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}r&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(e=>null!==(e=e.getResponseHeader("Content-Range"))?parseInt(e.substring(e.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){e=t.statusText||e,this._sendError(new Error(e))}}function u(e){(e=e||{}).chunkSize||(e.chunkSize=s.LocalChunkSize),c.call(this,e);var t,n,r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=w(this._chunkLoaded,this),t.onerror=w(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input,i=(this._config.chunkSize&&(i=Math.min(this._start+this._config.chunkSize,this._input.size),e=n.call(e,this._start,i)),t.readAsText(e,this._config.encoding));r||this._chunkLoaded({target:{result:i}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function d(e){var t;c.call(this,e=e||{}),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){var e,n;if(!this._finished)return e=this._config.chunkSize,t=e?(n=t.substring(0,e),t.substring(e)):(n=t,""),this._finished=!t,this.parseChunk(n)}}function h(e){c.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=w((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=w((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=w((function(){this._streamCleanUp(),r=!0,this._streamData("")}),this),this._streamCleanUp=w((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function p(e){var t,n,r,i,o=Math.pow(2,53),a=-o,c=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,l=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,u=this,d=0,h=0,p=!1,g=!1,m=[],y={data:[],errors:[],meta:{}};function w(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function k(){if(y&&r&&(C("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+s.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines&&(y.data=y.data.filter((function(e){return!w(e)}))),S()){if(y)if(Array.isArray(y.data[0])){for(var t=0;S()&&t<y.data.length;t++)y.data[t].forEach(u);y.data.splice(0,1)}else y.data.forEach(u);function u(t,n){x(e.transformHeader)&&(t=e.transformHeader(t,n)),m.push(t)}}function n(t,n){for(var r=e.header?{}:[],i=0;i<t.length;i++){var s=i,u=t[i];u=((t,n)=>(t=>(e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)))(t)?"true"===n||"TRUE"===n||"false"!==n&&"FALSE"!==n&&((e=>{if(c.test(e)&&(e=parseFloat(e),a<e&&e<o))return 1})(n)?parseFloat(n):l.test(n)?new Date(n):""===n?null:n):n)(s=e.header?i>=m.length?"__parsed_extra":m[i]:s,u=e.transform?e.transform(u,s):u),"__parsed_extra"===s?(r[s]=r[s]||[],r[s].push(u)):r[s]=u}return e.header&&(i>m.length?C("FieldMismatch","TooManyFields","Too many fields: expected "+m.length+" fields but parsed "+i,h+n):i<m.length&&C("FieldMismatch","TooFewFields","Too few fields: expected "+m.length+" fields but parsed "+i,h+n)),r}var i;y&&(e.header||e.dynamicTyping||e.transform)&&(i=1,!y.data.length||Array.isArray(y.data[0])?(y.data=y.data.map(n),i=y.data.length):y.data=n(y.data,0),e.header&&y.meta&&(y.meta.fields=m),h+=i)}function S(){return e.header&&0===m.length}function C(e,t,n,r){e={type:e,code:t,message:n},void 0!==r&&(e.row=r),y.errors.push(e)}x(e.step)&&(i=e.step,e.step=function(t){y=t,S()?k():(k(),0!==y.data.length&&(d+=t.data.length,e.preview&&d>e.preview?n.abort():(y.data=y.data[0],i(y,u))))}),this.parse=function(i,o,a){var c=e.quoteChar||'"';return e.newline||(e.newline=this.guessLineEndings(i,c)),r=!1,e.delimiter?x(e.delimiter)&&(e.delimiter=e.delimiter(i),y.meta.delimiter=e.delimiter):((c=((t,n,r,i,o)=>{var a,c,l,u;o=o||[",","\t","|",";",s.RECORD_SEP,s.UNIT_SEP];for(var d=0;d<o.length;d++){for(var h,p=o[d],f=0,g=0,m=0,y=(l=void 0,new v({comments:i,delimiter:p,newline:n,preview:10}).parse(t)),b=0;b<y.data.length;b++)r&&w(y.data[b])?m++:(g+=h=y.data[b].length,void 0===l?l=h:0<h&&(f+=Math.abs(h-l),l=h));0<y.data.length&&(g/=y.data.length-m),(void 0===c||f<=c)&&(void 0===u||u<g)&&1.99<g&&(c=f,a=p,u=g)}return{successful:!!(e.delimiter=a),bestDelimiter:a}})(i,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=c.bestDelimiter:(r=!0,e.delimiter=s.DefaultDelimiter),y.meta.delimiter=e.delimiter),c=b(e),e.preview&&e.header&&c.preview++,t=i,n=new v(c),y=n.parse(t,o,a),k(),p?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return p},this.pause=function(){p=!0,n.abort(),t=x(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){u.streamer._halted?(p=!1,u.streamer.parseChunk(t,!0)):setTimeout(u.resume,3)},this.aborted=function(){return g},this.abort=function(){g=!0,n.abort(),y.meta.aborted=!0,x(e.complete)&&e.complete(y),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576),t=new RegExp(f(t)+"([^]*?)"+f(t),"gm");var n=(e=e.replace(t,"")).split("\r");if(e=1<(t=e.split("\n")).length&&t[0].length<n[0].length,1===n.length||e)return"\n";for(var r=0,i=0;i<n.length;i++)"\n"===n[i][0]&&r++;return r>=n.length/2?"\r\n":"\r"}}function f(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function v(e){var t=(e=e||{}).delimiter,n=e.newline,r=e.comments,i=e.step,o=e.preview,a=e.fastMode,c=null,l=!1,u=null==e.quoteChar?'"':e.quoteChar,d=u;if(void 0!==e.escapeChar&&(d=e.escapeChar),("string"!=typeof t||-1<s.BAD_DELIMITERS.indexOf(t))&&(t=","),r===t)throw new Error("Comment character same as delimiter");!0===r?r="#":("string"!=typeof r||-1<s.BAD_DELIMITERS.indexOf(r))&&(r=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var h=0,p=!1;this.parse=function(s,v,g){if("string"!=typeof s)throw new Error("Input must be a string");var m=s.length,y=t.length,b=n.length,w=r.length,k=x(i),S=[],C=[],T=[],E=h=0;if(!s)return q();if(a||!1!==a&&-1===s.indexOf(u)){for(var _=s.split(n),L=0;L<_.length;L++){if(T=_[L],h+=T.length,L!==_.length-1)h+=n.length;else if(g)return q();if(!r||T.substring(0,w)!==r){if(k){if(S=[],I(T.split(t)),F(),p)return q()}else I(T.split(t));if(o&&o<=L)return S=S.slice(0,o),q(!0)}}return q()}for(var R=s.indexOf(t,h),A=s.indexOf(n,h),M=new RegExp(f(d)+f(u),"g"),O=s.indexOf(u,h);;)if(s[h]===u)for(O=h,h++;;){if(-1===(O=s.indexOf(u,O+1)))return g||C.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:S.length,index:h}),H();if(O===m-1)return H(s.substring(h,O).replace(M,u));if(u===d&&s[O+1]===d)O++;else if(u===d||0===O||s[O-1]!==d){-1!==R&&R<O+1&&(R=s.indexOf(t,O+1));var N=j(-1===(A=-1!==A&&A<O+1?s.indexOf(n,O+1):A)?R:Math.min(R,A));if(s.substr(O+1+N,y)===t){T.push(s.substring(h,O).replace(M,u)),s[h=O+1+N+y]!==u&&(O=s.indexOf(u,h)),R=s.indexOf(t,h),A=s.indexOf(n,h);break}if(N=j(A),s.substring(O+1+N,O+1+N+b)===n){if(T.push(s.substring(h,O).replace(M,u)),D(O+1+N+b),R=s.indexOf(t,h),O=s.indexOf(u,h),k&&(F(),p))return q();if(o&&S.length>=o)return q(!0);break}C.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:S.length,index:h}),O++}}else if(r&&0===T.length&&s.substring(h,h+w)===r){if(-1===A)return q();h=A+b,A=s.indexOf(n,h),R=s.indexOf(t,h)}else if(-1!==R&&(R<A||-1===A))T.push(s.substring(h,R)),h=R+y,R=s.indexOf(t,h);else{if(-1===A)break;if(T.push(s.substring(h,A)),D(A+b),k&&(F(),p))return q();if(o&&S.length>=o)return q(!0)}return H();function I(e){S.push(e),E=h}function j(e){var t=0;return-1!==e&&(e=s.substring(O+1,e))&&""===e.trim()?e.length:t}function H(e){return g||(void 0===e&&(e=s.substring(h)),T.push(e),h=m,I(T),k&&F()),q()}function D(e){h=e,I(T),T=[],A=s.indexOf(n,h)}function q(r){if(e.header&&!v&&S.length&&!l){var i=S[0],o={},a=new Set(i);let t=!1;for(let n=0;n<i.length;n++){let r=i[n];if(o[r=x(e.transformHeader)?e.transformHeader(r,n):r]){let e,s=o[r];for(;e=r+"_"+s,s++,a.has(e););a.add(e),i[n]=e,o[r]++,t=!0,(c=null===c?{}:c)[e]=r}else o[r]=1,i[n]=r;a.add(r)}t&&console.warn("Duplicate headers found and renamed."),l=!0}return{data:S,errors:C,meta:{delimiter:t,linebreak:n,aborted:p,truncated:!!r,cursor:E+(v||0),renamedHeaders:c}}}function F(){i(q()),S=[],C=[]}},this.abort=function(){p=!0},this.getCharIndex=function(){return h}}function g(e){var t=e.data,n=o[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var i={abort:function(){r=!0,m(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:y,resume:y};if(x(n.userStep)){for(var a=0;a<t.results.data.length&&(n.userStep({data:t.results.data[a],errors:t.results.errors,meta:t.results.meta},i),!r);a++);delete t.results}else x(n.userChunk)&&(n.userChunk(t.results,i,t.file),delete t.results)}t.finished&&!r&&m(t.workerId,t.results)}function m(e,t){var n=o[e];x(n.userComplete)&&n.userComplete(t),n.terminate(),delete o[e]}function y(){throw new Error("Not implemented.")}function b(e){if("object"!=typeof e||null===e)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=b(e[t]);return n}function w(e,t){return function(){e.apply(t,arguments)}}function x(e){return"function"==typeof e}return s.parse=function(t,r){var i=(r=r||{}).dynamicTyping||!1;if(x(i)&&(r.dynamicTypingFunction=i,i={}),r.dynamicTyping=i,r.transform=!!x(r.transform)&&r.transform,!r.worker||!s.WORKERS_SUPPORTED)return i=null,s.NODE_STREAM_INPUT,"string"==typeof t?(t=(e=>65279!==e.charCodeAt(0)?e:e.slice(1))(t),i=new(r.download?l:d)(r)):!0===t.readable&&x(t.read)&&x(t.on)?i=new h(r):(n.File&&t instanceof File||t instanceof Object)&&(i=new u(r)),i.stream(t);(i=(()=>{var t;return!!s.WORKERS_SUPPORTED&&(t=(()=>{var t=n.URL||n.webkitURL||null,r=e.toString();return s.BLOB_URL||(s.BLOB_URL=t.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",r,")();"],{type:"text/javascript"})))})(),(t=new n.Worker(t)).onmessage=g,t.id=a++,o[t.id]=t)})()).userStep=r.step,i.userChunk=r.chunk,i.userComplete=r.complete,i.userError=r.error,r.step=x(r.step),r.chunk=x(r.chunk),r.complete=x(r.complete),r.error=x(r.error),delete r.worker,i.postMessage({input:t,config:r,workerId:i.id})},s.unparse=function(e,t){var n=!1,r=!0,i=",",o="\r\n",a='"',c=a+a,l=!1,u=null,d=!1,h=((()=>{if("object"==typeof t){if("string"!=typeof t.delimiter||s.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(i=t.delimiter),"boolean"!=typeof t.quotes&&"function"!=typeof t.quotes&&!Array.isArray(t.quotes)||(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(l=t.skipEmptyLines),"string"==typeof t.newline&&(o=t.newline),"string"==typeof t.quoteChar&&(a=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");u=t.columns}void 0!==t.escapeChar&&(c=t.escapeChar+a),t.escapeFormulae instanceof RegExp?d=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(d=/^[=+\-@\t\r].*$/)}})(),new RegExp(f(a),"g"));if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,l);if("object"==typeof e[0])return p(u||Object.keys(e[0]),e,l)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||u),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"==typeof e.data[0]?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),p(e.fields||[],e.data||[],l);throw new Error("Unable to serialize unrecognized input");function p(e,t,n){var a="",s=("string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t)),Array.isArray(e)&&0<e.length),c=!Array.isArray(t[0]);if(s&&r){for(var l=0;l<e.length;l++)0<l&&(a+=i),a+=v(e[l],l);0<t.length&&(a+=o)}for(var u=0;u<t.length;u++){var d=(s?e:t[u]).length,h=!1,p=s?0===Object.keys(t[u]).length:0===t[u].length;if(n&&!s&&(h="greedy"===n?""===t[u].join("").trim():1===t[u].length&&0===t[u][0].length),"greedy"===n&&s){for(var f=[],g=0;g<d;g++){var m=c?e[g]:g;f.push(t[u][m])}h=""===f.join("").trim()}if(!h){for(var y=0;y<d;y++){0<y&&!p&&(a+=i);var b=s&&c?e[y]:y;a+=v(t[u][b],y)}u<t.length-1&&(!n||0<d&&!p)&&(a+=o)}}return a}function v(e,t){var r,o;return null==e?"":e.constructor===Date?JSON.stringify(e).slice(1,25):(o=!1,d&&"string"==typeof e&&d.test(e)&&(e="'"+e,o=!0),r=e.toString().replace(h,c),(o=o||!0===n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||((e,t)=>{for(var n=0;n<t.length;n++)if(-1<e.indexOf(t[n]))return!0;return!1})(r,s.BAD_DELIMITERS)||-1<r.indexOf(i)||" "===r.charAt(0)||" "===r.charAt(r.length-1))?a+r+a:r)}},s.RECORD_SEP=String.fromCharCode(30),s.UNIT_SEP=String.fromCharCode(31),s.BYTE_ORDER_MARK="\ufeff",s.BAD_DELIMITERS=["\r","\n",'"',s.BYTE_ORDER_MARK],s.WORKERS_SUPPORTED=!r&&!!n.Worker,s.NODE_STREAM_INPUT=1,s.LocalChunkSize=10485760,s.RemoteChunkSize=5242880,s.DefaultDelimiter=",",s.Parser=v,s.ParserHandle=p,s.NetworkStreamer=l,s.FileStreamer=u,s.StringStreamer=d,s.ReadableStreamStreamer=h,n.jQuery&&((t=n.jQuery).fn.parse=function(e){var r=e.config||{},i=[];return this.each((function(e){if("INPUT"!==t(this).prop("tagName").toUpperCase()||"file"!==t(this).attr("type").toLowerCase()||!n.FileReader||!this.files||0===this.files.length)return!0;for(var o=0;o<this.files.length;o++)i.push({file:this.files[o],inputElem:this,instanceConfig:t.extend({},r)})})),o(),this;function o(){if(0===i.length)x(e.complete)&&e.complete();else{var n,r,o,c,l=i[0];if(x(e.before)){var u=e.before(l.file,l.inputElem);if("object"==typeof u){if("abort"===u.action)return n="AbortError",r=l.file,o=l.inputElem,c=u.reason,void(x(e.error)&&e.error({name:n},r,o,c));if("skip"===u.action)return void a();"object"==typeof u.config&&(l.instanceConfig=t.extend(l.instanceConfig,u.config))}else if("skip"===u)return void a()}var d=l.instanceConfig.complete;l.instanceConfig.complete=function(e){x(d)&&d(e,l.file,l.inputElem),a()},s.parse(l.file,l.instanceConfig)}}function a(){i.splice(0,1),o()}}),i&&(n.onmessage=function(e){e=e.data,void 0===s.WORKER_ID&&e&&(s.WORKER_ID=e.workerId),"string"==typeof e.input?n.postMessage({workerId:s.WORKER_ID,results:s.parse(e.input,e.config),finished:!0}):(n.File&&e.input instanceof File||e.input instanceof Object)&&(e=s.parse(e.input,e.config))&&n.postMessage({workerId:s.WORKER_ID,results:e,finished:!0})}),(l.prototype=Object.create(c.prototype)).constructor=l,(u.prototype=Object.create(c.prototype)).constructor=u,(d.prototype=Object.create(d.prototype)).constructor=d,(h.prototype=Object.create(c.prototype)).constructor=h,s}());
/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/function b(e,t){return Array(t+1).join(e)}var w=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function x(e){return T(e,w)}var k=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function S(e){return T(e,k)}var C=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function T(e,t){return t.indexOf(e.nodeName)>=0}function E(e,t){return e.getElementsByTagName&&t.some((function(t){return e.getElementsByTagName(t).length}))}var _={};function R(e){return e?e.replace(/(\n+\s*)+/g,"\n"):""}function A(e){for(var t in this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[],e.rules)this.array.push(e.rules[t])}function M(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];if(O(i,t,n))return i}}function O(e,t,n){var r=e.filter;if("string"==typeof r){if(r===t.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(t.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof r)throw new TypeError("`filter` needs to be a string, array, or function");if(r.call(e,t,n))return!0}}function N(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function I(e,t,n){return e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}_.paragraph={filter:"p",replacement:function(e){return"\n\n"+e+"\n\n"}},_.lineBreak={filter:"br",replacement:function(e,t,n){return n.br+"\n"}},_.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,n){var r=Number(t.nodeName.charAt(1));return"setext"===n.headingStyle&&r<3?"\n\n"+e+"\n"+b(1===r?"=":"-",e.length)+"\n\n":"\n\n"+b("#",r)+" "+e+"\n\n"}},_.blockquote={filter:"blockquote",replacement:function(e){return"\n\n"+(e=(e=e.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"}},_.list={filter:["ul","ol"],replacement:function(e,t){var n=t.parentNode;return"LI"===n.nodeName&&n.lastElementChild===t?"\n"+e:"\n\n"+e+"\n\n"}},_.listItem={filter:"li",replacement:function(e,t,n){e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var r=n.bulletListMarker+"   ",i=t.parentNode;if("OL"===i.nodeName){var o=i.getAttribute("start"),a=Array.prototype.indexOf.call(i.children,t);r=(o?Number(o)+a:a+1)+".  "}return r+e+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}},_.indentedCodeBlock={filter:function(e,t){return"indented"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,n){return"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},_.fencedCodeBlock={filter:function(e,t){return"fenced"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,n){for(var r,i=((t.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],o=t.firstChild.textContent,a=n.fence.charAt(0),s=3,c=new RegExp("^"+a+"{3,}","gm");r=c.exec(o);)r[0].length>=s&&(s=r[0].length+1);var l=b(a,s);return"\n\n"+l+i+"\n"+o.replace(/\n$/,"")+"\n"+l+"\n\n"}},_.horizontalRule={filter:"hr",replacement:function(e,t,n){return"\n\n"+n.hr+"\n\n"}},_.inlineLink={filter:function(e,t){return"inlined"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t){var n=t.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var r=R(t.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+e+"]("+n+r+")"}},_.referenceLink={filter:function(e,t){return"referenced"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t,n){var r,i,o=t.getAttribute("href"),a=R(t.getAttribute("title"));switch(a&&(a=' "'+a+'"'),n.linkReferenceStyle){case"collapsed":r="["+e+"][]",i="["+e+"]: "+o+a;break;case"shortcut":r="["+e+"]",i="["+e+"]: "+o+a;break;default:var s=this.references.length+1;r="["+e+"]["+s+"]",i="["+s+"]: "+o+a}return this.references.push(i),r},references:[],append:function(e){var t="";return this.references.length&&(t="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),t}},_.emphasis={filter:["em","i"],replacement:function(e,t,n){return e.trim()?n.emDelimiter+e+n.emDelimiter:""}},_.strong={filter:["strong","b"],replacement:function(e,t,n){return e.trim()?n.strongDelimiter+e+n.strongDelimiter:""}},_.code={filter:function(e){var t=e.previousSibling||e.nextSibling,n="PRE"===e.parentNode.nodeName&&!t;return"CODE"===e.nodeName&&!n},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",n="`",r=e.match(/`+/gm)||[];-1!==r.indexOf(n);)n+="`";return n+t+e+t+n}},_.image={filter:"img",replacement:function(e,t){var n=R(t.getAttribute("alt")),r=t.getAttribute("src")||"",i=R(t.getAttribute("title"));return r?"!["+n+"]("+r+(i?' "'+i+'"':"")+")":""}},A.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){return e.isBlank?this.blankRule:(t=M(this.array,e,this.options))||(t=M(this._keep,e,this.options))||(t=M(this._remove,e,this.options))?t:this.defaultRule;var t},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};var j="undefined"!=typeof window?window:{};var H,D,q=function(){var e=j.DOMParser,t=!1;try{(new e).parseFromString("","text/html")&&(t=!0)}catch(e){}return t}()?j.DOMParser:(H=function(){},function(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch(t){j.ActiveXObject&&(e=!0)}return e}()?H.prototype.parseFromString=function(e){var t=new window.ActiveXObject("htmlfile");return t.designMode="on",t.open(),t.write(e),t.close(),t}:H.prototype.parseFromString=function(e){var t=document.implementation.createHTMLDocument("");return t.open(),t.write(e),t.close(),t},H);function F(e,t){var n;"string"==typeof e?n=(D=D||new q).parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html").getElementById("turndown-root"):n=e.cloneNode(!0);return function(e){var t=e.element,n=e.isBlock,r=e.isVoid,i=e.isPre||function(e){return"PRE"===e.nodeName};if(t.firstChild&&!i(t)){for(var o=null,a=!1,s=null,c=I(s,t,i);c!==t;){if(3===c.nodeType||4===c.nodeType){var l=c.data.replace(/[ \r\n\t]+/g," ");if(o&&!/ $/.test(o.data)||a||" "!==l[0]||(l=l.substr(1)),!l){c=N(c);continue}c.data=l,o=c}else{if(1!==c.nodeType){c=N(c);continue}n(c)||"BR"===c.nodeName?(o&&(o.data=o.data.replace(/ $/,"")),o=null,a=!1):r(c)||i(c)?(o=null,a=!0):o&&(a=!1)}var u=I(s,c,i);s=c,c=u}o&&(o.data=o.data.replace(/ $/,""),o.data||N(o))}}({element:n,isBlock:x,isVoid:S,isPre:t.preformattedCode?B:null}),n}function B(e){return"PRE"===e.nodeName||"CODE"===e.nodeName}function P(e,t){return e.isBlock=x(e),e.isCode="CODE"===e.nodeName||e.parentNode.isCode,e.isBlank=function(e){return!S(e)&&!function(e){return T(e,C)}(e)&&/^\s*$/i.test(e.textContent)&&!function(e){return E(e,k)}(e)&&!function(e){return E(e,C)}(e)}(e),e.flankingWhitespace=function(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var n=(r=e.textContent,i=r.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/),{leading:i[1],leadingAscii:i[2],leadingNonAscii:i[3],trailing:i[4],trailingNonAscii:i[5],trailingAscii:i[6]});var r,i;n.leadingAscii&&z("left",e,t)&&(n.leading=n.leadingNonAscii);n.trailingAscii&&z("right",e,t)&&(n.trailing=n.trailingNonAscii);return{leading:n.leading,trailing:n.trailing}}(e,t),e}function z(e,t,n){var r,i,o;return"left"===e?(r=t.previousSibling,i=/ $/):(r=t.nextSibling,i=/^ /),r&&(3===r.nodeType?o=i.test(r.nodeValue):n.preformattedCode&&"CODE"===r.nodeName?o=!1:1!==r.nodeType||x(r)||(o=i.test(r.textContent))),o}var V=Array.prototype.reduce,U=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function G(e){if(!(this instanceof G))return new G(e);var t={rules:_,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(e,t){return t.isBlock?"\n\n":""},keepReplacement:function(e,t){return t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML},defaultReplacement:function(e,t){return t.isBlock?"\n\n"+e+"\n\n":e}};this.options=function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}({},t,e),this.rules=new A(this.options)}function J(e){var t=this;return V.call(e.childNodes,(function(e,n){var r="";return 3===(n=new P(n,t.options)).nodeType?r=n.isCode?n.nodeValue:t.escape(n.nodeValue):1===n.nodeType&&(r=W.call(t,n)),K(e,r)}),"")}function $(e){var t=this;return this.rules.forEach((function(n){"function"==typeof n.append&&(e=K(e,n.append(t.options)))})),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function W(e){var t=this.rules.forNode(e),n=J.call(this,e),r=e.flankingWhitespace;return(r.leading||r.trailing)&&(n=n.trim()),r.leading+t.replacement(n,e,this.options)+r.trailing}function K(e,t){var n=function(e){for(var t=e.length;t>0&&"\n"===e[t-1];)t--;return e.substring(0,t)}(e),r=t.replace(/^\n*/,""),i=Math.max(e.length-n.length,t.length-r.length);return n+"\n\n".substring(0,i)+r}G.prototype={turndown:function(e){if(!function(e){return null!=e&&("string"==typeof e||e.nodeType&&(1===e.nodeType||9===e.nodeType||11===e.nodeType))}(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(""===e)return"";var t=J.call(this,new F(e,this.options));return $.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else{if("function"!=typeof e)throw new TypeError("plugin must be a Function or an Array of Functions");e(this)}return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return U.reduce((function(e,t){return e.replace(t[0],t[1])}),e)}};var Y=function(){return s((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.turndownService=new G(d({headingStyle:"atx",codeBlockStyle:"fenced",emDelimiter:"*",bulletListMarker:"-"},t)),this.cache=new Map,this.cacheSize=t.cacheSize||10,this._specialBlocks=new Map,this.configureTurndownRules()}),[{key:"configureTurndownRules",value:function(){var e=this;this.turndownService.addRule("squibviewFencedBlock",{filter:function(e){return"DIV"===e.nodeName&&e.hasAttribute("data-source-type")},replacement:function(t,n,r){var i=n.getAttribute("data-source-type")||"code",o="";switch(i){case"mermaid":case"math":var a=n.innerHTML;a=a.replace(/<br\s*\/?>/gi,"\n");var s=n.ownerDocument.createElement("div");s.innerHTML=a,o=s.textContent||s.innerText||"";break;case"geojson":case"topojson":case"stl":n.hasAttribute("data-original-source")?o=n.getAttribute("data-original-source"):n.textContent&&n.textContent.trim()?o=n.textContent:(console.warn("[HtmlToMarkdown] Missing original data for",i,"block"),o="Error: Original data lost during rendering");break;case"svg":o=n.hasAttribute("data-original-source")?n.getAttribute("data-original-source"):n.innerHTML;break;case"csv":case"tsv":case"psv":var c=n.querySelector("table");c?o=e._htmlTableToDelimitedText(c,i):(o="Error: Table not found for "+i,console.warn('Could not find table inside div[data-source-type="'+i+'"]'));break;default:var l=n.querySelector("pre");if(l)o=(l.querySelector("code")||l).textContent;else o=n.textContent,console.warn('Could not find <pre> inside div[data-source-type="'+i+'"]')}var u="code"===i?"":i,d=o.trim();return"\n```"+u+(d=d?"\n"+d+"\n":"\n")+"```\n"}}),this.turndownService.addRule("keepImageTags",{filter:"img",replacement:function(e,t){return t.outerHTML}}),this.turndownService.addRule("mermaid",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("mermaid")},replacement:function(t,n){var r="mermaid_"+Math.random().toString(36).substring(2,10);return e._specialBlocks&&e._specialBlocks.set(r,{type:"mermaid",content:n.textContent}),'\n<div data-special-block="'.concat(r,'" class="mermaid">\n')+n.textContent+"\n</div>\n"}}),this.turndownService.addRule("geojson",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("geojson-map")},replacement:function(t,n){var r="geojson_"+Math.random().toString(36).substring(2,10),i="";try{i=n.dataset.geojson||'{"type":"FeatureCollection","features":[]}'}catch(e){console.error("Error extracting GeoJSON data:",e)}return e._specialBlocks&&e._specialBlocks.set(r,{type:"geojson",content:i}),'\n<div data-special-block="'.concat(r,'" class="geojson-container">\n')+i+"\n</div>\n"}}),this.turndownService.addRule("math",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("math-display")},replacement:function(t,n){var r="math_"+Math.random().toString(36).substring(2,10),i=n.textContent;return i=i.replace(/^\$\$([\s\S]*)\$\$$/,"$1"),e._specialBlocks&&e._specialBlocks.set(r,{type:"math",content:i}),'\n<div data-special-block="'.concat(r,'" class="math-container">\n')+i+"\n</div>\n"}}),this.turndownService.addRule("codeBlock",{filter:function(e){return"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t){var n=t.firstChild.textContent,r="";if(t.firstChild.className){var i=t.firstChild.className.match(/language-(\w+)/);i&&(r=i[1])}return"\n```"+r+"\n"+n.trim()+"\n```\n"}}),this.turndownService.addRule("tableCell",{filter:["th","td"],replacement:function(e,t){return" "+e.trim()+" |"}}),this.turndownService.addRule("tableRow",{filter:"tr",replacement:function(e,t){if("THEAD"===t.parentNode.nodeName){var n=t.querySelectorAll("th, td").length;return"|"+e+("\n|"+" --- |".repeat(n))}return"|"+e+"\n"}}),this.turndownService.addRule("table",{filter:"table",replacement:function(t,n){if(n.parentElement&&n.parentElement.hasAttribute("data-source-type")){var r=n.parentElement.getAttribute("data-source-type");if("csv"===r||"tsv"===r||"psv"===r)return t}var i="",o=n.querySelector("thead tr");return o&&(i+="|",o.querySelectorAll("th").forEach((function(t){i+=" ".concat(e.turndownService.turndown(t.innerHTML).trim()," |")})),i+="\n|",o.querySelectorAll("th").forEach((function(){i+=" --- |"})),i+="\n"),n.querySelectorAll("tbody tr").forEach((function(t){i+="|",t.querySelectorAll("td").forEach((function(t){i+=" ".concat(e.turndownService.turndown(t.innerHTML).trim()," |")})),i+="\n"})),"\n"+i+"\n"}}),this.turndownService.keep(["li"]),this.turndownService.addRule("taskListItems",{filter:function(e){return"LI"===e.nodeName&&e.firstChild&&"INPUT"===e.firstChild.nodeName&&"checkbox"===e.firstChild.type},replacement:function(e,t){for(var n=t.firstChild,r=n.checked,i="",o=n.nextSibling;o;)i+=o.outerHTML||o.textContent,o=o.nextSibling;return(r?"[x] ":"[ ] ")+this.turndownService.turndown(i).trim()}})}},{key:"_getStringHash",value:function(e){for(var t=0,n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t.toString(36)}},{key:"convert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._specialBlocks.clear(),this._placeholders=[];var n=this._getStringHash(e);if(this.cache.has(n))return this.cache.get(n);var r=this._preProcessSpecialContainers(e),i=this.turndownService.turndown(r);if(i=this._postProcessMarkdown(i,t.originalSource),this.cache.set(n,i),this.cache.size>this.cacheSize){var o=this.cache.keys().next().value;this.cache.delete(o)}return i}},{key:"_preProcessSpecialContainers",value:function(e){var t,n=this;if("undefined"==typeof document||!document.createElement)return console.warn("Document not available, skipping pre-processing"),this._placeholders=[],e;try{if((t=document.createElement("div")).innerHTML=e,"function"!=typeof t.querySelector)throw new Error("querySelector not available")}catch(t){return console.warn("DOM methods not available, using regex fallback for pre-processing"),this._regexFallbackPreProcess(e)}var r=t.querySelectorAll("div[data-source-type]"),i=[];return r.forEach((function(e,t){var r,o=e.getAttribute("data-source-type"),a="__SPECIAL_CONTAINER_".concat(t,"__");if("svg"===o&&e.hasAttribute("data-original-source"))r=e.getAttribute("data-original-source");else if(["mermaid","math","geojson","topojson","stl"].includes(o)&&e.hasAttribute("data-original-source"))r=e.getAttribute("data-original-source");else if("csv"===o||"tsv"===o||"psv"===o){var s=e.querySelector("table");r=s?n._htmlTableToDelimitedText(s,o):"Error: Table not found for "+o}else{var c=e.querySelector("pre");if(c)r=(c.querySelector("code")||c).textContent.replace(/^[\r\n]+|[\r\n]+$/g,"");else r=e.textContent.replace(/^[\r\n]+|[\r\n]+$/g,"")}i.push({placeholder:a,type:o,content:r});var l=document.createTextNode(a);e.parentNode&&e.parentNode.replaceChild(l,e)})),this._placeholders=i,t.innerHTML}},{key:"_postProcessMarkdown",value:function(e,t){this._placeholders&&this._placeholders.length>0&&this._placeholders.forEach((function(t){var n=t.placeholder,r=t.type,i="code"===r?"":r,o=t.content.replace(/^[\r\n]+|[\r\n]+$/g,""),a="```".concat(i,"\n").concat(o,"\n```"),s=n,c=s.replace(/_/g,"\\_");e.includes(s)?e=e.replace(s,a):e.includes(c)&&(e=e.replace(c,a))}));e=(e=e.replace(/<div data-special-block="mermaid_[^"]*" class="mermaid">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```mermaid\n".concat(t.trim(),"\n```\n")}))).replace(/<div data-special-block="svg_[^"]*" class="svg-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){var n=t.match(/<svg[\s\S]*?<\/svg>/);return n?"\n```svg\n".concat(n[0],"\n```\n"):e}));if(e=(e=e.replace(/<div data-special-block="geojson_[^"]*" class="geojson-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){try{return JSON.parse(t),"\n```geojson\n".concat(t.trim(),"\n```\n")}catch(e){return console.error("Invalid GeoJSON data:",e),'\n```geojson\n{"type":"FeatureCollection","features":[]}\n```\n'}}))).replace(/<div data-special-block="math_[^"]*" class="math-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```math\n".concat(t.trim(),"\n```\n")})),t){for(var n,r=/```(\w+)\s*([\s\S]*?)```/g,i=0,o=[];null!==(n=r.exec(t));){var a=n[1];n[2],"mermaid"!==a&&"svg"!==a&&"geojson"!==a&&"topojson"!==a&&"stl"!==a&&"math"!==a||o.push({type:a,content:n[0],index:i++})}var s=0,c=0,l=0,u=0;e=e.replace(/```mermaid\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"mermaid"===e.type}));return s<n.length?n[s++].content:e})),e=e.replace(/```svg\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"svg"===e.type}));return c<n.length?n[c++].content:e})),e=e.replace(/```geojson\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"geojson"===e.type}));return l<n.length?n[l++].content:e}));var d=0;e=e.replace(/```topojson\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"topojson"===e.type}));return d<n.length?n[d++].content:e}));var h=0;e=e.replace(/```stl\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"stl"===e.type}));return h<n.length?n[h++].content:e})),e=e.replace(/```math\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"math"===e.type}));return u<n.length?n[u++].content:e}))}return e}},{key:"_htmlTableToDelimitedText",value:function(e,t){var n;switch(t){case"csv":default:n=",";break;case"tsv":n="\t";break;case"psv":n="|"}var r=[];if(!e||"function"!=typeof e.querySelectorAll)return console.warn("DOM methods not available for table extraction, using regex fallback"),this._extractTableDataFromHtml(e?e.outerHTML||e.innerHTML||String(e):"",t);var i=e.querySelectorAll("tr");return i&&"function"==typeof i.forEach?(i.forEach((function(e){var t=[];e.querySelectorAll("th, td").forEach((function(e){var r=e.textContent||"";r=r.replace(/\r?\n|\r/g," ").trim(),","===n&&r.includes(",")&&(r='"'.concat(r.replace(/"/g,'""'),'"')),t.push(r)})),r.push(t.join(n))})),r.join("\n")):(console.warn("querySelectorAll did not return proper NodeList, falling back to regex"),this._extractTableDataFromHtml(e.outerHTML||e.innerHTML||String(e),t))}},{key:"_extractTableDataFromHtml",value:function(e,t){var n;switch(t){case"csv":default:n=",";break;case"tsv":n="\t";break;case"psv":n="|"}try{for(var r,i=/<tr[^>]*>([\s\S]*?)<\/tr>/gi,o=[];null!==(r=i.exec(e));){for(var a=r[1],s=/<(?:th|td)[^>]*>([\s\S]*?)<\/(?:th|td)>/gi,c=[],l=void 0;null!==(l=s.exec(a));){var u=l[1];u=u.replace(/<[^>]*>/g,"").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/\r?\n|\r/g," ").trim(),","===n&&u.includes(",")&&(u='"'.concat(u.replace(/"/g,'""'),'"')),c.push(u)}c.length>0&&o.push(c.join(n))}return o.join("\n")}catch(e){return console.error("Error extracting table data from HTML:",e),"Error: Could not extract table data"}}},{key:"_regexFallbackPreProcess",value:function(e){var t=this,n=[],r=0,i=e.replace(/<div[^>]*data-source-type="([^"]*)"[^>]*>([\s\S]*?)<\/div>/g,(function(e,i,o){var a,s="__SPECIAL_CONTAINER_".concat(r,"__");if("svg"===i){var c=e.match(/data-original-source="([^"]*)"/);if(c)a=c[1].replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");else{var l=o.match(/<svg[\s\S]*?<\/svg>/);a=l?l[0]:o}}else if("csv"===i||"tsv"===i||"psv"===i)a=t._extractTableDataFromHtml(o,i);else{var u=o.match(/<pre[^>]*><code[^>]*>([\s\S]*?)<\/code><\/pre>/);a=u?u[1].replace(/<span[^>]*>/g,"").replace(/<\/span>/g,"").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):o.replace(/<[^>]*>/g,"").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}return n.push({placeholder:s,type:i,content:a}),r++,"<p>".concat(s,"</p>")}));return this._placeholders=n,i}}])}(),Q=Object.freeze({__proto__:null,default:Y}),X=function(){return s((function e(){a(this,e),this.initialContent="",this.initialContentType="",this.contentType="",this.diffs=[],this.currentIndex=-1,this.diffEngine=new t}),[{key:"initialize",value:function(e,t){this.initialContent=e,this.initialContentType=t,this.contentType=t,this.diffs=[],this.currentIndex=-1}},{key:"addRevision",value:function(e,t){var n=this.getCurrentContent(),r=this.diffEngine.diff_main(n,e);this.diffEngine.diff_cleanupSemantic(r);var i=this.diffEngine.patch_toText(this.diffEngine.patch_make(n,r));this.currentIndex<this.diffs.length-1&&(this.diffs=this.diffs.slice(0,this.currentIndex+1)),this.diffs.push({diff:i,contentType:t!==this.contentType?t:void 0}),t!==this.contentType&&(this.contentType=t),this.currentIndex=this.diffs.length-1}},{key:"undo",value:function(){return this.currentIndex>=0?(this.currentIndex--,{content:this.getCurrentContent(),contentType:this.getCurrentContentType()}):null}},{key:"redo",value:function(){return this.currentIndex<this.diffs.length-1?(this.currentIndex++,{content:this.getCurrentContent(),contentType:this.getCurrentContentType()}):null}},{key:"getCurrentContent",value:function(){if(this.currentIndex<0)return this.initialContent;for(var e=this.initialContent,t=0;t<=this.currentIndex;t++){var n=this.diffEngine.patch_fromText(this.diffs[t].diff);e=p(this.diffEngine.patch_apply(n,e),1)[0]}return e}},{key:"getCurrentContentType",value:function(){if(this.currentIndex<0)return this.initialContentType;for(var e=this.initialContentType,t=0;t<=this.currentIndex;t++)void 0!==this.diffs[t].contentType&&(e=this.diffs[t].contentType);return e}},{key:"setRevision",value:function(e){return e>=-1&&e<this.diffs.length?(this.currentIndex=e,{content:this.getCurrentContent(),contentType:this.getCurrentContentType()}):null}},{key:"getRevisionCount",value:function(){return this.diffs.length}},{key:"getCurrentIndex",value:function(){return this.currentIndex}},{key:"getContentAtRevision",value:function(e){if(e<-1||e>=this.diffs.length)throw new Error("Invalid revision index: ".concat(e,". Valid range: -1 to ").concat(this.diffs.length-1));if(-1===e)return{content:this.initialContent,contentType:this.initialContentType};for(var t=this.initialContent,n=0;n<=e;n++){var r=this.diffEngine.patch_fromText(this.diffs[n].diff);t=p(this.diffEngine.patch_apply(r,t),1)[0]}for(var i=this.initialContentType,o=0;o<=e;o++)void 0!==this.diffs[o].contentType&&(i=this.diffs[o].contentType);return{content:t,contentType:i}}},{key:"computeDiff",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e&&(e=this.currentIndex-1),null===t&&(t=this.currentIndex),e<-1||e>=this.diffs.length)throw new Error("Invalid fromIndex: ".concat(e,". Valid range: -1 to ").concat(this.diffs.length-1));if(t<-1||t>=this.diffs.length)throw new Error("Invalid toIndex: ".concat(t,". Valid range: -1 to ").concat(this.diffs.length-1));if(e>t)throw new Error("fromIndex (".concat(e,") cannot be greater than toIndex (").concat(t,")"));var n=this.getContentAtRevision(e).content,r=this.getContentAtRevision(t).content,i=this.diffEngine.diff_main(n,r);return this.diffEngine.diff_cleanupSemantic(i),i}},{key:"computeLineDiff",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e&&(e=this.currentIndex-1),null===n&&(n=this.currentIndex),e<-1||e>=this.diffs.length)throw new Error("Invalid fromIndex: ".concat(e,". Valid range: -1 to ").concat(this.diffs.length-1));if(n<-1||n>=this.diffs.length)throw new Error("Invalid toIndex: ".concat(n,". Valid range: -1 to ").concat(this.diffs.length-1));if(e>n)throw new Error("fromIndex (".concat(e,") cannot be greater than toIndex (").concat(n,")"));var r=this.getContentAtRevision(e).content,i=this.getContentAtRevision(n).content;r.split("\n"),i.split("\n");var o=this.diffEngine.diff_linesToChars_(r,i),a=this.diffEngine.diff_main(o.chars1,o.chars2,!1);this.diffEngine.diff_charsToLines_(a,o.lineArray);var s,l=[],u=1,d=1,h=c(a);try{for(h.s();!(s=h.n()).done;){var f,v=p(s.value,2),g=v[0],m=v[1].split("\n").filter((function(e,t,n){return t<n.length-1||""!==e})),y=c(m);try{for(y.s();!(f=y.n()).done;){var b=f.value;g===t.DIFF_EQUAL?(l.push({type:"unchanged",content:b,oldLineNum:u,newLineNum:d}),u++,d++):g===t.DIFF_DELETE?(l.push({type:"removed",content:b,oldLineNum:u,newLineNum:null}),u++):g===t.DIFF_INSERT&&(l.push({type:"added",content:b,oldLineNum:null,newLineNum:d}),d++)}}catch(e){y.e(e)}finally{y.f()}}}catch(e){h.e(e)}finally{h.f()}return l}},{key:"getDiffStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e&&(e=this.currentIndex-1),null===t&&(t=this.currentIndex),e<-1||e>=this.diffs.length)throw new Error("Invalid fromIndex: ".concat(e,". Valid range: -1 to ").concat(this.diffs.length-1));if(t<-1||t>=this.diffs.length)throw new Error("Invalid toIndex: ".concat(t,". Valid range: -1 to ").concat(this.diffs.length-1));if(e>t)throw new Error("fromIndex (".concat(e,") cannot be greater than toIndex (").concat(t,")"));for(var n=this.computeLineDiff(e,t),r={additions:0,deletions:0,modifications:0,totalChanges:0},i=0;i<n.length;i++){var o=n[i];"added"===o.type?(r.additions++,r.totalChanges++):"removed"===o.type&&(r.deletions++,r.totalChanges++,i+1<n.length&&"added"===n[i+1].type&&(r.modifications++,r.totalChanges--))}return r}},{key:"getRevisionInfo",value:function(e){if(e<-1||e>=this.diffs.length)throw new Error("Invalid revision index: ".concat(e,". Valid range: -1 to ").concat(this.diffs.length-1));var t=this.getContentAtRevision(e),n=t.content,r={index:e,contentType:t.contentType,contentSize:n.length,lineCount:n.split("\n").length,isCurrent:e===this.currentIndex};if(e>=0){r.diffSize=this.diffs[e].diff.length,r.hasContentTypeChange=void 0!==this.diffs[e].contentType;var i=this.getDiffStats(e-1,e);r.changeStats=i}else r.diffSize=0,r.hasContentTypeChange=!1,r.changeStats={additions:0,deletions:0,modifications:0,totalChanges:0};return r}}])}();function Z(){try{if("undefined"!=typeof window&&window.hljs)return window.hljs;if("undefined"!=typeof global&&global.hljs)return global.hljs}catch(e){}return null}var ee=function(){return s((function t(n){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a(this,t),l(this,"updateLineNumbersDebounced",this.debounce((function(){requestAnimationFrame((function(){return r.updateLineNumbers()}))}),100)),this.options=d(d({},t.defaultOptions),i),this.container="string"==typeof n?document.querySelector(n):n,!this.container)throw new Error("Container element not found");this.events=new e,this.revisionManager=new X,this.lastSelectionData=null,this._onTextReplacementHandler=null,this.renderers={},this._initializeHtmlToMarkdown(),this.initializeLibraries(),this.registerDefaultRenderers(),this.createStructure(),this.initializeEventHandlers(),this.initializeResizeObserver(),this.options.showLineNumbers&&this.initializeLineNumbers(),this.options.initialContent?(this.revisionManager.initialize(this.options.initialContent,this.options.inputContentType),this.setContent(this.options.initialContent,this.options.inputContentType,!1)):this.revisionManager.initialize("",this.options.inputContentType),this.setView(this.options.initialView),this.updateTypeButtons(),this.options.onReplaceSelectedText&&(this.onReplaceSelectedText=this.options.onReplaceSelectedText)}),[{key:"_initializeHtmlToMarkdown",value:(m=o(h().mark((function e(){var t,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0===Y){e.next=5;break}this._htmlToMarkdownConverter=new Y({cacheSize:20}),e.next=10;break;case 5:return e.next=7,Promise.resolve().then((function(){return Q}));case 7:t=e.sent,n=t.default,this._htmlToMarkdownConverter=new n({cacheSize:20});case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Failed to load HtmlToMarkdown module:",e.t0),this._htmlToMarkdownConverter={convert:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent}};case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return m.apply(this,arguments)})},{key:"initializeLibraries",value:function(){var e=this;mermaid.initialize({startOnLoad:!1,securityLevel:"loose",theme:"default",errorCallback:function(e){return console.warn("Mermaid error:",e),"<div class='mermaid-error'></div>"}}),mermaid.init(void 0,".mermaid"),this.md=new n({html:!0,linkify:!0,typographer:!0,highlight:function(e,t){var n=Z();if(t&&n&&n.getLanguage&&n.getLanguage(t))try{return n.highlight(e,{language:t}).value}catch(e){}return""}}),this.md.renderer.rules.fence,this.md.renderer.rules.fence=function(t,n,r,i,o){var a=t[n],s=a.info.trim().toLowerCase(),c=a.content;if("mermaid"===s){var l=e.md.utils.escapeHtml(c);return'<div class="mermaid" data-source-type="mermaid">'.concat(l,"</div>")}if("svg"===s){var u=c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'<div class="svg-container" data-source-type="svg" data-original-source="'.concat(u,'">').concat(c,"</div>")}if("geojson"===s){var d=e.md.utils.escapeHtml(c),h=e.md.utils.escapeHtml(c);return'<div class="geojson-container" data-source-type="geojson" data-original-source="'.concat(h,'">').concat(d,"</div>")}if("topojson"===s){var p=e.md.utils.escapeHtml(c),f=e.md.utils.escapeHtml(c);return'<div class="topojson-container" data-source-type="topojson" data-original-source="'.concat(f,'">').concat(p,"</div>")}if("stl"===s){var v=e.md.utils.escapeHtml(c),g=e.md.utils.escapeHtml(c);return'<div class="stl-container" data-source-type="stl" data-original-source="'.concat(g,'">').concat(v,"</div>")}if("math"===s){var m="math-"+Math.random().toString(36).substring(2,15),b=c.replace(/\r?\n/g," ").replace(/\s+/g," ").trim();return'<div id="'.concat(m,'" class="math-display" data-source-type="math">$',"$").concat(b,"$","$","</div>")}var w,x=a.info.trim().split(/\s+/)[0]||"",k=e.md.utils.escapeHtml(x);if(["csv","tsv","psv"].includes(x))try{if(void 0===y||"function"!=typeof y.parse)return'<pre class="squibview-error" data-source-type="'.concat(k,'">Error: PapaParse library not loaded.</pre>');var S={skipEmptyLines:!0};"tsv"!==x&&(S.delimiter="csv"===x?",":"|");var C=y.parse(c,S);if(C.errors&&C.errors.length>0){var T=C.errors.map((function(e){return"".concat(e.type,": ").concat(e.message," (Row: ").concat(e.row,")")})).join("\n");return'<pre class="squibview-error" data-source-type="'.concat(k,'">Error parsing ').concat(x," data:\n").concat(e.md.utils.escapeHtml(T),"</pre>")}return'<div data-source-type="'.concat(k,'">').concat(e._dataToHtmlTable(C.data),"</div>")}catch(t){return'<pre class="squibview-error" data-source-type="'.concat(k,'">Could not render ').concat(e.md.utils.escapeHtml(x)," table.</pre>")}var E=Z();if(E&&E.getLanguage&&E.getLanguage(x))try{var _=E.highlight(c,{language:x,ignoreIllegals:!0}).value;w='<pre><code class="hljs language-'.concat(k,'" data-source-type="code" data-lang="').concat(k,'">').concat(_,"</code></pre>")}catch(e){}if(!w){var L=e.md.utils.escapeHtml(c);w='<pre><code class="hljs language-'.concat(k,'" data-source-type="code" data-lang="').concat(k,'">').concat(L,"</code></pre>")}return'<div data-source-type="'.concat(k||"code",'">').concat(w,"</div>")}}},{key:"_dataToHtmlTable",value:function(e){var t=this;if(!e||0===e.length)return'<p class="squibview-info">No data to display.</p>';var n='<table class="squibview-data-table">',r=e[0];n+="<thead><tr>",r.forEach((function(e){n+="<th>".concat(t.md.utils.escapeHtml(String(e)),"</th>")})),n+="</tr></thead>",n+="<tbody>";for(var i=1;i<e.length;i++){n+="<tr>";for(var o=e[i],a=0;a<r.length;a++){var s=void 0!==o[a]?String(o[a]):"";n+="<td>".concat(this.md.utils.escapeHtml(s),"</td>")}n+="</tr>"}return n+="</tbody></table>"}},{key:"registerRenderer",value:function(e,t){this.renderers[e]=t,this.events.emit("renderer:registered",e,t),this.inputContentType===e&&this.updateTypeButtons()}},{key:"registerDefaultRenderers",value:function(){var e=this;this.registerRenderer("md",{render:function(t){return e.renderMarkdown(t)},sourceToOutput:function(t){return e.md.render(t)},outputToSource:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.htmlToMarkdown(t,n)},operations:{increaseHeadings:function(t){return e.markdownAdjustHeadings(t,1)},decreaseHeadings:function(t){return e.markdownAdjustHeadings(t,-1)},removeHR:function(e){return e.replace(/---/g,"")},fixLinefeeds:function(t){return e.fixLinefeedsInMarkdown(t)},toggleLinefeedView:function(){return e.toggleLinefeedView(),e.getContent()}},buttons:[{label:"H-",action:"decreaseHeadings",title:"Decrease heading levels"},{label:"H+",action:"increaseHeadings",title:"Increase heading levels"},{label:"Remove HR",action:"removeHR",title:"Remove horizontal rules"},{label:"Smart Linefeeds",action:"fixLinefeeds",title:"Convert all single line breaks to hard line breaks (two spaces + newline) in the source."}]}),this.registerRenderer("html",{render:function(t){return e.renderHTML(t)},sourceToOutput:function(e){return e},outputToSource:function(e){return e},operations:{},buttons:[]}),this.registerRenderer("reveal",{render:function(t){return e.renderHTML(e.makeRevealJSFullPage(t))},sourceToOutput:function(t){return e.makeRevealJSFullPage(t)},outputToSource:function(e){return e},operations:{},buttons:[]}),this.registerRenderer("csv",{render:function(t){var n=e.csvOrTsvToMarkdownTable(t,",");e.renderMarkdown(n)},sourceToOutput:function(t){return e.csvOrTsvToMarkdownTable(t,",")},outputToSource:function(t){return e.tableToCSV(t)},operations:{},buttons:[]}),this.registerRenderer("tsv",{render:function(t){var n=e.csvOrTsvToMarkdownTable(t,"\t");e.renderMarkdown(n)},sourceToOutput:function(t){return e.csvOrTsvToMarkdownTable(t,"\t")},outputToSource:function(t){return e.tableToCSV(t,"\t")},operations:{},buttons:[]}),this.registerRenderer("semisv",{render:function(t){var n=e.csvOrTsvToMarkdownTable(t,";");e.renderMarkdown(n)},sourceToOutput:function(t){return e.csvOrTsvToMarkdownTable(t,";")},outputToSource:function(t){return e.tableToCSV(t,";")},operations:{},buttons:[]}),this.registerRenderer("ssv",{render:function(t){var n=e.csvOrTsvToMarkdownTable(t," ");e.renderMarkdown(n)},sourceToOutput:function(t){return e.csvOrTsvToMarkdownTable(t," ")},outputToSource:function(t){return e.tableToCSV(t," ")},operations:{},buttons:[]})}},{key:"createStructure",value:function(){this.container.classList.add(this.options.baseClass),this.container.innerHTML='\n      <div class="'.concat(this.options.baseClass,'-title" ').concat(this.options.titleShow?"":'style="display:none"',">\n        ").concat(this.options.titleContent,'\n      </div>\n      <div class="').concat(this.options.baseClass,'-controls" ').concat(this.options.showControls?"":'style="display:none"','>\n        <button data-view=\'src\'>Source</button>\n        <button data-view="html">Rendered</button>\n        <button data-view="split">Split</button>\n        <button class="copy-src-button">Copy Source</button>\n        <button class="copy-html-button">Copy Rendered</button>\n        <button class="revision-undo" title="Undo">&#x21A9;</button>\n        <button class="revision-redo" title="Redo">&#x21AA;</button>\n        <span class="').concat(this.options.baseClass,'-type-buttons"></span>\n      </div>\n      <div class="').concat(this.options.baseClass,'-editor">\n        ').concat(this.options.showLineNumbers?'<div class="'.concat(this.options.baseClass,'-source-panel">\n            <div class="').concat(this.options.baseClass,'-line-gutter"></div>\n            <textarea class="').concat(this.options.baseClass,'-input"></textarea>\n          </div>'):'<textarea class="'.concat(this.options.baseClass,'-input"></textarea>'),'\n        <div class="').concat(this.options.baseClass,'-output"></div>\n      </div>\n    '),this.title=this.container.querySelector(".".concat(this.options.baseClass,"-title")),this.controls=this.container.querySelector(".".concat(this.options.baseClass,"-controls")),this.editor=this.container.querySelector(".".concat(this.options.baseClass,"-editor")),this.input=this.container.querySelector(".".concat(this.options.baseClass,"-input")),this.output=this.container.querySelector(".".concat(this.options.baseClass,"-output")),this.typeButtonsContainer=this.container.querySelector(".".concat(this.options.baseClass,"-type-buttons")),this.universalButtonsContainer=this.container.querySelector(".".concat(this.options.baseClass,"-universal-buttons")),this.options.showLineNumbers&&(this.sourcePanel=this.container.querySelector(".".concat(this.options.baseClass,"-source-panel")),this.lineGutter=this.container.querySelector(".".concat(this.options.baseClass,"-line-gutter")))}},{key:"updateTypeButtons",value:function(){var e=this;this.typeButtonsContainer.innerHTML="";var t=this.renderers[this.inputContentType];t&&t.buttons&&t.buttons.length>0&&t.buttons.forEach((function(n){var r=document.createElement("button");r.textContent=n.label,n.title&&(r.title=n.title),r.addEventListener("click",(function(){if(t.operations&&t.operations[n.action]){var r=t.operations[n.action](e.getContent());e.setContent(r,e.inputContentType)}})),e.typeButtonsContainer.appendChild(r)}))}},{key:"initializeEventHandlers",value:function(){var e=this;this.controls.querySelectorAll("button[data-view]").forEach((function(t){t.addEventListener("click",(function(){return e.setView(t.dataset.view)}))})),this.controls.querySelector(".copy-src-button").addEventListener("click",(function(){return e.copySource()})),this.controls.querySelector(".copy-html-button").addEventListener("click",(function(){return e.copyHTML()})),this.controls.querySelector(".revision-undo").addEventListener("click",(function(){return e.revisionUndo()})),this.controls.querySelector(".revision-redo").addEventListener("click",(function(){return e.revisionRedo()})),this.input.addEventListener("input",(function(){e.setContent()})),this.input.addEventListener("mouseup",(function(){var t=document.getSelection();if(t&&""!==t.toString().trim()){var n={panel:"source",text:t.toString(),range:{start:e.input.selectionStart,end:e.input.selectionEnd}};e.lastSelectionData=n,e.events.emit("text:selected",n)}}));var t=null;this.specialContentBlocks=new Map,this.output.addEventListener("input",(function(){if("html"===e.currentView||"split"===e.currentView){var n=e.output.querySelector('[contenteditable="true"]');n&&(t&&clearTimeout(t),t=setTimeout((function(){var r=n.innerHTML,i=e.renderers[e.inputContentType];if(i&&i.outputToSource){var o=e.input.value,a=i.outputToSource(r,{originalSource:o});e.input.value=a,e.revisionManager.addRevision(a,e.inputContentType),e.events.emit("content:change",a,e.inputContentType)}t=null}),300))}})),this.output.addEventListener("mouseup",(function(){var t=document.getSelection();if(t&&""!==t.toString().trim()){var n=t.getRangeAt(0),r={panel:"rendered",text:t.toString(),range:n,element:e.output.querySelector('[contenteditable="true"]')};e.lastSelectionData=r,e.events.emit("text:selected",r)}}))}},{key:"preserveSpecialBlocks",value:function(e,t){if(!e)return t;for(var n,r=[],i=/```mermaid\s*([\s\S]*?)```/g;null!==(n=i.exec(e));)r.push({type:"mermaid",content:n[0],startIndex:n.index,endIndex:n.index+n[0].length});for(var o,a=/```geojson\s*([\s\S]*?)```/g;null!==(o=a.exec(e));)r.push({type:"geojson",content:o[0],startIndex:o.index,endIndex:o.index+o[0].length});for(var s,c=/```math\s*([\s\S]*?)```/g;null!==(s=c.exec(e));)r.push({type:"math",content:s[0],startIndex:s.index,endIndex:s.index+s[0].length});for(var l,u,d=t,h=/<div[^>]*class=['"]?mermaid['"]?[^>]*>([\s\S]*?)<\/div>/g,p=/<div[^>]*class=['"]?geojson-map['"]?[^>]*>[\s\S]*?<\/div>/g,f=/<div[^>]*class=['"]?math-display['"]?[^>]*>[\s\S]*?<\/div>/g,v=0;null!==(l=h.exec(d));){var g=r.filter((function(e){return"mermaid"===e.type}));v<g.length&&(d=d.substring(0,l.index)+g[v].content+d.substring(l.index+l[0].length),v++)}for(var m,y=0;null!==(u=p.exec(d));){var b=r.filter((function(e){return"geojson"===e.type}));y<b.length&&(d=d.substring(0,u.index)+b[y].content+d.substring(u.index+u[0].length),y++)}for(var w=0;null!==(m=f.exec(d));){var x=r.filter((function(e){return"math"===e.type}));w<x.length&&(d=d.substring(0,m.index)+x[w].content+d.substring(m.index+m[0].length),w++)}return d}},{key:"initializeResizeObserver",value:function(){var e=this;new ResizeObserver((function(t){var n,r=c(t);try{for(r.s();!(n=r.n()).done;){n.value.target===e.container&&e.adjustLayout()}}catch(e){r.e(e)}finally{r.f()}})).observe(this.container)}},{key:"adjustLayout",value:function(){var e=this.container.getBoundingClientRect(),t=this.title.offsetHeight,n=this.controls.offsetHeight,r=e.height-t-n,i=e.width;this.editor.style.height="".concat(r,"px"),this.editor.style.width="".concat(i,"px"),"split"===this.currentView?(this.input.style.width="50%",this.output.style.width="50%"):"src"===this.currentView?this.input.style.width="100%":"html"===this.currentView&&(this.output.style.width="100%"),this.events.emit("layout:change",this.currentView,{containerWidth:i,containerHeight:r})}},{key:"setContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.input.value,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.inputContentType,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t!==this.inputContentType&&(this.inputContentType=t,this.updateTypeButtons()),this.input.value=e,n&&this.revisionManager.addRevision(e,t),this.renderOutput(),this.options.showLineNumbers&&this.lineGutter&&this.updateLineNumbers(),this.events.emit("content:change",e,t)}},{key:"revisionUndo",value:function(){var e=this.revisionManager.undo();e&&(this.input.value=e.content,this.inputContentType=e.contentType,this.updateTypeButtons(),this.renderOutput(),this.events.emit("revision:undo",e.content,e.contentType))}},{key:"revisionRedo",value:function(){var e=this.revisionManager.redo();e&&(this.input.value=e.content,this.inputContentType=e.contentType,this.updateTypeButtons(),this.renderOutput(),this.events.emit("revision:redo",e.content,e.contentType))}},{key:"revisionSet",value:function(e){var t=this.revisionManager.setRevision(e);t&&(this.input.value=t.content,this.inputContentType=t.contentType,this.updateTypeButtons(),this.renderOutput(),this.events.emit("revision:set",e,t.content,t.contentType))}},{key:"revisionNumRevsions",value:function(){return this.revisionManager.getRevisionCount()}},{key:"revisionGetCurrentIndex",value:function(){return this.revisionManager.getCurrentIndex()}},{key:"getContent",value:function(){return this.input.value}},{key:"cleanMarkdown",value:function(e){return e.replace(/^```markdown\s+/,"").replace(/```$/,"")}},{key:"renderMarkdown",value:(g=o(h().mark((function e(t){var n,r,i,o,a,s,l,u,d=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t||this.input.value,r=this.md.render(n),i=r,this.linefeedViewEnabled&&(i=i.replace(/(<p>)([\s\S]*?)(<\/p>)/g,(function(e,t,n,r){return t+n.split(/<br\s*\/?>(?![^<]*<\/code>)/g).map((function(e){return/\s*<\/?.*?>\s*/.test(e)||""===e.trim()||/<br\s*\/?>(\s*)$/.test(e)?e:e+"<br>"})).join("")+r}))),this.output.innerHTML="<div contenteditable='true'>"+i+"</div>",o=this.output.querySelector('div[contenteditable="true"]'),a=o.querySelectorAll("img"),s=c(a),e.prev=8,u=h().mark((function e(){var t,n,r,i,o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.value,e.prev=1,n=t.src,d.options.preserveImageTags){e.next=10;break}return r=document.createElement("canvas"),i=r.getContext("2d"),(o=new Image).crossOrigin="anonymous",e.next=10,new Promise((function(e,a){o.onload=function(){r.width=o.naturalWidth,r.height=o.naturalHeight,i.drawImage(o,0,0);var n=r.toDataURL("image/png",1);t.src=n,e()},o.onerror=a,o.src=n}));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("Failed to convert image:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})),s.s();case 11:if((l=s.n()).done){e.next=15;break}return e.delegateYield(u(),"t0",13);case 13:e.next=11;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),s.e(e.t1);case 20:return e.prev=20,s.f(),e.finish(20);case 23:return mermaid.init(void 0,this.output.querySelectorAll(".mermaid")),this.initializeGeoRenderers(),this.initializeSTLRenderers(),e.next=28,this.ensureMathJaxAndTypeset();case 28:this.events.emit("markdown:rendered",n,r);case 29:case"end":return e.stop()}}),e,this,[[8,17,20,23]])}))),function(e){return g.apply(this,arguments)})},{key:"ensureMathJaxAndTypeset",value:(v=o(h().mark((function e(){var t,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(){if("undefined"!=typeof MathJax&&MathJax.typesetPromise)return MathJax.typesetPromise(Array.from(t))},(t=this.output.querySelectorAll("div.math-display")).length){e.next=4;break}return e.abrupt("return");case 4:if("undefined"!=typeof MathJax){e.next=11;break}if(!window.mathJaxLoading){e.next=7;break}return e.abrupt("return");case 7:return window.mathJaxLoading=!0,e.abrupt("return",new Promise((function(e,t){window.MathJax||(window.MathJax={loader:{load:["input/tex","output/svg"]},tex:{packages:{"[+]":["ams"]},inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{renderActions:{addMenu:[]},ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},svg:{fontCache:"none"},startup:{typeset:!1}});var r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js",r.async=!0,r.onload=function(){var r;window.mathJaxLoading=!1,null===(r=n())||void 0===r||r.then(e).catch(t)},r.onerror=function(){window.mathJaxLoading=!1,t(new Error("Failed to load MathJax"))},document.head.appendChild(r)})));case 11:return e.abrupt("return",n());case 12:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"initializeGeoRenderers",value:function(){var e=this;this.output&&(this.output.querySelectorAll(".geojson-container").forEach((function(t){t.dataset.initialized||e.renderGeoJSON(t)})),this.output.querySelectorAll(".topojson-container").forEach((function(t){t.dataset.initialized||e.renderTopoJSON(t)})))}},{key:"initializeSTLRenderers",value:function(){var e=this;this.output&&this.output.querySelectorAll(".stl-container").forEach((function(t){t.dataset.initialized||e.renderSTL(t)}))}},{key:"renderGeoJSON",value:function(e){try{var t=e.textContent;if(e.setAttribute("data-original-source",t),void 0===window.L)return void(e.innerHTML='<p style="color: #666; text-align: center; padding: 20px;">Leaflet library not loaded</p>');var n=JSON.parse(t);e.innerHTML="",e.style.cssText="width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px;";var r="map-"+Math.random().toString(36).substring(2,15);e.id=r;var i=window.L.map(r).setView([0,0],2);window[r+"_map"]=i,window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(i);var o=window.L.geoJSON(n).addTo(i);o.getBounds().isValid()&&i.fitBounds(o.getBounds(),{padding:[20,20]}),e.dataset.initialized="true"}catch(t){console.error("Error rendering GeoJSON:",t),e.innerHTML='<p style="color: red; text-align: center; padding: 20px;">Error rendering GeoJSON map</p>',e.dataset.initialized="error"}}},{key:"renderTopoJSON",value:function(e){try{var t=e.textContent;if(e.setAttribute("data-original-source",t),void 0===window.L)return void(e.innerHTML='<p style="color: #666; text-align: center; padding: 20px;">Leaflet library not loaded</p>');if("undefined"==typeof topojson)return void(e.innerHTML='<p style="color: #666; text-align: center; padding: 20px;">TopoJSON client library not loaded</p>');var n=JSON.parse(t),r=topojson.feature(n,Object.keys(n.objects)[0]);e.innerHTML="",e.style.cssText="width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px;";var i="map-"+Math.random().toString(36).substring(2,15);e.id=i;var o=window.L.map(i).setView([0,0],2);window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(o);var a=L.geoJSON(r).addTo(o);a.getBounds().isValid()&&o.fitBounds(a.getBounds(),{padding:[20,20]}),e.dataset.initialized="true"}catch(t){console.error("Error rendering TopoJSON:",t),e.innerHTML='<p style="color: red; text-align: center; padding: 20px;">Error rendering TopoJSON map</p>',e.dataset.initialized="error"}}},{key:"renderSTL",value:function(e){try{var t=e.textContent;if(e.setAttribute("data-original-source",t),"undefined"==typeof THREE)return void(e.innerHTML='<p style="color: #666; text-align: center; padding: 20px;">Three.js library not loaded</p>');var n=t;e.innerHTML="",e.style.cssText="width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px; position: relative;";var r=new THREE.Scene,i=new THREE.PerspectiveCamera(75,e.offsetWidth/e.offsetHeight,.1,1e3),o=new THREE.WebGLRenderer({antialias:!0});o.setSize(e.offsetWidth,e.offsetHeight),o.setClearColor(15790320),e.appendChild(o.domElement),e._threeScene=r,e._threeCamera=i,e._threeRenderer=o;var a=this.parseSTL(n),s=new THREE.MeshLambertMaterial({color:6316128}),c=new THREE.Mesh(a,s);r.add(c);var l=new THREE.AmbientLight(4210752,.6);r.add(l);var u=new THREE.DirectionalLight(16777215,.8);u.position.set(1,1,1).normalize(),r.add(u);var d=(new THREE.Box3).setFromObject(c),h=d.getCenter(new THREE.Vector3),p=d.getSize(new THREE.Vector3),f=Math.max(p.x,p.y,p.z);i.position.set(h.x+f,h.y+f,h.z+f),i.lookAt(h);var v=function(){requestAnimationFrame(v),c.rotation.y+=.01,o.render(r,i)};v(),e.dataset.initialized="true"}catch(t){console.error("Error rendering STL:",t),e.innerHTML='<p style="color: red; text-align: center; padding: 20px;">Error rendering STL model</p>',e.dataset.initialized="error"}}},{key:"parseSTL",value:function(e){var t,n=new THREE.BufferGeometry,r=[],i=[],o=null,a=c(e.split("\n"));try{for(a.s();!(t=a.n()).done;){var s=t.value;if((s=s.trim()).startsWith("facet normal")){var l=s.split(/\s+/);o=[parseFloat(l[2]),parseFloat(l[3]),parseFloat(l[4])]}else if(s.startsWith("vertex")){var u=s.split(/\s+/);r.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3])),o&&i.push(o[0],o[1],o[2])}}}catch(e){a.e(e)}finally{a.f()}return n.setAttribute("position",new THREE.Float32BufferAttribute(r,3)),n.setAttribute("normal",new THREE.Float32BufferAttribute(i,3)),n}},{key:"htmlToMarkdown",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._htmlToMarkdownConverter){var n=document.createElement("div");return n.innerHTML=e,n.textContent}return this._htmlToMarkdownConverter.convert(e,{originalSource:t.originalSource||this.input.value})}},{key:"tableToCSV",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=document.createElement("div");n.innerHTML=e;var r=n.querySelector("table");return r?Array.from(r.querySelectorAll("tr")).map((function(e){return Array.from(e.querySelectorAll("th, td")).map((function(e){var n=e.textContent.trim();return n.includes(t)||n.includes('"')||n.includes("\n")?'"'.concat(n.replace(/"/g,'""'),'"'):n})).join(t)})).join("\n"):""}},{key:"markdownRemoveAllHR",value:function(){if("md"===this.inputContentType){var e=this.getMarkdownSource().replace(/---/g,"");this.setContent(e,this.inputContentType)}}},{key:"markdownAdjustHeadings",value:function(e,t){return 0===t||"string"!=typeof e?e:e.split("\n").map((function(e){var n=e.match(/^(#{1,6})\s/);if(!n)return e;var r=n[1].length,i=Math.min(Math.max(r+t,1),6);return"#".repeat(i)+e.substring(r)})).join("\n")}},{key:"markdownEditorAdjustHeadings",value:function(e){var t=this.getMarkdownSource(),n=this.markdownAdjustHeadings(t,e);this.setContent(n,this.inputContentType)}},{key:"setView",value:function(e){this.currentView=e,this.editor.setAttribute("data-view",e),this.controls.querySelectorAll("button[data-view]").forEach((function(t){t.classList.toggle("active",t.dataset.view===e)}));var t=this.controls.querySelector(".copy-src-button"),n=this.controls.querySelector(".copy-html-button");"src"===e?(this.sourcePanel?(this.sourcePanel.classList.remove("squibview-hidden"),this.sourcePanel.style.width="100%"):(this.input.classList.remove("squibview-hidden"),this.input.style.width="100%"),this.output.classList.add("squibview-hidden"),t.classList.remove("squibview-hidden"),n.classList.add("squibview-hidden")):"html"===e?(this.sourcePanel?this.sourcePanel.classList.add("squibview-hidden"):this.input.classList.add("squibview-hidden"),this.output.classList.remove("squibview-hidden"),this.output.style.width="100%",t.classList.add("squibview-hidden"),n.classList.remove("squibview-hidden")):(this.sourcePanel?(this.sourcePanel.classList.remove("squibview-hidden"),this.sourcePanel.style.width="50%"):(this.input.classList.remove("squibview-hidden"),this.input.style.width="50%"),this.output.classList.remove("squibview-hidden"),this.output.style.width="50%",t.classList.remove("squibview-hidden"),n.classList.remove("squibview-hidden")),this.adjustLayout(),this.events.emit("view:change",e)}},{key:"renderHTML",value:function(e){var t=e,n=this.output;this.insertContentInIframe(n,t),this.events.emit("html:rendered",t)}},{key:"insertContentInIframe",value:function(e,t){var n=document.createElement("iframe");n.style.width="100%",n.style.height="100%",n.style.border="none",n.style.display="block",e.innerHTML="",e.appendChild(n);var r=n.contentWindow.document;r.open(),r.write(t),r.close(),this.output_iframe=n,this.output_ifraome_content=t}},{key:"renderOutput",value:function(){var e=this.renderers[this.inputContentType];e&&e.render?(e.render(this.getContent()),this.events.emit("content:rendered",this.inputContentType)):(console.warn("No renderer for content type: ".concat(this.inputContentType)),this.renderMarkdown())}},{key:"copySource",value:(f=o(h().mark((function e(){var t,n,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.controls.querySelector(".copy-src-button")).textContent="Copying...",e.prev=2,n=this.getMarkdownSource(),e.prev=4,e.next=7,navigator.clipboard.writeText(n);case 7:e.next=18;break;case 9:e.prev=9,e.t0=e.catch(4),(r=document.createElement("textarea")).value=n,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select(),document.body.removeChild(r);case 18:t.textContent="Copied!",e.next=25;break;case 21:e.prev=21,e.t1=e.catch(2),console.error("Copy Markdown failed:",e.t1),t.textContent="Copy failed";case 25:setTimeout((function(){t.textContent="Copy Source"}),2e3);case 26:case"end":return e.stop()}}),e,this,[[2,21],[4,9]])}))),function(){return f.apply(this,arguments)})},{key:"getMarkdownSource",value:function(){return this.input.value}},{key:"getHTMLSource",value:function(){var e=this.output.querySelector('div[contenteditable="true"]');return e?e.innerHTML:this.output_iframe?this.output_ifraome_content:""}},{key:"getSourceDiff",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fromIndex,n=void 0===t?null:t,r=e.toIndex,i=void 0===r?null:r,o=this.revisionManager.getCurrentIndex(),a=null===n?Math.max(-1,o-1):n,s=null===i?o:i,c={fromIndex:a,toIndex:s,lineDiff:this.revisionManager.computeLineDiff(a,s),stats:this.revisionManager.getDiffStats(a,s)};try{c.fromRevision=this.revisionManager.getRevisionInfo(a),c.toRevision=this.revisionManager.getRevisionInfo(s)}catch(e){c.error=e.message}return this.events.emit("diff:computed",{fromIndex:c.fromIndex,toIndex:c.toIndex,stats:c.stats,hasChanges:c.stats.totalChanges>0}),c}},{key:"getSourceDiffHTML",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fromIndex,n=void 0===t?null:t,r=e.toIndex,i=void 0===r?null:r,o=e.showLineNumbers,a=void 0===o||o,s=e.cssClasses,l=void 0===s?{}:s,u=this.getSourceDiff({fromIndex:n,toIndex:i}),d={container:l.container||"squibview-diff",line:l.line||"diff-line",added:l.added||"diff-added",removed:l.removed||"diff-removed",unchanged:l.unchanged||"diff-unchanged",lineNumber:l.lineNumber||"diff-line-number",content:l.content||"diff-content"},h='<div class="'.concat(d.container,'" contenteditable="false">');h+='<div class="diff-header">',h+="<div>Comparing revision ".concat(u.fromIndex," to ").concat(u.toIndex,"</div>"),u.stats&&u.stats.totalChanges>0?(h+='<div class="diff-stats">',u.stats.additions>0&&(h+='<span class="stat additions">+'.concat(u.stats.additions," additions</span>")),u.stats.deletions>0&&(h+='<span class="stat deletions">-'.concat(u.stats.deletions," deletions</span>")),u.stats.modifications>0&&(h+='<span class="stat modifications">~'.concat(u.stats.modifications," modifications</span>")),h+='<span class="stat">'.concat(u.stats.totalChanges," total changes</span>"),h+="</div>"):h+='<div class="diff-stats"><span class="stat">No changes</span></div>',h+="</div>",h+='<div class="diff-content">';var p,f=c(u.lineDiff);try{for(f.s();!(p=f.n()).done;){var v=p.value,g="".concat(d.line," ").concat(d[v.type]);if(h+='<div class="'.concat(g,'">'),a){var m="removed"===v.type?v.oldLineNum||"":v.newLineNum||"";h+='<span class="'.concat(d.lineNumber,'">').concat(m,"</span>")}var y=this._escapeHtml(v.content);h+='<span class="'.concat(d.content,'">').concat(y,"</span>"),h+="</div>"}}catch(e){f.e(e)}finally{f.f()}return h+="</div>",h+="</div>",this.events.emit("diff:displayed",{fromIndex:u.fromIndex,toIndex:u.toIndex,stats:u.stats,htmlLength:h.length,showLineNumbers:a}),h}},{key:"getSourceDiffInline",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.fromIndex,i=void 0===r?null:r,o=n.toIndex,a=void 0===o?null:o,s=n.cssClasses,l=void 0===s?{}:s,u=this.getSourceDiff({fromIndex:i,toIndex:a}),d={container:l.container||"squibview-diff-inline",added:l.added||"diff-inline-added",removed:l.removed||"diff-inline-removed"},h=this.revisionManager.getCurrentIndex(),f=null===i?Math.max(-1,h-1):i,v=null===a?h:a;try{e=this.revisionManager.getContentAtRevision(f).content,t=this.revisionManager.getContentAtRevision(v).content}catch(e){return'<div class="'.concat(d.container,'"><p>Error: ').concat(e.message,"</p></div>")}var g=this.revisionManager.diffEngine.diff_main(e,t);this.revisionManager.diffEngine.diff_cleanupSemantic(g);var m='<div class="'.concat(d.container,'" contenteditable="false">');m+='<div class="diff-inline-header">',m+="<div>Comparing revision ".concat(f," to ").concat(v,"</div>"),u.stats&&u.stats.totalChanges>0&&(m+='<div class="diff-inline-stats">',m+='<span style="color: #007bff;">+'.concat(u.stats.additions,"</span> "),m+='<span style="color: #dc3545;">-'.concat(u.stats.deletions,"</span>"),u.stats.modifications>0&&(m+=' <span style="color: #ffc107;">~'.concat(u.stats.modifications,"</span>")),m+="</div>"),m+="</div>",m+='<div class="diff-inline-content">';var y,b=c(g);try{for(b.s();!(y=b.n()).done;){var w=p(y.value,2),x=w[0],k=w[1],S=this._escapeHtml(k);m+=1===x?'<span class="'.concat(d.added,'">').concat(S,"</span>"):-1===x?'<span class="'.concat(d.removed,'">').concat(S,"</span>"):S}}catch(e){b.e(e)}finally{b.f()}return m+="</div></div>",this.events.emit("diff:displayed",{fromIndex:f,toIndex:v,stats:u.stats,htmlLength:m.length,type:"inline"}),m}},{key:"_escapeHtml",value:function(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}},{key:"onTextSelected",value:function(e){var t=this;if("function"!=typeof e)throw new Error("Callback must be a function");return this.events.on("text:selected",e),function(){t.events.off("text:selected",e)}}},{key:"replaceSelectedText",value:function(e,t){if(!t)return!1;if("source"===t.panel){var n=t.range,r=n.start,i=n.end,o=this.input.value,a=o.substring(0,r)+e+o.substring(i);return this.setContent(a,this.inputContentType),this.input.focus(),this.input.setSelectionRange(r+e.length,r+e.length),!0}if("rendered"===t.panel){var s=t.range;s.deleteContents();var c=document.createTextNode(e);s.insertNode(c),s.setStartAfter(c),s.setEndAfter(c),s.collapse(!0);var l=window.getSelection();l.removeAllRanges(),l.addRange(s);var u=this.output.querySelector('[contenteditable="true"]');if(u){var d=u.innerHTML,h=this.renderers[this.inputContentType];if(h&&h.outputToSource){var p=this.input.value,f=h.outputToSource(d,{originalSource:p});this.input.value=f,this.revisionManager.addRevision(f,this.inputContentType),this.events.emit("content:change",f,this.inputContentType)}}return!0}return!1}},{key:"setSelectionEditable",value:function(e,t){if(!t||"rendered"!==t.panel)return!1;var n=t.range;if(n){var r=document.createElement("span");r.contentEditable=e.toString(),e?r.className="squibview-editable-content":(r.className="squibview-locked-content",r.title="This content is locked (not editable)",r.style.position="relative",r.style.backgroundColor="rgba(0, 0, 0, 0.05)",r.style.border="1px dashed #999",r.style.borderRadius="3px",r.style.padding="0 2px"),r.appendChild(n.cloneContents()),n.deleteContents(),n.insertNode(r);var i=this.output.querySelector('[contenteditable="true"]');if(i){var o=i.innerHTML,a=this.renderers[this.inputContentType];if(a&&a.outputToSource){var s=this.input.value,c=a.outputToSource(o,{originalSource:s});this.input.value=c,this.revisionManager.addRevision(c,this.inputContentType),this.events.emit("content:change",c,this.inputContentType)}}return!0}return!1}},{key:"toggleSelectionLock",value:function(e){if(!e||"rendered"!==e.panel)return null;for(var t=e.range.commonAncestorContainer,n=!1;t&&t.nodeType===Node.ELEMENT_NODE;){if(t.hasAttribute("contenteditable")){n="false"===t.getAttribute("contenteditable");break}t=t.parentNode}var r=n;return this.setSelectionEditable(r,e)?r:null}},{key:"getCurrentSelection",value:function(){if(this.lastSelectionData)return this.lastSelectionData;var e=document.getSelection();if(!e||""===e.toString().trim())return null;if(this.input===document.activeElement){var t={panel:"source",text:e.toString(),range:{start:this.input.selectionStart,end:this.input.selectionEnd}};return this.lastSelectionData=t,t}for(var n=e.anchorNode,r=!1;n&&n!==document.body;){if(n===this.output){r=!0;break}n=n.parentNode}if(r){var i={panel:"rendered",text:e.toString(),range:e.getRangeAt(0),element:this.output.querySelector('[contenteditable="true"]')};return this.lastSelectionData=i,i}return null}},{key:"clearSelection",value:function(){this.lastSelectionData=null;var e=window.getSelection();e&&e.removeAllRanges()}},{key:"onReplaceSelectedText",get:function(){var e=this;return this._onTextReplacementHandler?function(t){return e._onTextReplacementHandler(t)}:null},set:function(e){var t=this;if(null!==e&&"function"!=typeof e)throw new Error("onReplaceSelectedText handler must be a function or null");this._onTextReplacementHandler&&(this.events.off("text:selected",this._onTextReplacementHandler),this._onTextReplacementHandler=null),e&&(this._onTextReplacementHandler=function(n){var r=e(n);"string"==typeof r&&t.replaceSelectedText(r,n)},this.events.on("text:selected",this._onTextReplacementHandler))}},{key:"copyHTML",value:(u=o(h().mark((function e(){var t,n,r,i,o,a,s,l,u,d,p,f,v,g,m,y,b,w,x,k,S,C,T,E,_,L,R,A,M,O,N,I,j,H,D,q,F,B,P,z,V,U,G,J,$,W,K,Y,Q,X,Z,ee=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.controls.querySelector(".copy-html-button")).textContent="Copying...",e.prev=2,n=this.output.querySelector('div[contenteditable="true"]')){e.next=6;break}throw new Error("Content div not found");case 6:(r=n.cloneNode(!0)).querySelectorAll("pre code").forEach((function(e){var t=e.innerHTML,n=document.createElement("table");n.style.width="100%",n.style.borderCollapse="collapse",n.style.border="none";var r=document.createElement("tr"),i=document.createElement("td");i.style.backgroundColor="#f7f7f7",i.style.padding="12px",i.style.fontFamily='Consolas, Monaco, "Courier New", monospace',i.style.whiteSpace="pre",i.style.border="none",i.innerHTML=t.trim(),r.appendChild(i),n.appendChild(r),e.parentNode.replaceWith(n)})),i=r.querySelectorAll("img"),o=c(i),e.prev=10,s=h().mark((function e(){var t,n,r,i,o,s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.value,e.prev=1,n=document.createElement("canvas"),r=n.getContext("2d"),(i=new Image).crossOrigin="anonymous",e.next=8,new Promise((function(e,o){i.onload=function(){var o,a,s=t.getAttribute("width"),c=t.getAttribute("height");s&&c?(o=parseInt(s),a=parseInt(c)):s&&!c?(o=parseInt(s),a=Math.round(o/i.naturalWidth*i.naturalHeight)):!s&&c?(a=parseInt(c),o=Math.round(a/i.naturalHeight*i.naturalWidth)):(o=i.naturalWidth,a=i.naturalHeight),n.width=o,n.height=a,r.drawImage(i,0,0,o,a);var l=n.toDataURL("image/png",1);t.src=l,t.setAttribute("width",o.toString()),t.setAttribute("height",a.toString()),t.style.width=o+"px",t.style.height=a+"px",e()},i.onerror=o,i.src=t.src}));case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Failed to convert image for copying:",e.t0),t.src&&(o=t.getAttribute("width"),s=t.getAttribute("height"),o&&(t.style.width=o+(o.match(/\d+$/)?"px":"")),s&&(t.style.height=s+(s.match(/\d+$/)?"px":"")));case 14:case"end":return e.stop()}}),e,null,[[1,10]])})),o.s();case 13:if((a=o.n()).done){e.next=17;break}return e.delegateYield(s(),"t0",15);case 15:e.next=13;break;case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(10),o.e(e.t1);case 22:return e.prev=22,o.f(),e.finish(22);case 25:l=r.querySelectorAll("svg"),u=c(l),e.prev=27,p=h().mark((function e(){var t,n,r,i,o,a,s,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=d.value).closest(".math-display")){e.next=3;break}return e.abrupt("return",1);case 3:return e.prev=3,e.next=6,ee.svgToPng(t);case 6:return n=e.sent,e.next=9,new Promise((function(e){var t=new FileReader;t.onloadend=function(){return e(t.result)},t.readAsDataURL(n)}));case 9:r=e.sent,(i=document.createElement("img")).src=r,o=t.closest(".mermaid")||t.classList.contains("mermaid"),a=t.getAttribute("width")&&t.getAttribute("height"),o||!a?(s=t.clientWidth||t.viewBox&&t.viewBox.baseVal.width||parseFloat(t.getAttribute("width"))||400,c=t.clientHeight||t.viewBox&&t.viewBox.baseVal.height||parseFloat(t.getAttribute("height"))||300):(s=parseFloat(t.getAttribute("width"))||t.viewBox&&t.viewBox.baseVal.width||t.clientWidth||400,c=parseFloat(t.getAttribute("height"))||t.viewBox&&t.viewBox.baseVal.height||t.clientHeight||300),i.width=s,i.height=c,i.setAttribute("width",s.toString()),i.setAttribute("height",c.toString()),i.style.width=s+"px",i.style.height=c+"px",i.style.maxWidth="none",i.style.maxHeight="none",i.setAttribute("v:shapes","image"+Math.random().toString(36).substr(2,9)),i.alt="Converted diagram",t.parentNode.replaceChild(i,t),e.next=31;break;case 28:e.prev=28,e.t0=e.catch(3),console.error("Failed to convert SVG:",e.t0);case 31:case"end":return e.stop()}}),e,null,[[3,28]])})),u.s();case 30:if((d=u.n()).done){e.next=36;break}return e.delegateYield(p(),"t2",32);case 32:if(!e.t2){e.next=34;break}return e.abrupt("continue",34);case 34:e.next=30;break;case 36:e.next=41;break;case 38:e.prev=38,e.t3=e.catch(27),u.e(e.t3);case 41:return e.prev=41,u.f(),e.finish(41);case 44:if(!((f=Array.from(r.querySelectorAll(".math-display"))).length>0)){e.next=64;break}v=c(f),e.prev=47,m=h().mark((function e(){var t,n,r,i,o,a,s,c,l;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.value,e.prev=1,n=t.querySelector("svg")){e.next=6;break}return console.warn("No SVG found in math element, skipping"),e.abrupt("return",1);case 6:return r=new XMLSerializer,i=r.serializeToString(n),o=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(o),s=new Image,e.next=13,new Promise((function(e,t){s.onload=function(){var t,r,i=document.createElement("canvas");try{t=n.width.baseVal.value,r=n.height.baseVal.value}catch(e){n.viewBox&&n.viewBox.baseVal?(t=n.viewBox.baseVal.width,r=n.viewBox.baseVal.height):(t=s.naturalWidth||s.width||200,r=s.naturalHeight||s.height||50)}var o=.025,c=t*o,l=r*o;if(c>100||l>30){var u=100/c,d=30/l,h=Math.min(u,d);o*=h,c*=h,l*=h}t=c,r=l,i.width=2*t,i.height=2*r,i.style.width=t+"px",i.style.height=r+"px";var p=i.getContext("2d");p.scale(2,2),p.fillStyle="#FFFFFF",p.fillRect(0,0,t,r),p.drawImage(s,0,0,t,r),URL.revokeObjectURL(a),e(i.toDataURL("image/png"))},s.onerror=function(){URL.revokeObjectURL(a),t(new Error("Failed to load SVG image"))},s.src=a}));case 13:c=e.sent,(l=document.createElement("img")).src=c,l.style.cssText="display:block;margin:0.5em 0;max-width:100%;height:auto;",l.alt="Math equation",t.parentNode.replaceChild(l,t),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),console.error("Failed to convert math element to image:",e.t0);case 24:case"end":return e.stop()}}),e,null,[[1,21]])})),v.s();case 50:if((g=v.n()).done){e.next=56;break}return e.delegateYield(m(),"t4",52);case 52:if(!e.t4){e.next=54;break}return e.abrupt("continue",54);case 54:e.next=50;break;case 56:e.next=61;break;case 58:e.prev=58,e.t5=e.catch(47),v.e(e.t5);case 61:return e.prev=61,v.f(),e.finish(61);case 64:y=r.querySelectorAll(".geojson-container"),b=c(y),e.prev=66,b.s();case 68:if((w=b.n()).done){e.next=130;break}if(x=w.value,e.prev=70,k=x.getAttribute("data-original-source")){e.next=75;break}throw console.warn("No original source found for GeoJSON container"),new Error("No original source");case 75:S=null,C=this.output.querySelectorAll(".geojson-container"),T=c(C),e.prev=78,T.s();case 80:if((E=T.n()).done){e.next=87;break}if((_=E.value).getAttribute("data-original-source")!==k){e.next=85;break}return S=_,e.abrupt("break",87);case 85:e.next=80;break;case 87:e.next=92;break;case 89:e.prev=89,e.t6=e.catch(78),T.e(e.t6);case 92:return e.prev=92,T.f(),e.finish(92);case 95:if(!S){e.next=114;break}return e.prev=96,e.next=99,this.divToDataUrl(S);case 99:if(!(L=e.sent)){e.next=107;break}return(R=document.createElement("img")).src=L,R.style.cssText="width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px; margin: 0.5em 0;",R.alt="GeoJSON Map",x.parentNode.replaceChild(R,x),e.abrupt("continue",128);case 107:e.next=112;break;case 109:e.prev=109,e.t7=e.catch(96),console.warn("Failed to convert GeoJSON container to image:",e.t7);case 112:e.next=115;break;case 114:console.warn("Could not find original GeoJSON container");case 115:(A=document.createElement("div")).style.cssText="padding: 12px; background-color: #f0f0f0; border: 1px solid #ccc; text-align: center; margin: 0.5em 0;",A.textContent="[GeoJSON Map - Interactive content not available in copy]",x.parentNode.replaceChild(A,x),e.next=128;break;case 121:e.prev=121,e.t8=e.catch(70),console.error("Error processing GeoJSON container for copy:",e.t8),(M=document.createElement("div")).style.cssText="padding: 12px; background-color: #f0f0f0; border: 1px solid #ccc; text-align: center; margin: 0.5em 0;",M.textContent="[GeoJSON Map - Interactive content not available in copy]",x.parentNode.replaceChild(M,x);case 128:e.next=68;break;case 130:e.next=135;break;case 132:e.prev=132,e.t9=e.catch(66),b.e(e.t9);case 135:return e.prev=135,b.f(),e.finish(135);case 138:r.querySelectorAll(".topojson-container").forEach((function(e){var t=e.getAttribute("data-original-source");if(t)try{var n=JSON.parse(t),r=document.createElement("table");r.style.cssText="width: 100%; border-collapse: collapse; border: 1px solid #ddd; margin: 0.5em 0;";var i=document.createElement("tr");i.innerHTML='<td colspan="2" style="background-color: #f5f5f5; padding: 8px; border: 1px solid #ddd; font-weight: bold;">TopoJSON Data</td>',r.appendChild(i);var o=document.createElement("tr");if(o.innerHTML='<td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Type:</td><td style="padding: 8px; border: 1px solid #ddd;">'.concat(n.type||"Unknown","</td>"),r.appendChild(o),n.objects){var a=document.createElement("tr"),s=Object.keys(n.objects).join(", ");a.innerHTML='<td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">Objects:</td><td style="padding: 8px; border: 1px solid #ddd;">'.concat(s,"</td>"),r.appendChild(a)}e.parentNode.replaceChild(r,e)}catch(n){var c=document.createElement("div");c.style.cssText="padding: 12px; background-color: #f5f5f5; border: 1px solid #ddd; font-family: monospace; white-space: pre-wrap; margin: 0.5em 0;",c.textContent="TopoJSON Data:\n".concat(t),e.parentNode.replaceChild(c,e)}else{var l=document.createElement("div");l.style.cssText="padding: 12px; background-color: #f0f0f0; border: 1px solid #ccc; text-align: center; margin: 0.5em 0;",l.textContent="[TopoJSON Map - Interactive content not available in copy]",e.parentNode.replaceChild(l,e)}})),O=r.querySelectorAll(".stl-container"),N=c(O),e.prev=141,N.s();case 143:if((I=N.n()).done){e.next=211;break}if(j=I.value,e.prev=145,H=j.getAttribute("data-original-source")){e.next=150;break}throw console.warn("No original source found for STL container"),new Error("No original source");case 150:D=null,q=this.output.querySelectorAll(".stl-container"),F=c(q),e.prev=153,F.s();case 155:if((B=F.n()).done){e.next=162;break}if((P=B.value).getAttribute("data-original-source")!==H){e.next=160;break}return D=P,e.abrupt("break",162);case 160:e.next=155;break;case 162:e.next=167;break;case 164:e.prev=164,e.t10=e.catch(153),F.e(e.t10);case 167:return e.prev=167,F.f(),e.finish(167);case 170:if(!D){e.next=195;break}if(!((z=D.querySelector("canvas"))&&z.width>0&&z.height>0)){e.next=192;break}return e.prev=173,V=z._threeRenderer||D._threeRenderer,U=D._threeScene,G=D._threeCamera,V&&U&&G&&V.render(U,G),J=z.toDataURL("image/png",1),($=document.createElement("img")).src=J,$.style.cssText="width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px; margin: 0.5em 0;",$.alt="STL 3D Model",j.parentNode.replaceChild($,j),e.abrupt("continue",209);case 187:e.prev=187,e.t11=e.catch(173),console.warn("Failed to convert STL canvas to image (likely WebGL context issue):",e.t11);case 190:e.next=193;break;case 192:console.warn("No valid canvas found in STL container");case 193:e.next=196;break;case 195:console.warn("Could not find original STL container");case 196:(W=document.createElement("div")).style.cssText="padding: 12px; background-color: #f0f0f0; border: 1px solid #ccc; text-align: center; margin: 0.5em 0;",W.textContent="[STL 3D Model - Interactive content not available in copy]",j.parentNode.replaceChild(W,j),e.next=209;break;case 202:e.prev=202,e.t12=e.catch(145),console.error("Error processing STL container for copy:",e.t12),(K=document.createElement("div")).style.cssText="padding: 12px; background-color: #f0f0f0; border: 1px solid #ccc; text-align: center; margin: 0.5em 0;",K.textContent="[STL 3D Model - Interactive content not available in copy]",j.parentNode.replaceChild(K,j);case 209:e.next=143;break;case 211:e.next=216;break;case 213:e.prev=213,e.t13=e.catch(141),N.e(e.t13);case 216:return e.prev=216,N.f(),e.finish(216);case 219:if(Y='\n          <html xmlns:v="urn:schemas-microsoft-com:vml"\n                xmlns:o="urn:schemas-microsoft-com:office:office"\n                xmlns:w="urn:schemas-microsoft-com:office:word">\n            <head>\n              <meta charset="utf-8">\n              <style>\n                table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }\n                th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n                th { background-color: #f0f0f0; font-weight: bold; }\n\n                /* Code block styling */\n                .hljs { display: block; overflow-x: auto; padding: 1em; }\n                .hljs-keyword { color: #0033B3; }\n                .hljs-string { color: #067D17; }\n                .hljs-comment { color: #8C8C8C; }\n                .hljs-function { color: #00627A; }\n                .hljs-number { color: #1750EB; }\n                .hljs-operator { color: #687687; }\n                .hljs-punctuation { color: #000000; }\n\n                /* Word-specific image handling */\n                img { display: block; max-width: none; }\n              </style>\n            </head>\n            <body>\n              '.concat(r.innerHTML,"\n            </body>\n          </html>"),"macos"!==this.getPlatform()){e.next=233;break}return e.prev=222,e.next=225,navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([Y],{type:"text/html"}),"text/plain":new Blob([r.innerText],{type:"text/plain"})})]);case 225:e.next=231;break;case 227:if(e.prev=227,e.t14=e.catch(222),this.copyToClipboard(Y)){e.next=231;break}throw new Error("Fallback copy failed");case 231:e.next=257;break;case 233:return(Q=document.createElement("div")).style.position="fixed",Q.style.left="-9999px",Q.style.top="0",Q.innerHTML=Y,document.body.appendChild(Q),e.prev=239,e.next=242,navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([Y],{type:"text/html"}),"text/plain":new Blob([r.innerText],{type:"text/plain"})})]);case 242:e.next=254;break;case 244:if(e.prev=244,e.t15=e.catch(239),X=window.getSelection(),(Z=document.createRange()).selectNodeContents(Q),X.removeAllRanges(),X.addRange(Z),document.execCommand("copy")){e.next=254;break}throw new Error("Fallback copy failed");case 254:return e.prev=254,Q&&Q.parentNode&&document.body.removeChild(Q),e.finish(254);case 257:t.textContent="Copied!",e.next=264;break;case 260:e.prev=260,e.t16=e.catch(2),console.error("Copy HTML failed:",e.t16),t.textContent="Copy failed";case 264:setTimeout((function(){t.textContent="Copy Rendered"}),2e3);case 265:case"end":return e.stop()}}),e,this,[[2,260],[10,19,22,25],[27,38,41,44],[47,58,61,64],[66,132,135,138],[70,121],[78,89,92,95],[96,109],[141,213,216,219],[145,202],[153,164,167,170],[173,187],[222,227],[239,244,254,257]])}))),function(){return u.apply(this,arguments)})},{key:"svgToPng",value:function(e){return new Promise((function(t,n){var r,i,o=(new XMLSerializer).serializeToString(e),a=document.createElement("canvas"),s=a.getContext("2d"),c=new Image,l=e.closest(".mermaid")||e.classList.contains("mermaid"),u=e.getAttribute("width")&&e.getAttribute("height");l||!u?(r=e.clientWidth||e.viewBox&&e.viewBox.baseVal.width||parseFloat(e.getAttribute("width"))||400,i=e.clientHeight||e.viewBox&&e.viewBox.baseVal.height||parseFloat(e.getAttribute("height"))||300):(r=parseFloat(e.getAttribute("width"))||e.viewBox&&e.viewBox.baseVal.width||e.clientWidth||400,i=parseFloat(e.getAttribute("height"))||e.viewBox&&e.viewBox.baseVal.height||e.clientHeight||300);var d=o;if(r&&i){var h=document.createElement("div");h.innerHTML=o;var p=h.querySelector("svg");p&&(p.setAttribute("width",r.toString()),p.setAttribute("height",i.toString()),d=(new XMLSerializer).serializeToString(p))}a.width=2*r,a.height=2*i,s.scale(2,2),c.onload=function(){try{s.clearRect(0,0,a.width,a.height),s.drawImage(c,0,0,r,i),a.toBlob((function(e){t(e)}),"image/png",1)}catch(e){n(e)}},c.onerror=n;var f="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(d));c.src=f}))}},{key:"controlsShow",value:function(e){this.controls.style.display=e?"":"none",this.options.showControls=e,this.adjustLayout(),this.events.emit("controls:visibility",e)}},{key:"titleShow",value:function(e){this.title.style.display=e?"":"none",this.options.titleShow=e,this.adjustLayout(),this.events.emit("title:visibility",e)}},{key:"titleSetContent",value:function(e){this.title.innerHTML=e,this.options.titleContent=e,this.events.emit("title:content",e)}},{key:"titleGetContent",value:function(){return this.title.innerHTML}},{key:"toggleView",value:function(){"src"===this.currentView?this.setView("split"):"split"===this.currentView?this.setView("html"):this.setView("src")}},{key:"copyToClipboard",value:function(e){var t,n;try{(t=document.createElement("textarea")).setAttribute("readonly",!0),t.setAttribute("contenteditable",!0),t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.opacity="0",t.value=e,document.body.appendChild(t),t.focus(),t.select();var r=document.createRange();r.selectNodeContents(t);var i=window.getSelection();i.removeAllRanges(),i.addRange(r),t.setSelectionRange(0,t.value.length),n=document.execCommand("copy")}catch(e){console.error(e),n=null}finally{t&&t.parentNode&&document.body.removeChild(t)}if(!n){var o=navigator.platform.toUpperCase().indexOf("MAC")>=0;if(!(n=prompt("Press ".concat(o?"⌘C":"CTRL+C"),e)))return!1}return!0}},{key:"mathToPng",value:(i=o(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{var r=t.querySelector("svg");if(!r)return void n(new Error("No SVG found in math element"));var i=(new XMLSerializer).serializeToString(r),o=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(o),s=new Image;s.onload=function(){var t=document.createElement("canvas");t.width=r.width.baseVal.value,t.height=r.height.baseVal.value;var n=t.getContext("2d");n.fillStyle="#FFFFFF",n.fillRect(0,0,t.width,t.height),n.drawImage(s,0,0,t.width,t.height),URL.revokeObjectURL(a),t.toBlob(e,"image/png")},s.onerror=function(){URL.revokeObjectURL(a),n(new Error("Failed to load SVG image"))},s.src=a}catch(e){n(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"isMathJax3Available",value:function(){return"undefined"!=typeof MathJax&&"function"==typeof MathJax.typesetPromise&&("function"==typeof MathJax.tex2svgPromise||"undefined"!=typeof jest&&MathJax.version)}},{key:"mathCHTMLToPng",value:(r=o(h().mark((function e(t){var n,r,i,o,a,s,c,l;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==(n=t.getBoundingClientRect()).width&&0!==n.height){e.next=5;break}return console.warn("CHTML container has zero dimensions"),e.abrupt("return",null);case 5:return r=document.createElement("canvas"),i=r.getContext("2d"),o=n.width+16,a=n.height+16,r.width=2*o,r.height=2*a,r.style.width=o+"px",r.style.height=a+"px",i.scale(2,2),i.fillStyle="white",i.fillRect(0,0,o,a),s='\n        <svg width="'.concat(o,'" height="').concat(a,'" xmlns="http://www.w3.org/2000/svg">\n          <foreignObject x="').concat(8,'" y="').concat(8,'" width="').concat(n.width,'" height="').concat(n.height,'">\n            <div xmlns="http://www.w3.org/1999/xhtml" style="font-size: 16px; font-family: \'Times New Roman\', serif;">\n              ').concat(t.outerHTML,"\n            </div>\n          </foreignObject>\n        </svg>\n      "),c=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),l=URL.createObjectURL(c),e.abrupt("return",new Promise((function(e,t){var n=new Image;n.onload=function(){try{i.drawImage(n,0,0,o,a),URL.revokeObjectURL(l),r.toBlob(e,"image/png")}catch(e){URL.revokeObjectURL(l),t(e)}},n.onerror=function(){URL.revokeObjectURL(l),t(new Error("Failed to load CHTML as image"))},n.src=l})));case 24:return e.prev=24,e.t0=e.catch(0),console.error("CHTML to PNG conversion failed:",e.t0),e.abrupt("return",null);case 28:case"end":return e.stop()}}),e,null,[[0,24]])}))),function(e){return r.apply(this,arguments)})},{key:"getPlatform",value:function(){var e=navigator.platform.toLowerCase(),t=navigator.userAgent.toLowerCase();return e.includes("mac")||t.includes("mac")?"macos":t.includes("windows")?"windows":t.includes("linux")?"linux":"unknown"}},{key:"demonstrateSelectionFeatures",value:function(){console.log("See method documentation for usage examples")}},{key:"makeHTMLPageFromDiv",value:function(e){var t='<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Markdown Viewer with Graphics Support</title>\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">\n  <xscripx src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></xscripx>\n  <xscripx src="https://unpkg.com/mermaid/dist/mermaid.min.js"></xscripx>\n  <style>\n      body {\n          font-family: Arial, sans-serif;\n          box-sizing: border-box;\n          padding: 20px;\n      }\n      .squibview-output {\n          width: 50%;\n          margin: auto;\n      }\n      pre {\n          background-color: #f4f4f4;\n          padding: 10px;\n          border-radius: 5px;\n          overflow-x: auto;\n      }\n      table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: 20px 0;\n      }\n      table, th, td {\n          border: 1px solid black;\n      }\n      th, td {\n          padding: 8px;\n          text-align: left;\n      }\n  </style>\n</head>\n<body '.concat(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?'contenteditable="true"':"",">\n  ").concat(e,"\n</body>\n</html>");return t=t.replaceAll("xscripx","script")}},{key:"makeRevealJSFullPage",value:function(e){return'<!DOCTYPE html>\n  <html lang="en">\n  <head>\n      <meta charset="utf-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>'.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Slide Presentation",'</title>\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css">\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/black.css">\n      <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"><\/script>\n  </head>\n  <body>\n      <div class="reveal" contenteditable="true">\n          <div class="slides">\n              ').concat(e.split("---").map((function(e){return'<section data-markdown><script type="text/template">'.concat(e.trim(),"<\/script></section>")})).join("\n"),"\n          </div>\n      </div>\n      <script src=\"https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js\"><\/script>\n      <script src=\"https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js\"><\/script>\n      <script>\n          Reveal.initialize({\n              plugins: [ RevealMarkdown ]\n          });\n          \n          // Ensure Mermaid diagrams initialize correctly\n          document.addEventListener('DOMContentLoaded', () => {\n              mermaid.initialize({ startOnLoad: true , securityLevel: 'loose', theme: 'dark' });\n              document.querySelectorAll('.mermaid').forEach(el => {\n                  el.innerHTML = el.textContent;\n                  mermaid.init(undefined, el);\n              });\n          });\n      <\/script>\n  </body>\n  </html>")}},{key:"csvOrTsvToMarkdownTable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=y.parse(e,{delimiter:t,skipEmptyLines:!0}).data;if(0===n.length)return"No data found.";var r="| ".concat(n[0].join(" | ")," |"),i="| ".concat(n[0].map((function(){return"---"})).join(" | ")," |"),o=n.slice(1).map((function(e){return"| ".concat(e.join(" | ")," |")})).join("\n");return"".concat(r,"\n").concat(i,"\n").concat(o)}},{key:"preserveImageTags",get:function(){return this.options.preserveImageTags},set:function(e){this.options.preserveImageTags=e,this.renderMarkdown()}},{key:"fixLinefeedsInMarkdown",value:function(e){if("string"!=typeof e)return e;var t=e.split("\n"),n=!1;return t.map((function(e){return/^```/.test(e)?(n=!n,e):n||/^\s*([#\-*>]|\d+\.|\|)/.test(e)||""===e.trim()||/\s{2,}$/.test(e)?e:e+"  "})).join("\n")}},{key:"toggleLinefeedView",value:function(){this.linefeedViewEnabled=!this.linefeedViewEnabled,this.renderOutput()}},{key:"divToDataUrl",value:(t=o(h().mark((function e(t){var n=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){try{var i=t.getBoundingClientRect(),o=i.width||400,a=i.height||300;if(t.classList.contains("geojson-container")||t.id&&t.id.startsWith("map-")){var s=t.id;if(void 0!==window.L&&s&&window[s+"_map"]){var l=window[s+"_map"];if(l.getContainer)try{var u=l.getContainer(),d=u.getBoundingClientRect(),h=document.createElement("canvas");h.width=d.width,h.height=d.height;var p=h.getContext("2d");p.fillStyle="white",p.fillRect(0,0,h.width,h.height);var f=u.querySelectorAll(".leaflet-tile"),v=0,g=f.length;if(0===g){var m=h.toDataURL("image/png",1);return void e(m)}var y,b=c(f);try{var w=function(){var t=y.value,n=new Image;n.crossOrigin="anonymous",n.onload=function(){try{var r=t.getBoundingClientRect(),i=r.left-d.left,o=r.top-d.top;p.drawImage(n,i,o,r.width,r.height)}catch(e){console.warn("Failed to draw tile:",e)}if(++v===g){var a,s=c(u.querySelectorAll("svg"));try{var l=function(){var e=a.value;if(e.classList.contains("leaflet-attribution-flag"))return 1;try{var t=e.getBoundingClientRect(),n=t.left-d.left,r=t.top-d.top,i=(new XMLSerializer).serializeToString(e),o=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),s=URL.createObjectURL(o),c=new Image;c.onload=function(){p.drawImage(c,n,r),URL.revokeObjectURL(s)},c.src=s}catch(e){console.warn("Failed to draw SVG overlay:",e)}};for(s.s();!(a=s.n()).done;)l()}catch(e){s.e(e)}finally{s.f()}var f=h.toDataURL("image/png",1);e(f)}},n.onerror=function(){if(++v===g){var t=h.toDataURL("image/png",1);e(t)}},n.src=t.src};for(b.s();!(y=b.n()).done;)w()}catch(e){b.e(e)}finally{b.f()}return}catch(e){console.warn("Leaflet-specific approach failed:",e)}}}var x=t.querySelector("canvas");if(x&&x.width>0&&x.height>0)try{var k=x.toDataURL("image/png",1);return void e(k)}catch(e){console.warn("Canvas toDataURL failed, trying SVG approach:",e)}var S=t.querySelectorAll("svg");if(S.length>0){var C,T=null,E=0,_=c(S);try{for(_.s();!(C=_.n()).done;){var L=C.value;if(!L.classList.contains("leaflet-attribution-flag")){var R=(L.clientWidth||parseFloat(L.getAttribute("width"))||0)*(L.clientHeight||parseFloat(L.getAttribute("height"))||0);R>E&&R>100&&(E=R,T=L)}}}catch(e){_.e(e)}finally{_.f()}if(T)try{return void n.svgToPng(T).then((function(t){var n=new FileReader;n.onloadend=function(){return e(n.result)},n.readAsDataURL(t)})).catch(r)}catch(e){console.warn("SVG conversion failed, trying simple approach:",e)}}var A=document.createElement("canvas");A.width=o,A.height=a;var M=A.getContext("2d");M.fillStyle="white",M.fillRect(0,0,o,a),M.fillStyle="#666",M.font="16px Arial",M.textAlign="center",M.fillText("GeoJSON Map",o/2,a/2),M.fillText("(Interactive content)",o/2,a/2+20);var O=A.toDataURL("image/png",1);e(O)}catch(e){r(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"initializeLineNumbers",value:function(){var e=this;this.lineMirror=document.createElement("div"),this.lineMirror.className="".concat(this.options.baseClass,"-line-mirror"),this.lineMirror.setAttribute("aria-hidden","true"),this.container.appendChild(this.lineMirror),this.lastLineCount=0,this.setupLineNumberScrollSync(),this._lineNumberInputHandler=function(){e.updateLineNumbersIfNeeded()},this.input.addEventListener("input",this._lineNumberInputHandler),this._lineNumberResizeHandler=this.updateLineNumbersDebounced.bind(this),window.addEventListener("resize",this._lineNumberResizeHandler),this.updateLineNumbers()}},{key:"cleanupLineNumbers",value:function(){this._lineNumberInputHandler&&(this.input.removeEventListener("input",this._lineNumberInputHandler),this._lineNumberInputHandler=null),this._lineNumberResizeHandler&&(window.removeEventListener("resize",this._lineNumberResizeHandler),this._lineNumberResizeHandler=null),this.lineMirror&&this.lineMirror.parentNode&&this.lineMirror.parentNode.removeChild(this.lineMirror),this.lineMirror=void 0,this.lineGutter=void 0,this.sourcePanel=void 0}},{key:"setupLineNumberScrollSync",value:function(){var e=this;this.lineGutter&&this.input.addEventListener("scroll",(function(){e.lineGutter&&(e.lineGutter.scrollTop=e.input.scrollTop)}))}},{key:"updateLineNumbersIfNeeded",value:function(){var e=(this.input.value.match(/\n/g)||[]).length+1;e!==this.lastLineCount&&(this.lastLineCount=e,this.updateLineNumbersDebounced())}},{key:"updateLineNumbers",value:function(){var e=this;if(this.options.showLineNumbers&&this.lineGutter){var t=this.input.value.split("\n"),n=t.length,r=Math.max(this.options.lineNumberMinDigits,String(n+this.options.lineNumberStart-1).length);this.lineGutter.innerHTML="",this.syncMirrorStyles(),t.forEach((function(t,n){var i=e.options.lineNumberStart+n,o=String(i).padStart(r,"0"),a=e.measureLineHeight(t),s=document.createElement("div");s.className="".concat(e.options.baseClass,"-gutter-line"),s.textContent=o,s.style.height=a+"px",s.style.lineHeight=a+"px",e.lineGutter.appendChild(s)}))}}},{key:"measureLineHeight",value:function(e){var t=document.createElement("div");t.textContent=e||" ",t.style.wordBreak="break-all",t.style.whiteSpace="pre-wrap",t.style.overflow="hidden",this.lineMirror.appendChild(t);var n=t.getBoundingClientRect(),r=Math.ceil(n.height);return this.lineMirror.removeChild(t),r}},{key:"syncMirrorStyles",value:function(){var e=this,t=window.getComputedStyle(this.input);["fontFamily","fontSize","lineHeight","letterSpacing","paddingTop","paddingBottom","paddingLeft","paddingRight","borderTopWidth","borderBottomWidth","borderLeftWidth","borderRightWidth","boxSizing","whiteSpace","wordWrap","wordBreak","overflowWrap"].forEach((function(n){e.lineMirror.style[n]=t[n]})),this.lineMirror.style.width=this.input.clientWidth+"px"}},{key:"setLineNumbers",value:function(e){if(this.options.showLineNumbers!==e){this.options.showLineNumbers=e;var t=this.getContent(),n=this.inputContentType,r=this.currentView;!e&&this.lineMirror&&this.cleanupLineNumbers(),this.createStructure(),this.initializeEventHandlers(),this.initializeResizeObserver(),e&&this.initializeLineNumbers(),this.setContent(t,n,!1),this.setView(r),this.updateTypeButtons()}}},{key:"getLineNumbers",value:function(){return this.options.showLineNumbers}},{key:"setLineNumberStart",value:function(e){this.options.lineNumberStart=e,this.options.showLineNumbers&&this.updateLineNumbers()}},{key:"debounce",value:function(e,t){var n;return function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];clearTimeout(n),n=setTimeout((function(){clearTimeout(n),e.apply(void 0,i)}),t)}}}]);var t,r,i,u,f,v,g,m}();l(ee,"defaultOptions",{initialContent:"",inputContentType:"md",showControls:!0,titleShow:!1,titleContent:"",initialView:"split",baseClass:"squibview",onReplaceSelectedText:null,preserveImageTags:!0,showLineNumbers:!1,lineNumberStart:1,lineNumberMinDigits:2}),l(ee,"version",{version:"1.0.18",url:"https://github.com/deftio/squibview"});export{ee as default};
//# sourceMappingURL=squibview.esm-lean.min.js.map
