import e from"turndown";function t(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var o=function(){return t((function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),console.warn("[HtmlToMarkdown] CONSTRUCTOR CALLED"),this.turndownService=new e(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({headingStyle:"atx",codeBlockStyle:"fenced",emDelimiter:"*",bulletListMarker:"-"},a)),this.cache=new Map,this.cacheSize=a.cacheSize||10,this._specialBlocks=new Map,this.configureTurndownRules()}),[{key:"configureTurndownRules",value:function(){var e=this;this.turndownService.addRule("keepImageTags",{filter:"img",replacement:function(e,t){return t.outerHTML}}),this.turndownService.addRule("squibviewFencedBlock",{filter:function(e){var t="DIV"===e.nodeName&&e.hasAttribute("data-source-type");if(t){var n=e.getAttribute("data-source-type")||"code";console.warn('[HtmlToMarkdown] squibviewFencedBlock filter: Matched div with data-source-type="'.concat(n,'". Node outerHTML:'),e.outerHTML)}return t},replacement:function(t,n,r){var a=n.getAttribute("data-source-type")||"code",o="";switch(a){case"mermaid":case"math":var i=n.innerHTML;i=(i=i.replace(/<br\s*\/?>/gi,"\n")).replace(/<[^>]+>/g,"");var c=document.createElement("textarea");c.innerHTML=i,o=c.value.trim();break;case"svg":console.warn("[HtmlToMarkdown] squibviewFencedBlock REPLACEMENT for SVG. Node outerHTML:",n.outerHTML,"Node innerHTML:",n.innerHTML),o=n.innerHTML.trim();break;case"csv":case"tsv":case"psv":var s=n.querySelector("table");s?o=e._htmlTableToDelimitedText(s,a):(o="Error: Table not found for "+a,console.warn('Could not find table inside div[data-source-type="'+a+'"]'));break;default:var l=n.querySelector("pre");if(l)o=(l.querySelector("code")||l).textContent.trimEnd();else o=n.textContent.trimEnd(),console.warn('Could not find <pre> inside div[data-source-type="'+a+'"]')}var u="code"===a?"":a;return o&&!o.endsWith("\n")&&(o+="\n"),"\n```"+u+"\n"+o+"```\n"}}),this.turndownService.addRule("mermaid",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("mermaid")},replacement:function(t,n){var r="mermaid_"+Math.random().toString(36).substring(2,10);return e._specialBlocks&&e._specialBlocks.set(r,{type:"mermaid",content:n.textContent}),'\n<div data-special-block="'.concat(r,'" class="mermaid">\n')+n.textContent+"\n</div>\n"}}),this.turndownService.addRule("svg",{filter:function(e){var t="SVG"===e.nodeName,n=!(!e.parentElement||"DIV"!==e.parentElement.nodeName||"svg"!==e.parentElement.getAttribute("data-source-type"));return t&&console.warn("[HtmlToMarkdown] standalone 'svg' rule filter: Matched <svg>. Is child of SquibView SVG div? ".concat(n,". Node outerHTML:"),e.outerHTML),t&&!n},replacement:function(t,n){var r="svg_"+Math.random().toString(36).substring(2,10),a=(new XMLSerializer).serializeToString(n);return e._specialBlocks&&e._specialBlocks.set(r,{type:"svg",content:a}),'\n<div data-special-block="'.concat(r,'" class="svg-container">\n')+a+"\n</div>\n"}}),this.turndownService.addRule("geojson",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("geojson-map")},replacement:function(t,n){var r="geojson_"+Math.random().toString(36).substring(2,10),a="";try{a=n.dataset.geojson||'{"type":"FeatureCollection","features":[]}'}catch(e){console.error("Error extracting GeoJSON data:",e)}return e._specialBlocks&&e._specialBlocks.set(r,{type:"geojson",content:a}),'\n<div data-special-block="'.concat(r,'" class="geojson-container">\n')+a+"\n</div>\n"}}),this.turndownService.addRule("math",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("math-display")},replacement:function(t,n){var r="math_"+Math.random().toString(36).substring(2,10),a=n.textContent;return a=a.replace(/^\$\$([\s\S]*)\$\$$/,"$1"),e._specialBlocks&&e._specialBlocks.set(r,{type:"math",content:a}),'\n<div data-special-block="'.concat(r,'" class="math-container">\n')+a+"\n</div>\n"}}),this.turndownService.addRule("codeBlock",{filter:function(e){return"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t){var n=t.firstChild.textContent,r="";if(t.firstChild.className){var a=t.firstChild.className.match(/language-(\w+)/);a&&(r=a[1])}return"\n```"+r+"\n"+n.trim()+"\n```\n"}}),this.turndownService.addRule("tableCell",{filter:["th","td"],replacement:function(e,t){return" "+e.trim()+" |"}}),this.turndownService.addRule("tableRow",{filter:"tr",replacement:function(e,t){if("THEAD"===t.parentNode.nodeName){var n=t.querySelectorAll("th, td").length;return"|"+e+("\n|"+" --- |".repeat(n))}return"|"+e+"\n"}}),this.turndownService.addRule("table",{filter:"table",replacement:function(t,n){if(n.parentElement&&n.parentElement.hasAttribute("data-source-type")){var r=n.parentElement.getAttribute("data-source-type");if("csv"===r||"tsv"===r||"psv"===r)return t}var a="",o=n.querySelector("thead tr");return o&&(a+="|",o.querySelectorAll("th").forEach((function(t){a+=" ".concat(e.turndownService.turndown(t.innerHTML).trim()," |")})),a+="\n|",o.querySelectorAll("th").forEach((function(){a+=" --- |"})),a+="\n"),n.querySelectorAll("tbody tr").forEach((function(t){a+="|",t.querySelectorAll("td").forEach((function(t){a+=" ".concat(e.turndownService.turndown(t.innerHTML).trim()," |")})),a+="\n"})),"\n"+a+"\n"}}),this.turndownService.keep(["li"]),this.turndownService.addRule("taskListItems",{filter:function(e){return"LI"===e.nodeName&&e.firstChild&&"INPUT"===e.firstChild.nodeName&&"checkbox"===e.firstChild.type},replacement:function(e,t){for(var n=t.firstChild,r=n.checked,a="",o=n.nextSibling;o;)a+=o.outerHTML||o.textContent,o=o.nextSibling;return(r?"[x] ":"[ ] ")+this.turndownService.turndown(a).trim()}})}},{key:"_getStringHash",value:function(e){for(var t=0,n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t.toString(36)}},{key:"convert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.warn("[HtmlToMarkdown] CONVERT METHOD CALLED. HTML input (first 100 chars):",e.substring(0,100)),this._specialBlocks.clear();var n=this._getStringHash(e);if(this.cache.has(n))return this.cache.get(n);var r=this.turndownService.turndown(e);if(r=this._postProcessMarkdown(r,t.originalSource),this.cache.set(n,r),this.cache.size>this.cacheSize){var a=this.cache.keys().next().value;this.cache.delete(a)}return r}},{key:"_postProcessMarkdown",value:function(e,t){e=(e=e.replace(/<div data-special-block="mermaid_[^"]*" class="mermaid">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```mermaid\n".concat(t.trim(),"\n```\n")}))).replace(/<div data-special-block="svg_[^"]*" class="svg-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){var n=t.match(/<svg[\s\S]*?<\/svg>/);return n?"\n```svg\n".concat(n[0],"\n```\n"):e}));if(e=(e=e.replace(/<div data-special-block="geojson_[^"]*" class="geojson-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){try{return JSON.parse(t),"\n```geojson\n".concat(t.trim(),"\n```\n")}catch(e){return console.error("Invalid GeoJSON data:",e),'\n```geojson\n{"type":"FeatureCollection","features":[]}\n```\n'}}))).replace(/<div data-special-block="math_[^"]*" class="math-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```math\n".concat(t.trim(),"\n```\n")})),t){for(var n,r=/```(\w+)\s*([\s\S]*?)```/g,a=0,o=[];null!==(n=r.exec(t));){var i=n[1];n[2],"mermaid"!==i&&"svg"!==i&&"geojson"!==i&&"math"!==i||o.push({type:i,content:n[0],index:a++})}var c=0,s=0,l=0,u=0;e=e.replace(/```mermaid\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"mermaid"===e.type}));return c<n.length?n[c++].content:e})),e=e.replace(/```svg\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"svg"===e.type}));return s<n.length?n[s++].content:e})),e=e.replace(/```geojson\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"geojson"===e.type}));return l<n.length?n[l++].content:e})),e=e.replace(/```math\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"math"===e.type}));return u<n.length?n[u++].content:e}))}return e}},{key:"_htmlTableToDelimitedText",value:function(e,t){var n;switch(t){case"csv":default:n=",";break;case"tsv":n="\t";break;case"psv":n="|"}var r=[];return e.querySelectorAll("tr").forEach((function(e){var t=[];e.querySelectorAll("th, td").forEach((function(e){var r=e.textContent||"";r=r.replace(/\r?\n|\r/g," ").trim(),","===n&&r.includes(",")&&(r='"'.concat(r.replace(/"/g,'""'),'"')),t.push(r)})),r.push(t.join(n))})),r.join("\n")}}])}();export{o as default};
//# sourceMappingURL=html-to-markdown.min.js.map
