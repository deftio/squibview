import e from"turndown";function t(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,r){return(t=a(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var c=function(){return t((function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.turndownService=new e(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({headingStyle:"atx",codeBlockStyle:"fenced",emDelimiter:"*",bulletListMarker:"-"},a)),this.cache=new Map,this.cacheSize=a.cacheSize||10,this._specialBlocks=new Map,this.configureTurndownRules()}),[{key:"configureTurndownRules",value:function(){var e=this;this.turndownService.addRule("squibviewFencedBlock",{filter:function(e){return"DIV"===e.nodeName&&e.hasAttribute("data-source-type")},replacement:function(t,r,n){var a=r.getAttribute("data-source-type")||"code",c="";switch(a){case"mermaid":case"math":var o=r.innerHTML;o=o.replace(/<br\s*\/?>/gi,"\n");var i=r.ownerDocument.createElement("div");i.innerHTML=o,c=i.textContent||i.innerText||"";break;case"svg":c=r.hasAttribute("data-original-source")?r.getAttribute("data-original-source"):r.innerHTML;break;case"csv":case"tsv":case"psv":var l=r.querySelector("table");l?c=e._htmlTableToDelimitedText(l,a):(c="Error: Table not found for "+a,console.warn('Could not find table inside div[data-source-type="'+a+'"]'));break;default:var s=r.querySelector("pre");if(s)c=(s.querySelector("code")||s).textContent;else c=r.textContent,console.warn('Could not find <pre> inside div[data-source-type="'+a+'"]')}var u="code"===a?"":a,d=c.trim();return"\n```"+u+(d=d?"\n"+d+"\n":"\n")+"```\n"}}),this.turndownService.addRule("keepImageTags",{filter:"img",replacement:function(e,t){return t.outerHTML}}),this.turndownService.addRule("mermaid",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("mermaid")},replacement:function(t,r){var n="mermaid_"+Math.random().toString(36).substring(2,10);return e._specialBlocks&&e._specialBlocks.set(n,{type:"mermaid",content:r.textContent}),'\n<div data-special-block="'.concat(n,'" class="mermaid">\n')+r.textContent+"\n</div>\n"}}),this.turndownService.addRule("geojson",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("geojson-map")},replacement:function(t,r){var n="geojson_"+Math.random().toString(36).substring(2,10),a="";try{a=r.dataset.geojson||'{"type":"FeatureCollection","features":[]}'}catch(e){console.error("Error extracting GeoJSON data:",e)}return e._specialBlocks&&e._specialBlocks.set(n,{type:"geojson",content:a}),'\n<div data-special-block="'.concat(n,'" class="geojson-container">\n')+a+"\n</div>\n"}}),this.turndownService.addRule("math",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("math-display")},replacement:function(t,r){var n="math_"+Math.random().toString(36).substring(2,10),a=r.textContent;return a=a.replace(/^\$\$([\s\S]*)\$\$$/,"$1"),e._specialBlocks&&e._specialBlocks.set(n,{type:"math",content:a}),'\n<div data-special-block="'.concat(n,'" class="math-container">\n')+a+"\n</div>\n"}}),this.turndownService.addRule("codeBlock",{filter:function(e){return"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t){var r=t.firstChild.textContent,n="";if(t.firstChild.className){var a=t.firstChild.className.match(/language-(\w+)/);a&&(n=a[1])}return"\n```"+n+"\n"+r.trim()+"\n```\n"}}),this.turndownService.addRule("tableCell",{filter:["th","td"],replacement:function(e,t){return" "+e.trim()+" |"}}),this.turndownService.addRule("tableRow",{filter:"tr",replacement:function(e,t){if("THEAD"===t.parentNode.nodeName){var r=t.querySelectorAll("th, td").length;return"|"+e+("\n|"+" --- |".repeat(r))}return"|"+e+"\n"}}),this.turndownService.addRule("table",{filter:"table",replacement:function(t,r){if(r.parentElement&&r.parentElement.hasAttribute("data-source-type")){var n=r.parentElement.getAttribute("data-source-type");if("csv"===n||"tsv"===n||"psv"===n)return t}var a="",c=r.querySelector("thead tr");return c&&(a+="|",c.querySelectorAll("th").forEach((function(t){a+=" ".concat(e.turndownService.turndown(t.innerHTML).trim()," |")})),a+="\n|",c.querySelectorAll("th").forEach((function(){a+=" --- |"})),a+="\n"),r.querySelectorAll("tbody tr").forEach((function(t){a+="|",t.querySelectorAll("td").forEach((function(t){a+=" ".concat(e.turndownService.turndown(t.innerHTML).trim()," |")})),a+="\n"})),"\n"+a+"\n"}}),this.turndownService.keep(["li"]),this.turndownService.addRule("taskListItems",{filter:function(e){return"LI"===e.nodeName&&e.firstChild&&"INPUT"===e.firstChild.nodeName&&"checkbox"===e.firstChild.type},replacement:function(e,t){for(var r=t.firstChild,n=r.checked,a="",c=r.nextSibling;c;)a+=c.outerHTML||c.textContent,c=c.nextSibling;return(n?"[x] ":"[ ] ")+this.turndownService.turndown(a).trim()}})}},{key:"_getStringHash",value:function(e){for(var t=0,r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t|=0}return t.toString(36)}},{key:"convert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._specialBlocks.clear(),this._placeholders=[];var r=this._getStringHash(e);if(this.cache.has(r))return this.cache.get(r);var n=this._preProcessSpecialContainers(e),a=this.turndownService.turndown(n);if(a=this._postProcessMarkdown(a,t.originalSource),this.cache.set(r,a),this.cache.size>this.cacheSize){var c=this.cache.keys().next().value;this.cache.delete(c)}return a}},{key:"_preProcessSpecialContainers",value:function(e){var t,r=this;if("undefined"==typeof document||!document.createElement)return console.warn("Document not available, skipping pre-processing"),this._placeholders=[],e;try{if((t=document.createElement("div")).innerHTML=e,"function"!=typeof t.querySelector)throw new Error("querySelector not available")}catch(t){return console.warn("DOM methods not available, using regex fallback for pre-processing"),this._regexFallbackPreProcess(e)}var n=t.querySelectorAll("div[data-source-type]"),a=[];return n.forEach((function(e,n){var c,o=e.getAttribute("data-source-type"),i="__SPECIAL_CONTAINER_".concat(n,"__");if("svg"===o&&e.hasAttribute("data-original-source"))c=e.getAttribute("data-original-source");else if("csv"===o||"tsv"===o||"psv"===o){var l=e.querySelector("table");c=l?r._htmlTableToDelimitedText(l,o):"Error: Table not found for "+o}else{var s=e.querySelector("pre");if(s)c=(s.querySelector("code")||s).textContent.trim();else c=e.textContent.trim()}a.push({placeholder:i,type:o,content:c});var u=t.ownerDocument.createElement("p");u.textContent=i,e.parentNode.replaceChild(u,e)})),this._placeholders=a,t.innerHTML}},{key:"_postProcessMarkdown",value:function(e,t){this._placeholders&&this._placeholders.length>0&&this._placeholders.forEach((function(t){var r=t.placeholder,n=t.type,a=t.content,c="\n```".concat(n,"\n").concat(a,"\n```\n"),o=r.replace(/_/g,"\\_").replace(/\\/g,"\\\\");e=(e=e.replace(new RegExp(o,"g"),c)).replace(new RegExp(r,"g"),c)}));e=(e=e.replace(/<div data-special-block="mermaid_[^"]*" class="mermaid">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```mermaid\n".concat(t.trim(),"\n```\n")}))).replace(/<div data-special-block="svg_[^"]*" class="svg-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){var r=t.match(/<svg[\s\S]*?<\/svg>/);return r?"\n```svg\n".concat(r[0],"\n```\n"):e}));if(e=(e=e.replace(/<div data-special-block="geojson_[^"]*" class="geojson-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){try{return JSON.parse(t),"\n```geojson\n".concat(t.trim(),"\n```\n")}catch(e){return console.error("Invalid GeoJSON data:",e),'\n```geojson\n{"type":"FeatureCollection","features":[]}\n```\n'}}))).replace(/<div data-special-block="math_[^"]*" class="math-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```math\n".concat(t.trim(),"\n```\n")})),t){for(var r,n=/```(\w+)\s*([\s\S]*?)```/g,a=0,c=[];null!==(r=n.exec(t));){var o=r[1];r[2],"mermaid"!==o&&"svg"!==o&&"geojson"!==o&&"math"!==o||c.push({type:o,content:r[0],index:a++})}var i=0,l=0,s=0,u=0;e=e.replace(/```mermaid\s*([\s\S]*?)```/g,(function(e,t){var r=c.filter((function(e){return"mermaid"===e.type}));return i<r.length?r[i++].content:e})),e=e.replace(/```svg\s*([\s\S]*?)```/g,(function(e,t){var r=c.filter((function(e){return"svg"===e.type}));return l<r.length?r[l++].content:e})),e=e.replace(/```geojson\s*([\s\S]*?)```/g,(function(e,t){var r=c.filter((function(e){return"geojson"===e.type}));return s<r.length?r[s++].content:e})),e=e.replace(/```math\s*([\s\S]*?)```/g,(function(e,t){var r=c.filter((function(e){return"math"===e.type}));return u<r.length?r[u++].content:e}))}return e}},{key:"_htmlTableToDelimitedText",value:function(e,t){var r;switch(t){case"csv":default:r=",";break;case"tsv":r="\t";break;case"psv":r="|"}var n=[];return e.querySelectorAll("tr").forEach((function(e){var t=[];e.querySelectorAll("th, td").forEach((function(e){var n=e.textContent||"";n=n.replace(/\r?\n|\r/g," ").trim(),","===r&&n.includes(",")&&(n='"'.concat(n.replace(/"/g,'""'),'"')),t.push(n)})),n.push(t.join(r))})),n.join("\n")}},{key:"_regexFallbackPreProcess",value:function(e){var t=[],r=0,n=e.replace(/<div[^>]*data-source-type="([^"]*)"[^>]*>([\s\S]*?)<\/div>/g,(function(e,n,a){var c,o="__SPECIAL_CONTAINER_".concat(r,"__");if("svg"===n){var i=e.match(/data-original-source="([^"]*)"/);if(i)c=i[1].replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");else{var l=a.match(/<svg[\s\S]*?<\/svg>/);c=l?l[0]:a}}else if("csv"===n||"tsv"===n||"psv"===n)c="TABLE_PLACEHOLDER";else{var s=a.match(/<pre[^>]*><code[^>]*>([\s\S]*?)<\/code><\/pre>/);c=s?s[1].replace(/<span[^>]*>/g,"").replace(/<\/span>/g,"").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):a}return t.push({placeholder:o,type:n,content:c}),r++,"<p>".concat(o,"</p>")}));return this._placeholders=t,n}}])}();export{c as default};
//# sourceMappingURL=html-to-markdown.min.js.map
