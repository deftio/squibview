import e from"turndown";function t(e,t,r){return function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var a=function(){return t((function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.turndownService=new e(function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({headingStyle:"atx",codeBlockStyle:"fenced",emDelimiter:"*",bulletListMarker:"-"},i)),this.cache=new Map,this.cacheSize=i.cacheSize||10,this._specialBlocks=new Map,this.configureTurndownRules()}),[{key:"configureTurndownRules",value:function(){var e=this;this.turndownService.addRule("mermaid",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("mermaid")},replacement:function(t,r){var n="mermaid_"+Math.random().toString(36).substring(2,10);return e._specialBlocks&&e._specialBlocks.set(n,{type:"mermaid",content:r.textContent}),'\n<div data-special-block="'.concat(n,'" class="mermaid">\n')+r.textContent+"\n</div>\n"}}),this.turndownService.addRule("svg",{filter:"svg",replacement:function(t,r){var n="svg_"+Math.random().toString(36).substring(2,10),i=(new XMLSerializer).serializeToString(r);return e._specialBlocks&&e._specialBlocks.set(n,{type:"svg",content:i}),'\n<div data-special-block="'.concat(n,'" class="svg-container">\n')+i+"\n</div>\n"}}),this.turndownService.addRule("codeBlock",{filter:function(e){return"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t){var r=t.firstChild.textContent,n="";if(t.firstChild.className){var i=t.firstChild.className.match(/language-(\w+)/);i&&(n=i[1])}return"\n```"+n+"\n"+r.trim()+"\n```\n"}}),this.turndownService.addRule("tableCell",{filter:["th","td"],replacement:function(e,t){return" "+e.trim()+" |"}}),this.turndownService.addRule("tableRow",{filter:"tr",replacement:function(e,t){if("THEAD"===t.parentNode.nodeName){var r=t.querySelectorAll("th, td").length;return"|"+e+("\n|"+" --- |".repeat(r))}return"|"+e+"\n"}}),this.turndownService.addRule("table",{filter:"table",replacement:function(e,t){if(!t.querySelector("thead")&&t.querySelector("tr")){var r=t.querySelector("tr").querySelectorAll("th, td").length,n="\n|"+" --- |".repeat(r)+"\n",i=e.split("\n");if(i.length>0)return i[0]+n+i.slice(1).join("\n")+"\n\n"}return e+"\n\n"}})}},{key:"_getStringHash",value:function(e){for(var t=0,r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t|=0}return t.toString(36)}},{key:"convert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._specialBlocks.clear();var r=this._getStringHash(e);if(this.cache.has(r))return this.cache.get(r);var n=this.turndownService.turndown(e);if(n=this._postProcessMarkdown(n,t.originalSource),this.cache.set(r,n),this.cache.size>this.cacheSize){var i=this.cache.keys().next().value;this.cache.delete(i)}return n}},{key:"_postProcessMarkdown",value:function(e,t){if(e=(e=e.replace(/<div data-special-block="mermaid_[^"]*" class="mermaid">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```mermaid\n".concat(t.trim(),"\n```\n")}))).replace(/<div data-special-block="svg_[^"]*" class="svg-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){var r=t.match(/<svg[\s\S]*?<\/svg>/);return r?"\n```svg\n".concat(r[0],"\n```\n"):e})),t){for(var r,n=/```(\w+)\s*([\s\S]*?)```/g,i=0,a=[];null!==(r=n.exec(t));){var c=r[1];r[2],"mermaid"!==c&&"svg"!==c||a.push({type:c,content:r[0],index:i++})}var o=0,l=0;e=e.replace(/```mermaid\s*([\s\S]*?)```/g,(function(e,t){var r=a.filter((function(e){return"mermaid"===e.type}));return o<r.length?r[o++].content:e})),e=e.replace(/```svg\s*([\s\S]*?)```/g,(function(e,t){var r=a.filter((function(e){return"svg"===e.type}));return l<r.length?r[l++].content:e}))}return e}}])}();export{a as default};
//# sourceMappingURL=html-to-markdown.min.js.map
