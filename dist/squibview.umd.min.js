!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("markdown-it"),require("stream")):"function"==typeof define&&define.amd?define(["markdown-it","stream"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).SquibView=t(e.markdownit,e.require$$0)}(this,(function(e,t){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var a=e.apply(t,n);function s(e){r(a,i,o,s,l,"next",e)}function l(e){r(a,i,o,s,l,"throw",e)}s(void 0)}))}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=v(e))||t){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function l(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(){h=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof y?t:y,a=Object.create(o.prototype),s=new R(r||[]);return i(a,"_invoke",{value:E(e,n,s)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d="suspendedStart",p="suspendedYield",g="executing",v="completed",m={};function y(){}function b(){}function w(){}var x={};c(x,a,(function(){return this}));var _=Object.getPrototypeOf,k=_&&_(_(O([])));k&&k!==n&&r.call(k,a)&&(x=k);var S=w.prototype=y.prototype=Object.create(x);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,o,a,s){var l=f(e[i],e,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return o=o?o.then(i,i):i()}})}function E(t,n,r){var i=d;return function(o,a){if(i===g)throw Error("Generator is already running");if(i===v){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var l=M(s,r);if(l){if(l===m)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var c=f(t,n,r);if("normal"===c.type){if(i=r.done?v:p,c.arg===m)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function M(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,M(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=f(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return b.prototype=w,i(S,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=c(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},C(T.prototype),c(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new T(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(S),c(S,l,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t);else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function v(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function m(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var y={exports:{}};function b(){}b.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function i(){r.off(e,i),t.apply(n,arguments)}return i._=t,this.on(e,i,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var o=0,a=r.length;o<a;o++)r[o].fn!==t&&r[o].fn._!==t&&i.push(r[o]);return i.length?n[e]=i:delete n[e],this}},y.exports=b,y.exports.TinyEmitter=b;var w=m(y.exports),x={exports:{}};!function(e){var t=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},n=-1;t.Diff=function(e,t){return[e,t]},t.prototype.diff_main=function(e,n,r,i){void 0===i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=i;if(null==e||null==n)throw new Error("Null input. (diff_main)");if(e==n)return e?[new t.Diff(0,e)]:[];void 0===r&&(r=!0);var a=r,s=this.diff_commonPrefix(e,n),l=e.substring(0,s);e=e.substring(s),n=n.substring(s),s=this.diff_commonSuffix(e,n);var c=e.substring(e.length-s);e=e.substring(0,e.length-s),n=n.substring(0,n.length-s);var u=this.diff_compute_(e,n,a,o);return l&&u.unshift(new t.Diff(0,l)),c&&u.push(new t.Diff(0,c)),this.diff_cleanupMerge(u),u},t.prototype.diff_compute_=function(e,r,i,o){var a;if(!e)return[new t.Diff(1,r)];if(!r)return[new t.Diff(n,e)];var s=e.length>r.length?e:r,l=e.length>r.length?r:e,c=s.indexOf(l);if(-1!=c)return a=[new t.Diff(1,s.substring(0,c)),new t.Diff(0,l),new t.Diff(1,s.substring(c+l.length))],e.length>r.length&&(a[0][0]=a[2][0]=n),a;if(1==l.length)return[new t.Diff(n,e),new t.Diff(1,r)];var u=this.diff_halfMatch_(e,r);if(u){var h=u[0],f=u[1],d=u[2],p=u[3],g=u[4],v=this.diff_main(h,d,i,o),m=this.diff_main(f,p,i,o);return v.concat([new t.Diff(0,g)],m)}return i&&e.length>100&&r.length>100?this.diff_lineMode_(e,r,o):this.diff_bisect_(e,r,o)},t.prototype.diff_lineMode_=function(e,r,i){var o=this.diff_linesToChars_(e,r);e=o.chars1,r=o.chars2;var a=o.lineArray,s=this.diff_main(e,r,!1,i);this.diff_charsToLines_(s,a),this.diff_cleanupSemantic(s),s.push(new t.Diff(0,""));for(var l=0,c=0,u=0,h="",f="";l<s.length;){switch(s[l][0]){case 1:u++,f+=s[l][1];break;case n:c++,h+=s[l][1];break;case 0:if(c>=1&&u>=1){s.splice(l-c-u,c+u),l=l-c-u;for(var d=this.diff_main(h,f,!1,i),p=d.length-1;p>=0;p--)s.splice(l,0,d[p]);l+=d.length}u=0,c=0,h="",f=""}l++}return s.pop(),s},t.prototype.diff_bisect_=function(e,r,i){for(var o=e.length,a=r.length,s=Math.ceil((o+a)/2),l=s,c=2*s,u=new Array(c),h=new Array(c),f=0;f<c;f++)u[f]=-1,h[f]=-1;u[l+1]=0,h[l+1]=0;for(var d=o-a,p=d%2!=0,g=0,v=0,m=0,y=0,b=0;b<s&&!((new Date).getTime()>i);b++){for(var w=-b+g;w<=b-v;w+=2){for(var x=l+w,_=(E=w==-b||w!=b&&u[x-1]<u[x+1]?u[x+1]:u[x-1]+1)-w;E<o&&_<a&&e.charAt(E)==r.charAt(_);)E++,_++;if(u[x]=E,E>o)v+=2;else if(_>a)g+=2;else if(p){if((C=l+d-w)>=0&&C<c&&-1!=h[C])if(E>=(S=o-h[C]))return this.diff_bisectSplit_(e,r,E,_,i)}}for(var k=-b+m;k<=b-y;k+=2){for(var S,C=l+k,T=(S=k==-b||k!=b&&h[C-1]<h[C+1]?h[C+1]:h[C-1]+1)-k;S<o&&T<a&&e.charAt(o-S-1)==r.charAt(a-T-1);)S++,T++;if(h[C]=S,S>o)y+=2;else if(T>a)m+=2;else if(!p){if((x=l+d-k)>=0&&x<c&&-1!=u[x]){var E;_=l+(E=u[x])-x;if(E>=(S=o-S))return this.diff_bisectSplit_(e,r,E,_,i)}}}}return[new t.Diff(n,e),new t.Diff(1,r)]},t.prototype.diff_bisectSplit_=function(e,t,n,r,i){var o=e.substring(0,n),a=t.substring(0,r),s=e.substring(n),l=t.substring(r),c=this.diff_main(o,a,!1,i),u=this.diff_main(s,l,!1,i);return c.concat(u)},t.prototype.diff_linesToChars_=function(e,t){var n=[],r={};function i(e){for(var t="",i=0,a=-1,s=n.length;a<e.length-1;){-1==(a=e.indexOf("\n",i))&&(a=e.length-1);var l=e.substring(i,a+1);(r.hasOwnProperty?r.hasOwnProperty(l):void 0!==r[l])?t+=String.fromCharCode(r[l]):(s==o&&(l=e.substring(i),a=e.length),t+=String.fromCharCode(s),r[l]=s,n[s++]=l),i=a+1}return t}n[0]="";var o=4e4,a=i(e);return o=65535,{chars1:a,chars2:i(t),lineArray:n}},t.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var r=e[n][1],i=[],o=0;o<r.length;o++)i[o]=t[r.charCodeAt(o)];e[n][1]=i.join("")}},t.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(o,i)==t.substring(o,i)?o=n=i:r=i,i=Math.floor((r-n)/2+n);return i},t.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,o=0;n<i;)e.substring(e.length-i,e.length-o)==t.substring(t.length-i,t.length-o)?o=n=i:r=i,i=Math.floor((r-n)/2+n);return i},t.prototype.diff_commonOverlap_=function(e,t){var n=e.length,r=t.length;if(0==n||0==r)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var o=0,a=1;;){var s=e.substring(i-a),l=t.indexOf(s);if(-1==l)return o;a+=l,0!=l&&e.substring(i-a)!=t.substring(0,a)||(o=a,a++)}},t.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,r=e.length>t.length?t:e;if(n.length<4||2*r.length<n.length)return null;var i=this;function o(e,t,n){for(var r,o,a,s,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,u="";-1!=(c=t.indexOf(l,c+1));){var h=i.diff_commonPrefix(e.substring(n),t.substring(c)),f=i.diff_commonSuffix(e.substring(0,n),t.substring(0,c));u.length<f+h&&(u=t.substring(c-f,c)+t.substring(c,c+h),r=e.substring(0,n-f),o=e.substring(n+h),a=t.substring(0,c-f),s=t.substring(c+h))}return 2*u.length>=e.length?[r,o,a,s,u]:null}var a,s,l,c,u,h=o(n,r,Math.ceil(n.length/4)),f=o(n,r,Math.ceil(n.length/2));return h||f?(a=f?h&&h[4].length>f[4].length?h:f:h,e.length>t.length?(s=a[0],l=a[1],c=a[2],u=a[3]):(c=a[0],u=a[1],s=a[2],l=a[3]),[s,l,c,u,a[4]]):null},t.prototype.diff_cleanupSemantic=function(e){for(var r=!1,i=[],o=0,a=null,s=0,l=0,c=0,u=0,h=0;s<e.length;)0==e[s][0]?(i[o++]=s,l=u,c=h,u=0,h=0,a=e[s][1]):(1==e[s][0]?u+=e[s][1].length:h+=e[s][1].length,a&&a.length<=Math.max(l,c)&&a.length<=Math.max(u,h)&&(e.splice(i[o-1],0,new t.Diff(n,a)),e[i[o-1]+1][0]=1,o--,s=--o>0?i[o-1]:-1,l=0,c=0,u=0,h=0,a=null,r=!0)),s++;for(r&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),s=1;s<e.length;){if(e[s-1][0]==n&&1==e[s][0]){var f=e[s-1][1],d=e[s][1],p=this.diff_commonOverlap_(f,d),g=this.diff_commonOverlap_(d,f);p>=g?(p>=f.length/2||p>=d.length/2)&&(e.splice(s,0,new t.Diff(0,d.substring(0,p))),e[s-1][1]=f.substring(0,f.length-p),e[s+1][1]=d.substring(p),s++):(g>=f.length/2||g>=d.length/2)&&(e.splice(s,0,new t.Diff(0,f.substring(0,g))),e[s-1][0]=1,e[s-1][1]=d.substring(0,d.length-g),e[s+1][0]=n,e[s+1][1]=f.substring(g),s++),s++}s++}},t.prototype.diff_cleanupSemanticLossless=function(e){function n(e,n){if(!e||!n)return 6;var r=e.charAt(e.length-1),i=n.charAt(0),o=r.match(t.nonAlphaNumericRegex_),a=i.match(t.nonAlphaNumericRegex_),s=o&&r.match(t.whitespaceRegex_),l=a&&i.match(t.whitespaceRegex_),c=s&&r.match(t.linebreakRegex_),u=l&&i.match(t.linebreakRegex_),h=c&&e.match(t.blanklineEndRegex_),f=u&&n.match(t.blanklineStartRegex_);return h||f?5:c||u?4:o&&!s&&l?3:s||l?2:o||a?1:0}for(var r=1;r<e.length-1;){if(0==e[r-1][0]&&0==e[r+1][0]){var i=e[r-1][1],o=e[r][1],a=e[r+1][1],s=this.diff_commonSuffix(i,o);if(s){var l=o.substring(o.length-s);i=i.substring(0,i.length-s),o=l+o.substring(0,o.length-s),a=l+a}for(var c=i,u=o,h=a,f=n(i,o)+n(o,a);o.charAt(0)===a.charAt(0);){i+=o.charAt(0),o=o.substring(1)+a.charAt(0),a=a.substring(1);var d=n(i,o)+n(o,a);d>=f&&(f=d,c=i,u=o,h=a)}e[r-1][1]!=c&&(c?e[r-1][1]=c:(e.splice(r-1,1),r--),e[r][1]=u,h?e[r+1][1]=h:(e.splice(r+1,1),r--))}r++}},t.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,t.whitespaceRegex_=/\s/,t.linebreakRegex_=/[\r\n]/,t.blanklineEndRegex_=/\n\r?\n$/,t.blanklineStartRegex_=/^\r?\n\r?\n/,t.prototype.diff_cleanupEfficiency=function(e){for(var r=!1,i=[],o=0,a=null,s=0,l=!1,c=!1,u=!1,h=!1;s<e.length;)0==e[s][0]?(e[s][1].length<this.Diff_EditCost&&(u||h)?(i[o++]=s,l=u,c=h,a=e[s][1]):(o=0,a=null),u=h=!1):(e[s][0]==n?h=!0:u=!0,a&&(l&&c&&u&&h||a.length<this.Diff_EditCost/2&&l+c+u+h==3)&&(e.splice(i[o-1],0,new t.Diff(n,a)),e[i[o-1]+1][0]=1,o--,a=null,l&&c?(u=h=!0,o=0):(s=--o>0?i[o-1]:-1,u=h=!1),r=!0)),s++;r&&this.diff_cleanupMerge(e)},t.prototype.diff_cleanupMerge=function(e){e.push(new t.Diff(0,""));for(var r,i=0,o=0,a=0,s="",l="";i<e.length;)switch(e[i][0]){case 1:a++,l+=e[i][1],i++;break;case n:o++,s+=e[i][1],i++;break;case 0:o+a>1?(0!==o&&0!==a&&(0!==(r=this.diff_commonPrefix(l,s))&&(i-o-a>0&&0==e[i-o-a-1][0]?e[i-o-a-1][1]+=l.substring(0,r):(e.splice(0,0,new t.Diff(0,l.substring(0,r))),i++),l=l.substring(r),s=s.substring(r)),0!==(r=this.diff_commonSuffix(l,s))&&(e[i][1]=l.substring(l.length-r)+e[i][1],l=l.substring(0,l.length-r),s=s.substring(0,s.length-r))),i-=o+a,e.splice(i,o+a),s.length&&(e.splice(i,0,new t.Diff(n,s)),i++),l.length&&(e.splice(i,0,new t.Diff(1,l)),i++),i++):0!==i&&0==e[i-1][0]?(e[i-1][1]+=e[i][1],e.splice(i,1)):i++,a=0,o=0,s="",l=""}""===e[e.length-1][1]&&e.pop();var c=!1;for(i=1;i<e.length-1;)0==e[i-1][0]&&0==e[i+1][0]&&(e[i][1].substring(e[i][1].length-e[i-1][1].length)==e[i-1][1]?(e[i][1]=e[i-1][1]+e[i][1].substring(0,e[i][1].length-e[i-1][1].length),e[i+1][1]=e[i-1][1]+e[i+1][1],e.splice(i-1,1),c=!0):e[i][1].substring(0,e[i+1][1].length)==e[i+1][1]&&(e[i-1][1]+=e[i+1][1],e[i][1]=e[i][1].substring(e[i+1][1].length)+e[i+1][1],e.splice(i+1,1),c=!0)),i++;c&&this.diff_cleanupMerge(e)},t.prototype.diff_xIndex=function(e,t){var r,i=0,o=0,a=0,s=0;for(r=0;r<e.length&&(1!==e[r][0]&&(i+=e[r][1].length),e[r][0]!==n&&(o+=e[r][1].length),!(i>t));r++)a=i,s=o;return e.length!=r&&e[r][0]===n?s:s+(t-a)},t.prototype.diff_prettyHtml=function(e){for(var t=[],r=/&/g,i=/</g,o=/>/g,a=/\n/g,s=0;s<e.length;s++){var l=e[s][0],c=e[s][1].replace(r,"&amp;").replace(i,"&lt;").replace(o,"&gt;").replace(a,"&para;<br>");switch(l){case 1:t[s]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case n:t[s]='<del style="background:#ffe6e6;">'+c+"</del>";break;case 0:t[s]="<span>"+c+"</span>"}}return t.join("")},t.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},t.prototype.diff_text2=function(e){for(var t=[],r=0;r<e.length;r++)e[r][0]!==n&&(t[r]=e[r][1]);return t.join("")},t.prototype.diff_levenshtein=function(e){for(var t=0,r=0,i=0,o=0;o<e.length;o++){var a=e[o][0],s=e[o][1];switch(a){case 1:r+=s.length;break;case n:i+=s.length;break;case 0:t+=Math.max(r,i),r=0,i=0}}return t+=Math.max(r,i)},t.prototype.diff_toDelta=function(e){for(var t=[],r=0;r<e.length;r++)switch(e[r][0]){case 1:t[r]="+"+encodeURI(e[r][1]);break;case n:t[r]="-"+e[r][1].length;break;case 0:t[r]="="+e[r][1].length}return t.join("\t").replace(/%20/g," ")},t.prototype.diff_fromDelta=function(e,r){for(var i=[],o=0,a=0,s=r.split(/\t/g),l=0;l<s.length;l++){var c=s[l].substring(1);switch(s[l].charAt(0)){case"+":try{i[o++]=new t.Diff(1,decodeURI(c))}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+c)}break;case"-":case"=":var u=parseInt(c,10);if(isNaN(u)||u<0)throw new Error("Invalid number in diff_fromDelta: "+c);var h=e.substring(a,a+=u);"="==s[l].charAt(0)?i[o++]=new t.Diff(0,h):i[o++]=new t.Diff(n,h);break;default:if(s[l])throw new Error("Invalid diff operation in diff_fromDelta: "+s[l])}}if(a!=e.length)throw new Error("Delta length ("+a+") does not equal source text length ("+e.length+").");return i},t.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},t.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(t),i=this;function o(e,r){var o=e/t.length,a=Math.abs(n-r);return i.Match_Distance?o+a/i.Match_Distance:a?1:o}var a=this.Match_Threshold,s=e.indexOf(t,n);-1!=s&&(a=Math.min(o(0,s),a),-1!=(s=e.lastIndexOf(t,n+t.length))&&(a=Math.min(o(0,s),a)));var l,c,u=1<<t.length-1;s=-1;for(var h,f=t.length+e.length,d=0;d<t.length;d++){for(l=0,c=f;l<c;)o(d,n+c)<=a?l=c:f=c,c=Math.floor((f-l)/2+l);f=c;var p=Math.max(1,n-c+1),g=Math.min(n+c,e.length)+t.length,v=Array(g+2);v[g+1]=(1<<d)-1;for(var m=g;m>=p;m--){var y=r[e.charAt(m-1)];if(v[m]=0===d?(v[m+1]<<1|1)&y:(v[m+1]<<1|1)&y|(h[m+1]|h[m])<<1|1|h[m+1],v[m]&u){var b=o(d,m-1);if(b<=a){if(a=b,!((s=m-1)>n))break;p=Math.max(1,2*n-s)}}}if(o(d+1,n)>a)break;h=v}return s},t.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},t.prototype.patch_addContext_=function(e,n){if(0!=n.length){if(null===e.start2)throw Error("patch not initialized");for(var r=n.substring(e.start2,e.start2+e.length1),i=0;n.indexOf(r)!=n.lastIndexOf(r)&&r.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,r=n.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin;var o=n.substring(e.start2-i,e.start2);o&&e.diffs.unshift(new t.Diff(0,o));var a=n.substring(e.start2+e.length1,e.start2+e.length1+i);a&&e.diffs.push(new t.Diff(0,a)),e.start1-=o.length,e.start2-=o.length,e.length1+=o.length+a.length,e.length2+=o.length+a.length}},t.prototype.patch_make=function(e,r,i){var o,a;if("string"==typeof e&&"string"==typeof r&&void 0===i)o=e,(a=this.diff_main(o,r,!0)).length>2&&(this.diff_cleanupSemantic(a),this.diff_cleanupEfficiency(a));else if(e&&"object"==g(e)&&void 0===r&&void 0===i)a=e,o=this.diff_text1(a);else if("string"==typeof e&&r&&"object"==g(r)&&void 0===i)o=e,a=r;else{if("string"!=typeof e||"string"!=typeof r||!i||"object"!=g(i))throw new Error("Unknown call format to patch_make.");o=e,a=i}if(0===a.length)return[];for(var s=[],l=new t.patch_obj,c=0,u=0,h=0,f=o,d=o,p=0;p<a.length;p++){var v=a[p][0],m=a[p][1];switch(c||0===v||(l.start1=u,l.start2=h),v){case 1:l.diffs[c++]=a[p],l.length2+=m.length,d=d.substring(0,h)+m+d.substring(h);break;case n:l.length1+=m.length,l.diffs[c++]=a[p],d=d.substring(0,h)+d.substring(h+m.length);break;case 0:m.length<=2*this.Patch_Margin&&c&&a.length!=p+1?(l.diffs[c++]=a[p],l.length1+=m.length,l.length2+=m.length):m.length>=2*this.Patch_Margin&&c&&(this.patch_addContext_(l,f),s.push(l),l=new t.patch_obj,c=0,f=d,u=h)}1!==v&&(u+=m.length),v!==n&&(h+=m.length)}return c&&(this.patch_addContext_(l,f),s.push(l)),s},t.prototype.patch_deepCopy=function(e){for(var n=[],r=0;r<e.length;r++){var i=e[r],o=new t.patch_obj;o.diffs=[];for(var a=0;a<i.diffs.length;a++)o.diffs[a]=new t.Diff(i.diffs[a][0],i.diffs[a][1]);o.start1=i.start1,o.start2=i.start2,o.length1=i.length1,o.length2=i.length2,n[r]=o}return n},t.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var r=this.patch_addPadding(e);t=r+t+r,this.patch_splitMax(e);for(var i=0,o=[],a=0;a<e.length;a++){var s,l,c=e[a].start2+i,u=this.diff_text1(e[a].diffs),h=-1;if(u.length>this.Match_MaxBits?-1!=(s=this.match_main(t,u.substring(0,this.Match_MaxBits),c))&&(-1==(h=this.match_main(t,u.substring(u.length-this.Match_MaxBits),c+u.length-this.Match_MaxBits))||s>=h)&&(s=-1):s=this.match_main(t,u,c),-1==s)o[a]=!1,i-=e[a].length2-e[a].length1;else if(o[a]=!0,i=s-c,u==(l=-1==h?t.substring(s,s+u.length):t.substring(s,h+this.Match_MaxBits)))t=t.substring(0,s)+this.diff_text2(e[a].diffs)+t.substring(s+u.length);else{var f=this.diff_main(u,l,!1);if(u.length>this.Match_MaxBits&&this.diff_levenshtein(f)/u.length>this.Patch_DeleteThreshold)o[a]=!1;else{this.diff_cleanupSemanticLossless(f);for(var d,p=0,g=0;g<e[a].diffs.length;g++){var v=e[a].diffs[g];0!==v[0]&&(d=this.diff_xIndex(f,p)),1===v[0]?t=t.substring(0,s+d)+v[1]+t.substring(s+d):v[0]===n&&(t=t.substring(0,s+d)+t.substring(s+this.diff_xIndex(f,p+v[1].length))),v[0]!==n&&(p+=v[1].length)}}}}return[t=t.substring(r.length,t.length-r.length),o]},t.prototype.patch_addPadding=function(e){for(var n=this.Patch_Margin,r="",i=1;i<=n;i++)r+=String.fromCharCode(i);for(i=0;i<e.length;i++)e[i].start1+=n,e[i].start2+=n;var o=e[0],a=o.diffs;if(0==a.length||0!=a[0][0])a.unshift(new t.Diff(0,r)),o.start1-=n,o.start2-=n,o.length1+=n,o.length2+=n;else if(n>a[0][1].length){var s=n-a[0][1].length;a[0][1]=r.substring(a[0][1].length)+a[0][1],o.start1-=s,o.start2-=s,o.length1+=s,o.length2+=s}if(0==(a=(o=e[e.length-1]).diffs).length||0!=a[a.length-1][0])a.push(new t.Diff(0,r)),o.length1+=n,o.length2+=n;else if(n>a[a.length-1][1].length){s=n-a[a.length-1][1].length;a[a.length-1][1]+=r.substring(0,s),o.length1+=s,o.length2+=s}return r},t.prototype.patch_splitMax=function(e){for(var r=this.Match_MaxBits,i=0;i<e.length;i++)if(!(e[i].length1<=r)){var o=e[i];e.splice(i--,1);for(var a=o.start1,s=o.start2,l="";0!==o.diffs.length;){var c=new t.patch_obj,u=!0;for(c.start1=a-l.length,c.start2=s-l.length,""!==l&&(c.length1=c.length2=l.length,c.diffs.push(new t.Diff(0,l)));0!==o.diffs.length&&c.length1<r-this.Patch_Margin;){var h=o.diffs[0][0],f=o.diffs[0][1];1===h?(c.length2+=f.length,s+=f.length,c.diffs.push(o.diffs.shift()),u=!1):h===n&&1==c.diffs.length&&0==c.diffs[0][0]&&f.length>2*r?(c.length1+=f.length,a+=f.length,u=!1,c.diffs.push(new t.Diff(h,f)),o.diffs.shift()):(f=f.substring(0,r-c.length1-this.Patch_Margin),c.length1+=f.length,a+=f.length,0===h?(c.length2+=f.length,s+=f.length):u=!1,c.diffs.push(new t.Diff(h,f)),f==o.diffs[0][1]?o.diffs.shift():o.diffs[0][1]=o.diffs[0][1].substring(f.length))}l=(l=this.diff_text2(c.diffs)).substring(l.length-this.Patch_Margin);var d=this.diff_text1(o.diffs).substring(0,this.Patch_Margin);""!==d&&(c.length1+=d.length,c.length2+=d.length,0!==c.diffs.length&&0===c.diffs[c.diffs.length-1][0]?c.diffs[c.diffs.length-1][1]+=d:c.diffs.push(new t.Diff(0,d))),u||e.splice(++i,0,c)}}},t.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},t.prototype.patch_fromText=function(e){var r=[];if(!e)return r;for(var i=e.split("\n"),o=0,a=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;o<i.length;){var s=i[o].match(a);if(!s)throw new Error("Invalid patch string: "+i[o]);var l=new t.patch_obj;for(r.push(l),l.start1=parseInt(s[1],10),""===s[2]?(l.start1--,l.length1=1):"0"==s[2]?l.length1=0:(l.start1--,l.length1=parseInt(s[2],10)),l.start2=parseInt(s[3],10),""===s[4]?(l.start2--,l.length2=1):"0"==s[4]?l.length2=0:(l.start2--,l.length2=parseInt(s[4],10)),o++;o<i.length;){var c=i[o].charAt(0);try{var u=decodeURI(i[o].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+u)}if("-"==c)l.diffs.push(new t.Diff(n,u));else if("+"==c)l.diffs.push(new t.Diff(1,u));else if(" "==c)l.diffs.push(new t.Diff(0,u));else{if("@"==c)break;if(""!==c)throw new Error('Invalid patch mode "'+c+'" in: '+u)}o++}}return r},(t.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0}).prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],r=0;r<this.diffs.length;r++){switch(this.diffs[r][0]){case 1:e="+";break;case n:e="-";break;case 0:e=" "}t[r+1]=e+encodeURI(this.diffs[r][1])+"\n"}return t.join("").replace(/%20/g," ")},e.exports=t,e.exports.diff_match_patch=t,e.exports.DIFF_DELETE=n,e.exports.DIFF_INSERT=1,e.exports.DIFF_EQUAL=0}(x);var _=m(x.exports);!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var l,c,u=this._events[s],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,o),!0;case 6:return u.fn.call(u.context,t,r,i,o,a),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var f,d=u.length;for(c=0;c<d;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(f=1,l=new Array(h-1);f<h;f++)l[f-1]=arguments[f];u[c].fn.apply(u[c].context,l)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var l=0,c=[],u=s.length;l<u;l++)(s[l].fn!==t||i&&!s[l].once||r&&s[l].context!==r)&&c.push(s[l]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}({exports:{}});var k={exports:{}};!function(e){e.exports=function e(){var n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{};function r(){var t=n.URL||n.webkitURL||null,r=e.toString();return l.BLOB_URL||(l.BLOB_URL=t.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",r,")();"],{type:"text/javascript"})))}var i=!n.document&&!!n.postMessage,o=n.IS_PAPA_WORKER||!1,a={},s=0,l={};if(l.parse=u,l.unparse=h,l.RECORD_SEP=String.fromCharCode(30),l.UNIT_SEP=String.fromCharCode(31),l.BYTE_ORDER_MARK="\ufeff",l.BAD_DELIMITERS=["\r","\n",'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!i&&!!n.Worker,l.NODE_STREAM_INPUT=1,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=_,l.ParserHandle=w,l.NetworkStreamer=p,l.FileStreamer=v,l.StringStreamer=m,l.ReadableStreamStreamer=y,"undefined"==typeof PAPA_BROWSER_CONTEXT&&(l.DuplexStreamStreamer=b),n.jQuery){var c=n.jQuery;c.fn.parse=function(e){var t=e.config||{},r=[];return this.each((function(e){if("INPUT"!==c(this).prop("tagName").toUpperCase()||"file"!==c(this).attr("type").toLowerCase()||!n.FileReader||!this.files||0===this.files.length)return!0;for(var i=0;i<this.files.length;i++)r.push({file:this.files[i],inputElem:this,instanceConfig:c.extend({},t)})})),i(),this;function i(){if(0!==r.length){var t=r[0];if(A(e.before)){var n=e.before(t.file,t.inputElem);if("object"===g(n)){if("abort"===n.action)return void o("AbortError",t.file,t.inputElem,n.reason);if("skip"===n.action)return void a();"object"===g(n.config)&&(t.instanceConfig=c.extend(t.instanceConfig,n.config))}else if("skip"===n)return void a()}var i=t.instanceConfig.complete;t.instanceConfig.complete=function(e){A(i)&&i(e,t.file,t.inputElem),a()},l.parse(t.file,t.instanceConfig)}else A(e.complete)&&e.complete()}function o(t,n,r,i){A(e.error)&&e.error({name:t},n,r,i)}function a(){r.splice(0,1),i()}}}function u(e,t){var r=(t=t||{}).dynamicTyping||!1;if(A(r)&&(t.dynamicTypingFunction=r,r={}),t.dynamicTyping=r,t.transform=!!A(t.transform)&&t.transform,t.worker&&l.WORKERS_SUPPORTED){var i=k();return i.userStep=t.step,i.userChunk=t.chunk,i.userComplete=t.complete,i.userError=t.error,t.step=A(t.step),t.chunk=A(t.chunk),t.complete=A(t.complete),t.error=A(t.error),delete t.worker,void i.postMessage({input:e,config:t,workerId:i.id})}var o=null;return e===l.NODE_STREAM_INPUT&&"undefined"==typeof PAPA_BROWSER_CONTEXT?(o=new b(t)).getStream():("string"==typeof e?(e=a(e),o=t.download?new p(t):new m(t)):!0===e.readable&&A(e.read)&&A(e.on)?o=new y(t):(n.File&&e instanceof File||e instanceof Object)&&(o=new v(t)),o.stream(e));function a(e){return 65279===e.charCodeAt(0)?e.slice(1):e}}function h(e,t){var n=!1,r=!0,i=",",o="\r\n",a='"',s=a+a,c=!1,u=null,h=!1;d();var f=new RegExp(x(a),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,c);if("object"===g(e[0]))return p(u||Object.keys(e[0]),e,c)}else if("object"===g(e))return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||u),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:"object"===g(e.data[0])?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||"object"===g(e.data[0])||(e.data=[e.data])),p(e.fields||[],e.data||[],c);throw new Error("Unable to serialize unrecognized input");function d(){if("object"===g(t)){if("string"!=typeof t.delimiter||l.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(i=t.delimiter),("boolean"==typeof t.quotes||"function"==typeof t.quotes||Array.isArray(t.quotes))&&(n=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(c=t.skipEmptyLines),"string"==typeof t.newline&&(o=t.newline),"string"==typeof t.quoteChar&&(a=t.quoteChar),"boolean"==typeof t.header&&(r=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");u=t.columns}void 0!==t.escapeChar&&(s=t.escapeChar+a),t.escapeFormulae instanceof RegExp?h=t.escapeFormulae:"boolean"==typeof t.escapeFormulae&&t.escapeFormulae&&(h=/^[=+\-@\t\r].*$/)}}function p(e,t,n){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var s=Array.isArray(e)&&e.length>0,l=!Array.isArray(t[0]);if(s&&r){for(var c=0;c<e.length;c++)c>0&&(a+=i),a+=v(e[c],c);t.length>0&&(a+=o)}for(var u=0;u<t.length;u++){var h=s?e.length:t[u].length,f=!1,d=s?0===Object.keys(t[u]).length:0===t[u].length;if(n&&!s&&(f="greedy"===n?""===t[u].join("").trim():1===t[u].length&&0===t[u][0].length),"greedy"===n&&s){for(var p=[],g=0;g<h;g++){var m=l?e[g]:g;p.push(t[u][m])}f=""===p.join("").trim()}if(!f){for(var y=0;y<h;y++){y>0&&!d&&(a+=i);var b=s&&l?e[y]:y;a+=v(t[u][b],y)}u<t.length-1&&(!n||h>0&&!d)&&(a+=o)}}return a}function v(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);var r=!1;h&&"string"==typeof e&&h.test(e)&&(e="'"+e,r=!0);var o=e.toString().replace(f,s);return(r=r||!0===n||"function"==typeof n&&n(e,t)||Array.isArray(n)&&n[t]||m(o,l.BAD_DELIMITERS)||o.indexOf(i)>-1||" "===o.charAt(0)||" "===o.charAt(o.length-1))?a+o+a:o}function m(e,t){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>-1)return!0;return!1}}function f(e){function t(e){var t=M(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new w(t),this._handle.streamer=this,this._config=t}this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},t.call(this,e),this.parseChunk=function(e,t){var r=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&r>0){var i=this._config.newline;if(!i){var a=this._config.quoteChar||'"';i=this._handle.guessLineEndings(e,a)}var s=e.split(i);e=d(s.slice(r)).join(i)}if(this.isFirstChunk&&A(this._config.beforeFirstChunk)){var c=this._config.beforeFirstChunk(e);void 0!==c&&(e=c)}this.isFirstChunk=!1,this._halted=!1;var u=this._partialLine+e;this._partialLine="";var h=this._handle.parse(u,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var f=h.meta.cursor;this._finished||(this._partialLine=u.substring(f-this._baseIndex),this._baseIndex=f),h&&h.data&&(this._rowCount+=h.data.length);var p=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(o)n.postMessage({results:h,workerId:l.WORKER_ID,finished:p});else if(A(this._config.chunk)&&!t){if(this._config.chunk(h,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);h=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(h.data),this._completeResults.errors=this._completeResults.errors.concat(h.errors),this._completeResults.meta=h.meta),this._completed||!p||!A(this._config.complete)||h&&h.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),p||h&&h.meta.paused||this._nextChunk(),h}this._halted=!0},this._sendError=function(e){A(this._config.error)?this._config.error(e):o&&this._config.error&&n.postMessage({workerId:l.WORKER_ID,error:e,finished:!1})}}function p(e){var t;function n(e){var t=e.getResponseHeader("Content-Range");return null===t?-1:parseInt(t.substring(t.lastIndexOf("/")+1))}(e=e||{}).chunkSize||(e.chunkSize=l.RemoteChunkSize),f.call(this,e),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),i||(t.onload=L(this._chunkLoaded,this),t.onerror=L(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var e=this._config.downloadRequestHeaders;for(var n in e)t.setRequestHeader(n,e[n])}if(this._config.chunkSize){var r=this._start+this._config.chunkSize-1;t.setRequestHeader("Range","bytes="+this._start+"-"+r)}try{t.send(this._config.downloadRequestBody)}catch(e){this._chunkError(e.message)}i&&0===t.status&&this._chunkError()}},this._chunkLoaded=function(){4===t.readyState&&(t.status<200||t.status>=400?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:t.responseText.length,this._finished=!this._config.chunkSize||this._start>=n(t),this.parseChunk(t.responseText)))},this._chunkError=function(e){var n=t.statusText||e;this._sendError(new Error(n))}}function v(e){var t,n;(e=e||{}).chunkSize||(e.chunkSize=l.LocalChunkSize),f.call(this,e);var r="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,n=e.slice||e.webkitSlice||e.mozSlice,r?((t=new FileReader).onload=L(this._chunkLoaded,this),t.onerror=L(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var i=Math.min(this._start+this._config.chunkSize,this._input.size);e=n.call(e,this._start,i)}var o=t.readAsText(e,this._config.encoding);r||this._chunkLoaded({target:{result:o}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function m(e){var t;e=e||{},f.call(this,e),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e,n=this._config.chunkSize;return n?(e=t.substring(0,n),t=t.substring(n)):(e=t,t=""),this._finished=!t,this.parseChunk(e)}}}function y(e){e=e||{},f.call(this,e);var t=[],n=!0,r=!1;this.pause=function(){f.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){f.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(e){this._input=e,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&1===t.length&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=L((function(e){try{t.push("string"==typeof e?e:e.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(e){this._streamError(e)}}),this),this._streamError=L((function(e){this._streamCleanUp(),this._sendError(e)}),this),this._streamEnd=L((function(){this._streamCleanUp(),r=!0,this._streamData("")}),this),this._streamCleanUp=L((function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)}),this)}function b(e){var n=t.Duplex,r=M(e),i=!0,o=!1,a=[],s=null;this._onCsvData=function(e){var t=e.data;s.push(t)||this._handle.paused()||this._handle.pause()},this._onCsvComplete=function(){s.push(null)},r.step=L(this._onCsvData,this),r.complete=L(this._onCsvComplete,this),f.call(this,r),this._nextChunk=function(){o&&1===a.length&&(this._finished=!0),a.length?a.shift()():i=!0},this._addToParseQueue=function(e,t){a.push(L((function(){if(this.parseChunk("string"==typeof e?e:e.toString(r.encoding)),A(t))return t()}),this)),i&&(i=!1,this._nextChunk())},this._onRead=function(){this._handle.paused()&&this._handle.resume()},this._onWrite=function(e,t,n){this._addToParseQueue(e,n)},this._onWriteComplete=function(){o=!0,this._addToParseQueue("")},this.getStream=function(){return s},(s=new n({readableObjectMode:!0,decodeStrings:!1,read:L(this._onRead,this),write:L(this._onWrite,this)})).once("finish",L(this._onWriteComplete,this))}function w(e){var t,n,r,i=Math.pow(2,53),o=-i,a=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,s=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,c=this,u=0,h=0,f=!1,d=!1,p=[],g={data:[],errors:[],meta:{}};if(A(e.step)){var v=e.step;e.step=function(t){if(g=t,w())b();else{if(b(),0===g.data.length)return;u+=t.data.length,e.preview&&u>e.preview?n.abort():(g.data=g.data[0],v(g,c))}}}function m(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function y(e){if(a.test(e)){var t=parseFloat(e);if(t>o&&t<i)return!0}return!1}function b(){return g&&r&&(L("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines&&(g.data=g.data.filter((function(e){return!m(e)}))),w()&&k(),T()}function w(){return e.header&&0===p.length}function k(){if(g)if(Array.isArray(g.data[0])){for(var t=0;w()&&t<g.data.length;t++)g.data[t].forEach(n);g.data.splice(0,1)}else g.data.forEach(n);function n(t,n){A(e.transformHeader)&&(t=e.transformHeader(t,n)),p.push(t)}}function S(t){return e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)}function C(e,t){return S(e)?"true"===t||"TRUE"===t||"false"!==t&&"FALSE"!==t&&(y(t)?parseFloat(t):s.test(t)?new Date(t):""===t?null:t):t}function T(){if(!g||!e.header&&!e.dynamicTyping&&!e.transform)return g;function t(t,n){var r,i=e.header?{}:[];for(r=0;r<t.length;r++){var o=r,a=t[r];e.header&&(o=r>=p.length?"__parsed_extra":p[r]),e.transform&&(a=e.transform(a,o)),a=C(o,a),"__parsed_extra"===o?(i[o]=i[o]||[],i[o].push(a)):i[o]=a}return e.header&&(r>p.length?L("FieldMismatch","TooManyFields","Too many fields: expected "+p.length+" fields but parsed "+r,h+n):r<p.length&&L("FieldMismatch","TooFewFields","Too few fields: expected "+p.length+" fields but parsed "+r,h+n)),i}var n=1;return!g.data.length||Array.isArray(g.data[0])?(g.data=g.data.map(t),n=g.data.length):g.data=t(g.data,0),e.header&&g.meta&&(g.meta.fields=p),h+=n,g}function E(t,n,r,i,o){var a,s,c,u;o=o||[",","\t","|",";",l.RECORD_SEP,l.UNIT_SEP];for(var h=0;h<o.length;h++){var f=o[h],d=0,p=0,g=0;c=void 0;for(var v=new _({comments:i,delimiter:f,newline:n,preview:10}).parse(t),y=0;y<v.data.length;y++)if(r&&m(v.data[y]))g++;else{var b=v.data[y].length;p+=b,void 0!==c?b>0&&(d+=Math.abs(b-c),c=b):c=b}v.data.length>0&&(p/=v.data.length-g),(void 0===s||d<=s)&&(void 0===u||p>u)&&p>1.99&&(s=d,a=f,u=p)}return e.delimiter=a,{successful:!!a,bestDelimiter:a}}function L(e,t,n,r){var i={type:e,code:t,message:n};void 0!==r&&(i.row=r),g.errors.push(i)}this.parse=function(i,o,a){var s=e.quoteChar||'"';if(e.newline||(e.newline=this.guessLineEndings(i,s)),r=!1,e.delimiter)A(e.delimiter)&&(e.delimiter=e.delimiter(i),g.meta.delimiter=e.delimiter);else{var c=E(i,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);c.successful?e.delimiter=c.bestDelimiter:(r=!0,e.delimiter=l.DefaultDelimiter),g.meta.delimiter=e.delimiter}var u=M(e);return e.preview&&e.header&&u.preview++,t=i,n=new _(u),g=n.parse(t,o,a),b(),f?{meta:{paused:!0}}:g||{meta:{paused:!1}}},this.paused=function(){return f},this.pause=function(){f=!0,n.abort(),t=A(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){c.streamer._halted?(f=!1,c.streamer.parseChunk(t,!0)):setTimeout(c.resume,3)},this.aborted=function(){return d},this.abort=function(){d=!0,n.abort(),g.meta.aborted=!0,A(e.complete)&&e.complete(g),t=""},this.guessLineEndings=function(e,t){e=e.substring(0,1048576);var n=new RegExp(x(t)+"([^]*?)"+x(t),"gm"),r=(e=e.replace(n,"")).split("\r"),i=e.split("\n"),o=i.length>1&&i[0].length<r[0].length;if(1===r.length||o)return"\n";for(var a=0,s=0;s<r.length;s++)"\n"===r[s][0]&&a++;return a>=r.length/2?"\r\n":"\r"}}function x(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function _(e){var t,n=(e=e||{}).delimiter,r=e.newline,i=e.comments,o=e.step,a=e.preview,s=e.fastMode,c=null,u=!1,h=t=void 0===e.quoteChar||null===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(h=e.escapeChar),("string"!=typeof n||l.BAD_DELIMITERS.indexOf(n)>-1)&&(n=","),i===n)throw new Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||l.BAD_DELIMITERS.indexOf(i)>-1)&&(i=!1),"\n"!==r&&"\r"!==r&&"\r\n"!==r&&(r="\n");var f=0,d=!1;this.parse=function(l,p,g){if("string"!=typeof l)throw new Error("Input must be a string");var v=l.length,m=n.length,y=r.length,b=i.length,w=A(o);f=0;var _=[],k=[],S=[],C=0;if(!l)return q();if(s||!1!==s&&-1===l.indexOf(t)){for(var T=l.split(r),E=0;E<T.length;E++){if(S=T[E],f+=S.length,E!==T.length-1)f+=r.length;else if(g)return q();if(!i||S.substring(0,b)!==i){if(w){if(_=[],I(S.split(n)),B(),d)return q()}else I(S.split(n));if(a&&E>=a)return _=_.slice(0,a),q(!0)}}return q()}for(var M=l.indexOf(n,f),L=l.indexOf(r,f),R=new RegExp(x(h)+x(t),"g"),O=l.indexOf(t,f);;)if(l[f]!==t)if(i&&0===S.length&&l.substring(f,f+b)===i){if(-1===L)return q();f=L+y,L=l.indexOf(r,f),M=l.indexOf(n,f)}else if(-1!==M&&(M<L||-1===L))S.push(l.substring(f,M)),f=M+m,M=l.indexOf(n,f);else{if(-1===L)break;if(S.push(l.substring(f,L)),N(L+y),w&&(B(),d))return q();if(a&&_.length>=a)return q(!0)}else for(O=f,f++;;){if(-1===(O=l.indexOf(t,O+1)))return g||k.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:_.length,index:f}),P();if(O===v-1)return P(l.substring(f,O).replace(R,t));if(t!==h||l[O+1]!==h){if(t===h||0===O||l[O-1]!==h){-1!==M&&M<O+1&&(M=l.indexOf(n,O+1)),-1!==L&&L<O+1&&(L=l.indexOf(r,O+1));var j=H(-1===L?M:Math.min(M,L));if(l.substr(O+1+j,m)===n){S.push(l.substring(f,O).replace(R,t)),f=O+1+j+m,l[O+1+j+m]!==t&&(O=l.indexOf(t,f)),M=l.indexOf(n,f),L=l.indexOf(r,f);break}var D=H(L);if(l.substring(O+1+D,O+1+D+y)===r){if(S.push(l.substring(f,O).replace(R,t)),N(O+1+D+y),M=l.indexOf(n,f),O=l.indexOf(t,f),w&&(B(),d))return q();if(a&&_.length>=a)return q(!0);break}k.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:_.length,index:f}),O++}}else O++}return P();function I(e){_.push(e),C=f}function H(e){var t=0;if(-1!==e){var n=l.substring(O+1,e);n&&""===n.trim()&&(t=n.length)}return t}function P(e){return g||(void 0===e&&(e=l.substring(f)),S.push(e),f=v,I(S),w&&B()),q()}function N(e){f=e,I(S),S=[],L=l.indexOf(r,f)}function q(t){if(e.header&&!p&&_.length&&!u){for(var i=_[0],o={},a=new Set(i),s=!1,l=0;l<i.length;l++){var h=i[l];if(A(e.transformHeader)&&(h=e.transformHeader(h,l)),o[h]){var f=void 0,g=o[h];do{f="".concat(h,"_").concat(g),g++}while(a.has(f));a.add(f),i[l]=f,o[h]++,s=!0,null===c&&(c={}),c[f]=h}else o[h]=1,i[l]=h;a.add(h)}s&&console.warn("Duplicate headers found and renamed."),u=!0}return{data:_,errors:k,meta:{delimiter:n,linebreak:r,aborted:d,truncated:!!t,cursor:C+(p||0),renamedHeaders:c}}}function B(){o(q()),_=[],k=[]}},this.abort=function(){d=!0},this.getCharIndex=function(){return f}}function k(){if(!l.WORKERS_SUPPORTED)return!1;var e=r(),t=new n.Worker(e);return t.onmessage=S,t.id=s++,a[t.id]=t,t}function S(e){var t=e.data,n=a[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var i={abort:function(){r=!0,C(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:T,resume:T};if(A(n.userStep)){for(var o=0;o<t.results.data.length&&(n.userStep({data:t.results.data[o],errors:t.results.errors,meta:t.results.meta},i),!r);o++);delete t.results}else A(n.userChunk)&&(n.userChunk(t.results,i,t.file),delete t.results)}t.finished&&!r&&C(t.workerId,t.results)}function C(e,t){var n=a[e];A(n.userComplete)&&n.userComplete(t),n.terminate(),delete a[e]}function T(){throw new Error("Not implemented.")}function E(e){var t=e.data;if(void 0===l.WORKER_ID&&t&&(l.WORKER_ID=t.workerId),"string"==typeof t.input)n.postMessage({workerId:l.WORKER_ID,results:l.parse(t.input,t.config),finished:!0});else if(n.File&&t.input instanceof File||t.input instanceof Object){var r=l.parse(t.input,t.config);r&&n.postMessage({workerId:l.WORKER_ID,results:r,finished:!0})}}function M(e){if("object"!==g(e)||null===e)return e;var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=M(e[n]);return t}function L(e,t){return function(){e.apply(t,arguments)}}function A(e){return"function"==typeof e}return o&&(n.onmessage=E),p.prototype=Object.create(f.prototype),p.prototype.constructor=p,v.prototype=Object.create(f.prototype),v.prototype.constructor=v,m.prototype=Object.create(m.prototype),m.prototype.constructor=m,y.prototype=Object.create(f.prototype),y.prototype.constructor=y,"undefined"==typeof PAPA_BROWSER_CONTEXT&&(b.prototype=Object.create(f.prototype),b.prototype.constructor=b),l}()}(k);var S=m(k.exports);function C(e,t){return Array(t+1).join(e)}var T=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function E(e){return R(e,T)}var M=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function L(e){return R(e,M)}var A=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function R(e,t){return t.indexOf(e.nodeName)>=0}function O(e,t){return e.getElementsByTagName&&t.some((function(t){return e.getElementsByTagName(t).length}))}var j={};function D(e){return e?e.replace(/(\n+\s*)+/g,"\n"):""}function I(e){for(var t in this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[],e.rules)this.array.push(e.rules[t])}function H(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];if(P(i,t,n))return i}}function P(e,t,n){var r=e.filter;if("string"==typeof r){if(r===t.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(t.nodeName.toLowerCase())>-1)return!0}else{if("function"!=typeof r)throw new TypeError("`filter` needs to be a string, array, or function");if(r.call(e,t,n))return!0}}function N(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function q(e,t,n){return e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}j.paragraph={filter:"p",replacement:function(e){return"\n\n"+e+"\n\n"}},j.lineBreak={filter:"br",replacement:function(e,t,n){return n.br+"\n"}},j.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,n){var r=Number(t.nodeName.charAt(1));return"setext"===n.headingStyle&&r<3?"\n\n"+e+"\n"+C(1===r?"=":"-",e.length)+"\n\n":"\n\n"+C("#",r)+" "+e+"\n\n"}},j.blockquote={filter:"blockquote",replacement:function(e){return"\n\n"+(e=(e=e.replace(/^\n+|\n+$/g,"")).replace(/^/gm,"> "))+"\n\n"}},j.list={filter:["ul","ol"],replacement:function(e,t){var n=t.parentNode;return"LI"===n.nodeName&&n.lastElementChild===t?"\n"+e:"\n\n"+e+"\n\n"}},j.listItem={filter:"li",replacement:function(e,t,n){e=e.replace(/^\n+/,"").replace(/\n+$/,"\n").replace(/\n/gm,"\n    ");var r=n.bulletListMarker+"   ",i=t.parentNode;if("OL"===i.nodeName){var o=i.getAttribute("start"),a=Array.prototype.indexOf.call(i.children,t);r=(o?Number(o)+a:a+1)+".  "}return r+e+(t.nextSibling&&!/\n$/.test(e)?"\n":"")}},j.indentedCodeBlock={filter:function(e,t){return"indented"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,n){return"\n\n    "+t.firstChild.textContent.replace(/\n/g,"\n    ")+"\n\n"}},j.fencedCodeBlock={filter:function(e,t){return"fenced"===t.codeBlockStyle&&"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t,n){for(var r,i=((t.firstChild.getAttribute("class")||"").match(/language-(\S+)/)||[null,""])[1],o=t.firstChild.textContent,a=n.fence.charAt(0),s=3,l=new RegExp("^"+a+"{3,}","gm");r=l.exec(o);)r[0].length>=s&&(s=r[0].length+1);var c=C(a,s);return"\n\n"+c+i+"\n"+o.replace(/\n$/,"")+"\n"+c+"\n\n"}},j.horizontalRule={filter:"hr",replacement:function(e,t,n){return"\n\n"+n.hr+"\n\n"}},j.inlineLink={filter:function(e,t){return"inlined"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t){var n=t.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var r=D(t.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+e+"]("+n+r+")"}},j.referenceLink={filter:function(e,t){return"referenced"===t.linkStyle&&"A"===e.nodeName&&e.getAttribute("href")},replacement:function(e,t,n){var r,i,o=t.getAttribute("href"),a=D(t.getAttribute("title"));switch(a&&(a=' "'+a+'"'),n.linkReferenceStyle){case"collapsed":r="["+e+"][]",i="["+e+"]: "+o+a;break;case"shortcut":r="["+e+"]",i="["+e+"]: "+o+a;break;default:var s=this.references.length+1;r="["+e+"]["+s+"]",i="["+s+"]: "+o+a}return this.references.push(i),r},references:[],append:function(e){var t="";return this.references.length&&(t="\n\n"+this.references.join("\n")+"\n\n",this.references=[]),t}},j.emphasis={filter:["em","i"],replacement:function(e,t,n){return e.trim()?n.emDelimiter+e+n.emDelimiter:""}},j.strong={filter:["strong","b"],replacement:function(e,t,n){return e.trim()?n.strongDelimiter+e+n.strongDelimiter:""}},j.code={filter:function(e){var t=e.previousSibling||e.nextSibling,n="PRE"===e.parentNode.nodeName&&!t;return"CODE"===e.nodeName&&!n},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",n="`",r=e.match(/`+/gm)||[];-1!==r.indexOf(n);)n+="`";return n+t+e+t+n}},j.image={filter:"img",replacement:function(e,t){var n=D(t.getAttribute("alt")),r=t.getAttribute("src")||"",i=D(t.getAttribute("title"));return r?"!["+n+"]("+r+(i?' "'+i+'"':"")+")":""}},I.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){return e.isBlank?this.blankRule:(t=H(this.array,e,this.options))||(t=H(this._keep,e,this.options))||(t=H(this._remove,e,this.options))?t:this.defaultRule;var t},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};var B="undefined"!=typeof window?window:{};var F,V,z,U=function(){var e=B.DOMParser,t=!1;try{(new e).parseFromString("","text/html")&&(t=!0)}catch(e){}return t}()?B.DOMParser:(F=function(){},V=require("@mixmark-io/domino"),F.prototype.parseFromString=function(e){return V.createDocument(e)},F);function $(e,t){var n;"string"==typeof e?n=(z=z||new U).parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html").getElementById("turndown-root"):n=e.cloneNode(!0);return function(e){var t=e.element,n=e.isBlock,r=e.isVoid,i=e.isPre||function(e){return"PRE"===e.nodeName};if(t.firstChild&&!i(t)){for(var o=null,a=!1,s=null,l=q(s,t,i);l!==t;){if(3===l.nodeType||4===l.nodeType){var c=l.data.replace(/[ \r\n\t]+/g," ");if(o&&!/ $/.test(o.data)||a||" "!==c[0]||(c=c.substr(1)),!c){l=N(l);continue}l.data=c,o=l}else{if(1!==l.nodeType){l=N(l);continue}n(l)||"BR"===l.nodeName?(o&&(o.data=o.data.replace(/ $/,"")),o=null,a=!1):r(l)||i(l)?(o=null,a=!0):o&&(a=!1)}var u=q(s,l,i);s=l,l=u}o&&(o.data=o.data.replace(/ $/,""),o.data||N(o))}}({element:n,isBlock:E,isVoid:L,isPre:t.preformattedCode?G:null}),n}function G(e){return"PRE"===e.nodeName||"CODE"===e.nodeName}function W(e,t){return e.isBlock=E(e),e.isCode="CODE"===e.nodeName||e.parentNode.isCode,e.isBlank=function(e){return!L(e)&&!function(e){return R(e,A)}(e)&&/^\s*$/i.test(e.textContent)&&!function(e){return O(e,M)}(e)&&!function(e){return O(e,A)}(e)}(e),e.flankingWhitespace=function(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var n=(r=e.textContent,i=r.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/),{leading:i[1],leadingAscii:i[2],leadingNonAscii:i[3],trailing:i[4],trailingNonAscii:i[5],trailingAscii:i[6]});var r,i;n.leadingAscii&&J("left",e,t)&&(n.leading=n.leadingNonAscii);n.trailingAscii&&J("right",e,t)&&(n.trailing=n.trailingNonAscii);return{leading:n.leading,trailing:n.trailing}}(e,t),e}function J(e,t,n){var r,i,o;return"left"===e?(r=t.previousSibling,i=/ $/):(r=t.nextSibling,i=/^ /),r&&(3===r.nodeType?o=i.test(r.nodeValue):n.preformattedCode&&"CODE"===r.nodeName?o=!1:1!==r.nodeType||E(r)||(o=i.test(r.textContent))),o}var K=Array.prototype.reduce,X=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function Y(e){if(!(this instanceof Y))return new Y(e);var t={rules:j,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(e,t){return t.isBlock?"\n\n":""},keepReplacement:function(e,t){return t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML},defaultReplacement:function(e,t){return t.isBlock?"\n\n"+e+"\n\n":e}};this.options=function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}({},t,e),this.rules=new I(this.options)}function Q(e){var t=this;return K.call(e.childNodes,(function(e,n){var r="";return 3===(n=new W(n,t.options)).nodeType?r=n.isCode?n.nodeValue:t.escape(n.nodeValue):1===n.nodeType&&(r=ee.call(t,n)),te(e,r)}),"")}function Z(e){var t=this;return this.rules.forEach((function(n){"function"==typeof n.append&&(e=te(e,n.append(t.options)))})),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function ee(e){var t=this.rules.forNode(e),n=Q.call(this,e),r=e.flankingWhitespace;return(r.leading||r.trailing)&&(n=n.trim()),r.leading+t.replacement(n,e,this.options)+r.trailing}function te(e,t){var n=function(e){for(var t=e.length;t>0&&"\n"===e[t-1];)t--;return e.substring(0,t)}(e),r=t.replace(/^\n*/,""),i=Math.max(e.length-n.length,t.length-r.length);return n+"\n\n".substring(0,i)+r}Y.prototype={turndown:function(e){if(!function(e){return null!=e&&("string"==typeof e||e.nodeType&&(1===e.nodeType||9===e.nodeType||11===e.nodeType))}(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(""===e)return"";var t=Q.call(this,new $(e,this.options));return Z.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else{if("function"!=typeof e)throw new TypeError("plugin must be a Function or an Array of Functions");e(this)}return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return X.reduce((function(e,t){return e.replace(t[0],t[1])}),e)}};var ne=function(){return a((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e),this.turndownService=new Y(u({headingStyle:"atx",codeBlockStyle:"fenced",emDelimiter:"*",bulletListMarker:"-"},t)),this.cache=new Map,this.cacheSize=t.cacheSize||10,this._specialBlocks=new Map,this.configureTurndownRules()}),[{key:"configureTurndownRules",value:function(){var e=this;this.turndownService.addRule("squibviewFencedBlock",{filter:function(e){return"DIV"===e.nodeName&&e.hasAttribute("data-source-type")},replacement:function(t,n,r){var i=n.getAttribute("data-source-type")||"code",o="";switch(i){case"mermaid":case"math":var a=n.innerHTML;a=a.replace(/<br\s*\/?>/gi,"\n");var s=n.ownerDocument.createElement("div");s.innerHTML=a,o=s.textContent||s.innerText||"";break;case"svg":o=n.hasAttribute("data-original-source")?n.getAttribute("data-original-source"):n.innerHTML;break;case"csv":case"tsv":case"psv":var l=n.querySelector("table");l?o=e._htmlTableToDelimitedText(l,i):(o="Error: Table not found for "+i,console.warn('Could not find table inside div[data-source-type="'+i+'"]'));break;default:var c=n.querySelector("pre");if(c)o=(c.querySelector("code")||c).textContent;else o=n.textContent,console.warn('Could not find <pre> inside div[data-source-type="'+i+'"]')}var u="code"===i?"":i,h=o.trim();return"\n```"+u+(h=h?"\n"+h+"\n":"\n")+"```\n"}}),this.turndownService.addRule("keepImageTags",{filter:"img",replacement:function(e,t){return t.outerHTML}}),this.turndownService.addRule("mermaid",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("mermaid")},replacement:function(t,n){var r="mermaid_"+Math.random().toString(36).substring(2,10);return e._specialBlocks&&e._specialBlocks.set(r,{type:"mermaid",content:n.textContent}),'\n<div data-special-block="'.concat(r,'" class="mermaid">\n')+n.textContent+"\n</div>\n"}}),this.turndownService.addRule("geojson",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("geojson-map")},replacement:function(t,n){var r="geojson_"+Math.random().toString(36).substring(2,10),i="";try{i=n.dataset.geojson||'{"type":"FeatureCollection","features":[]}'}catch(e){console.error("Error extracting GeoJSON data:",e)}return e._specialBlocks&&e._specialBlocks.set(r,{type:"geojson",content:i}),'\n<div data-special-block="'.concat(r,'" class="geojson-container">\n')+i+"\n</div>\n"}}),this.turndownService.addRule("math",{filter:function(e){return"DIV"===e.nodeName&&e.classList.contains("math-display")},replacement:function(t,n){var r="math_"+Math.random().toString(36).substring(2,10),i=n.textContent;return i=i.replace(/^\$\$([\s\S]*)\$\$$/,"$1"),e._specialBlocks&&e._specialBlocks.set(r,{type:"math",content:i}),'\n<div data-special-block="'.concat(r,'" class="math-container">\n')+i+"\n</div>\n"}}),this.turndownService.addRule("codeBlock",{filter:function(e){return"PRE"===e.nodeName&&e.firstChild&&"CODE"===e.firstChild.nodeName},replacement:function(e,t){var n=t.firstChild.textContent,r="";if(t.firstChild.className){var i=t.firstChild.className.match(/language-(\w+)/);i&&(r=i[1])}return"\n```"+r+"\n"+n.trim()+"\n```\n"}}),this.turndownService.addRule("tableCell",{filter:["th","td"],replacement:function(e,t){return" "+e.trim()+" |"}}),this.turndownService.addRule("tableRow",{filter:"tr",replacement:function(e,t){if("THEAD"===t.parentNode.nodeName){var n=t.querySelectorAll("th, td").length;return"|"+e+("\n|"+" --- |".repeat(n))}return"|"+e+"\n"}}),this.turndownService.addRule("table",{filter:"table",replacement:function(t,n){if(n.parentElement&&n.parentElement.hasAttribute("data-source-type")){var r=n.parentElement.getAttribute("data-source-type");if("csv"===r||"tsv"===r||"psv"===r)return t}var i="",o=n.querySelector("thead tr");return o&&(i+="|",o.querySelectorAll("th").forEach((function(t){i+=" ".concat(e.turndownService.turndown(t.innerHTML).trim()," |")})),i+="\n|",o.querySelectorAll("th").forEach((function(){i+=" --- |"})),i+="\n"),n.querySelectorAll("tbody tr").forEach((function(t){i+="|",t.querySelectorAll("td").forEach((function(t){i+=" ".concat(e.turndownService.turndown(t.innerHTML).trim()," |")})),i+="\n"})),"\n"+i+"\n"}}),this.turndownService.keep(["li"]),this.turndownService.addRule("taskListItems",{filter:function(e){return"LI"===e.nodeName&&e.firstChild&&"INPUT"===e.firstChild.nodeName&&"checkbox"===e.firstChild.type},replacement:function(e,t){for(var n=t.firstChild,r=n.checked,i="",o=n.nextSibling;o;)i+=o.outerHTML||o.textContent,o=o.nextSibling;return(r?"[x] ":"[ ] ")+this.turndownService.turndown(i).trim()}})}},{key:"_getStringHash",value:function(e){for(var t=0,n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t.toString(36)}},{key:"convert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._specialBlocks.clear(),this._placeholders=[];var n=this._getStringHash(e);if(this.cache.has(n))return this.cache.get(n);var r=this._preProcessSpecialContainers(e),i=this.turndownService.turndown(r);if(i=this._postProcessMarkdown(i,t.originalSource),this.cache.set(n,i),this.cache.size>this.cacheSize){var o=this.cache.keys().next().value;this.cache.delete(o)}return i}},{key:"_preProcessSpecialContainers",value:function(e){var t,n=this;if("undefined"==typeof document||!document.createElement)return console.warn("Document not available, skipping pre-processing"),this._placeholders=[],e;try{if((t=document.createElement("div")).innerHTML=e,"function"!=typeof t.querySelector)throw new Error("querySelector not available")}catch(t){return console.warn("DOM methods not available, using regex fallback for pre-processing"),this._regexFallbackPreProcess(e)}var r=t.querySelectorAll("div[data-source-type]"),i=[];return r.forEach((function(e,t){var r,o=e.getAttribute("data-source-type"),a="__SPECIAL_CONTAINER_".concat(t,"__");if("svg"===o&&e.hasAttribute("data-original-source"))r=e.getAttribute("data-original-source");else if(["mermaid","math","geojson"].includes(o)&&e.hasAttribute("data-original-source"))r=e.getAttribute("data-original-source");else if("csv"===o||"tsv"===o||"psv"===o){var s=e.querySelector("table");r=s?n._htmlTableToDelimitedText(s,o):"Error: Table not found for "+o}else{var l=e.querySelector("pre");if(l)r=(l.querySelector("code")||l).textContent.replace(/^[\r\n]+|[\r\n]+$/g,"");else r=e.textContent.replace(/^[\r\n]+|[\r\n]+$/g,"")}i.push({placeholder:a,type:o,content:r});var c=document.createTextNode(a);e.parentNode&&e.parentNode.replaceChild(c,e)})),this._placeholders=i,t.innerHTML}},{key:"_postProcessMarkdown",value:function(e,t){this._placeholders&&this._placeholders.length>0&&this._placeholders.forEach((function(t){var n=t.placeholder,r=t.type,i="code"===r?"":r,o=t.content.replace(/^[\r\n]+|[\r\n]+$/g,""),a="```".concat(i,"\n").concat(o,"\n```"),s=n,l=s.replace(/_/g,"\\_");e.includes(s)?e=e.replace(s,a):e.includes(l)&&(e=e.replace(l,a))}));e=(e=e.replace(/<div data-special-block="mermaid_[^"]*" class="mermaid">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```mermaid\n".concat(t.trim(),"\n```\n")}))).replace(/<div data-special-block="svg_[^"]*" class="svg-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){var n=t.match(/<svg[\s\S]*?<\/svg>/);return n?"\n```svg\n".concat(n[0],"\n```\n"):e}));if(e=(e=e.replace(/<div data-special-block="geojson_[^"]*" class="geojson-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){try{return JSON.parse(t),"\n```geojson\n".concat(t.trim(),"\n```\n")}catch(e){return console.error("Invalid GeoJSON data:",e),'\n```geojson\n{"type":"FeatureCollection","features":[]}\n```\n'}}))).replace(/<div data-special-block="math_[^"]*" class="math-container">\s*([\s\S]*?)\s*<\/div>/g,(function(e,t){return"\n```math\n".concat(t.trim(),"\n```\n")})),t){for(var n,r=/```(\w+)\s*([\s\S]*?)```/g,i=0,o=[];null!==(n=r.exec(t));){var a=n[1];n[2],"mermaid"!==a&&"svg"!==a&&"geojson"!==a&&"math"!==a||o.push({type:a,content:n[0],index:i++})}var s=0,l=0,c=0,u=0;e=e.replace(/```mermaid\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"mermaid"===e.type}));return s<n.length?n[s++].content:e})),e=e.replace(/```svg\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"svg"===e.type}));return l<n.length?n[l++].content:e})),e=e.replace(/```geojson\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"geojson"===e.type}));return c<n.length?n[c++].content:e})),e=e.replace(/```math\s*([\s\S]*?)```/g,(function(e,t){var n=o.filter((function(e){return"math"===e.type}));return u<n.length?n[u++].content:e}))}return e}},{key:"_htmlTableToDelimitedText",value:function(e,t){var n;switch(t){case"csv":default:n=",";break;case"tsv":n="\t";break;case"psv":n="|"}var r=[];if(!e||"function"!=typeof e.querySelectorAll)return console.warn("DOM methods not available for table extraction, using regex fallback"),this._extractTableDataFromHtml(e?e.outerHTML||e.innerHTML||String(e):"",t);var i=e.querySelectorAll("tr");return i&&"function"==typeof i.forEach?(i.forEach((function(e){var t=[];e.querySelectorAll("th, td").forEach((function(e){var r=e.textContent||"";r=r.replace(/\r?\n|\r/g," ").trim(),","===n&&r.includes(",")&&(r='"'.concat(r.replace(/"/g,'""'),'"')),t.push(r)})),r.push(t.join(n))})),r.join("\n")):(console.warn("querySelectorAll did not return proper NodeList, falling back to regex"),this._extractTableDataFromHtml(e.outerHTML||e.innerHTML||String(e),t))}},{key:"_extractTableDataFromHtml",value:function(e,t){var n;switch(t){case"csv":default:n=",";break;case"tsv":n="\t";break;case"psv":n="|"}try{for(var r,i=/<tr[^>]*>([\s\S]*?)<\/tr>/gi,o=[];null!==(r=i.exec(e));){for(var a=r[1],s=/<(?:th|td)[^>]*>([\s\S]*?)<\/(?:th|td)>/gi,l=[],c=void 0;null!==(c=s.exec(a));){var u=c[1];u=u.replace(/<[^>]*>/g,"").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/\r?\n|\r/g," ").trim(),","===n&&u.includes(",")&&(u='"'.concat(u.replace(/"/g,'""'),'"')),l.push(u)}l.length>0&&o.push(l.join(n))}return o.join("\n")}catch(e){return console.error("Error extracting table data from HTML:",e),"Error: Could not extract table data"}}},{key:"_regexFallbackPreProcess",value:function(e){var t=this,n=[],r=0,i=e.replace(/<div[^>]*data-source-type="([^"]*)"[^>]*>([\s\S]*?)<\/div>/g,(function(e,i,o){var a,s="__SPECIAL_CONTAINER_".concat(r,"__");if("svg"===i){var l=e.match(/data-original-source="([^"]*)"/);if(l)a=l[1].replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");else{var c=o.match(/<svg[\s\S]*?<\/svg>/);a=c?c[0]:o}}else if("csv"===i||"tsv"===i||"psv"===i)a=t._extractTableDataFromHtml(o,i);else{var u=o.match(/<pre[^>]*><code[^>]*>([\s\S]*?)<\/code><\/pre>/);a=u?u[1].replace(/<span[^>]*>/g,"").replace(/<\/span>/g,"").replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):o.replace(/<[^>]*>/g,"").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}return n.push({placeholder:s,type:i,content:a}),r++,"<p>".concat(s,"</p>")}));return this._placeholders=n,i}}])}(),re=Object.freeze({__proto__:null,default:ne}),ie=function(){return a((function e(){o(this,e),this.initialContent="",this.contentType="",this.diffs=[],this.currentIndex=-1,this.diffEngine=new _}),[{key:"initialize",value:function(e,t){this.initialContent=e,this.contentType=t,this.diffs=[],this.currentIndex=-1}},{key:"addRevision",value:function(e,t){var n=this.getCurrentContent(),r=this.diffEngine.diff_main(n,e);this.diffEngine.diff_cleanupSemantic(r);var i=this.diffEngine.patch_toText(this.diffEngine.patch_make(n,r));this.currentIndex<this.diffs.length-1&&(this.diffs=this.diffs.slice(0,this.currentIndex+1)),this.diffs.push({diff:i,contentType:t!==this.contentType?t:void 0}),t!==this.contentType&&(this.contentType=t),this.currentIndex=this.diffs.length-1}},{key:"undo",value:function(){return this.currentIndex>=0?(this.currentIndex--,{content:this.getCurrentContent(),contentType:this.getCurrentContentType()}):null}},{key:"redo",value:function(){return this.currentIndex<this.diffs.length-1?(this.currentIndex++,{content:this.getCurrentContent(),contentType:this.getCurrentContentType()}):null}},{key:"getCurrentContent",value:function(){if(this.currentIndex<0)return this.initialContent;for(var e=this.initialContent,t=0;t<=this.currentIndex;t++){var n=this.diffEngine.patch_fromText(this.diffs[t].diff);e=f(this.diffEngine.patch_apply(n,e),1)[0]}return e}},{key:"getCurrentContentType",value:function(){if(this.currentIndex<0)return this.contentType;for(var e=this.contentType,t=0;t<=this.currentIndex;t++)void 0!==this.diffs[t].contentType&&(e=this.diffs[t].contentType);return e}},{key:"setRevision",value:function(e){return e>=-1&&e<this.diffs.length?(this.currentIndex=e,{content:this.getCurrentContent(),contentType:this.getCurrentContentType()}):null}},{key:"getRevisionCount",value:function(){return this.diffs.length}},{key:"getCurrentIndex",value:function(){return this.currentIndex}}])}();function oe(){try{if("undefined"!=typeof window&&window.hljs)return window.hljs;if("undefined"!=typeof global&&global.hljs)return global.hljs}catch(e){}return null}var ae=function(){return a((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o(this,e),this.options=u(u({},e.defaultOptions),n),this.container="string"==typeof t?document.querySelector(t):t,!this.container)throw new Error("Container element not found");this.events=new w,this.revisionManager=new ie,this.lastSelectionData=null,this._onTextReplacementHandler=null,this.renderers={},this._initializeHtmlToMarkdown(),this.initializeLibraries(),this.registerDefaultRenderers(),this.createStructure(),this.initializeEventHandlers(),this.initializeResizeObserver(),this.options.initialContent?(this.revisionManager.initialize(this.options.initialContent,this.options.inputContentType),this.setContent(this.options.initialContent,this.options.inputContentType,!1)):this.revisionManager.initialize("",this.options.inputContentType),this.setView(this.options.initialView),this.updateTypeButtons(),this.options.onReplaceSelectedText&&(this.onReplaceSelectedText=this.options.onReplaceSelectedText)}),[{key:"_initializeHtmlToMarkdown",value:(x=i(h().mark((function e(){var t,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0===ne){e.next=5;break}this._htmlToMarkdownConverter=new ne({cacheSize:20}),e.next=10;break;case 5:return e.next=7,Promise.resolve().then((function(){return re}));case 7:t=e.sent,n=t.default,this._htmlToMarkdownConverter=new n({cacheSize:20});case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Failed to load HtmlToMarkdown module:",e.t0),this._htmlToMarkdownConverter={convert:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent}};case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return x.apply(this,arguments)})},{key:"initializeLibraries",value:function(){var t=this;mermaid.initialize({startOnLoad:!1,securityLevel:"loose",theme:"default",errorCallback:function(e){return console.warn("Mermaid error:",e),"<div class='mermaid-error'></div>"}}),mermaid.init(void 0,".mermaid"),this.md=new e({html:!0,linkify:!0,typographer:!0,highlight:function(e,t){var n=oe();if(t&&n&&n.getLanguage&&n.getLanguage(t))try{return n.highlight(e,{language:t}).value}catch(e){}return""}}),this.md.renderer.rules.fence,this.md.renderer.rules.fence=function(e,n,r,i,o){var a=e[n],s=a.info.trim().toLowerCase(),l=a.content;if("mermaid"===s){var c=t.md.utils.escapeHtml(l);return'<div class="mermaid" data-source-type="mermaid">'.concat(c,"</div>")}if("svg"===s){var u=l.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return'<div class="svg-container" data-source-type="svg" data-original-source="'.concat(u,'">').concat(l,"</div>")}if("geojson"===s){var h="geojson-"+Math.random().toString(36).substring(2,15);return'<div id="'.concat(h,'" class="geojson-map" data-source-type="geojson" style="width: 100%; height: 300px;"></div>\n                <script>\n                  (function() {\n                    const initMap = function() {\n                      if (typeof L !== \'undefined\') {\n                        const mapContainer = document.getElementById(\'').concat(h,"');\n                        if (mapContainer && !mapContainer.dataset.initialized) {\n                          const map = L.map('").concat(h,"').setView([0, 0], 2);\n                          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n                            attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n                          }).addTo(map);\n                          try {\n                            const geojsonData = JSON.parse(content); // Parse the raw content\n                            const geojsonLayer = L.geoJSON(geojsonData).addTo(map);\n                            map.fitBounds(geojsonLayer.getBounds(), { padding: [20, 20] });\n                            mapContainer.dataset.initialized = 'true';\n                          } catch (e) {\n                            console.error('Error rendering GeoJSON:', e, 'Original content:', content);\n                            mapContainer.innerHTML = '<p style=\"color: red; text-align: center;\">Error rendering GeoJSON map.</p>';\n                            mapContainer.dataset.initialized = 'error';\n                          }\n                        }\n                      } else {\n                        console.warn('Leaflet not loaded when trying to initialize GeoJSON map:', '").concat(h,"');\n                      }\n                    };\n                    if (document.readyState === 'complete' || document.readyState === 'interactive') {\n                        initMap();\n                    } else {\n                        window.addEventListener('load', initMap);\n                    }\n                  })();\n                <\/script>")}if("math"===s){var f="math-"+Math.random().toString(36).substring(2,15),d=l.replace(/\r?\n/g," ").replace(/\s+/g," ").trim();return'<div id="'.concat(f,'" class="math-display" data-source-type="math">$',"$").concat(d,"$","$","</div>")}var p,g=a.info.trim().split(/\s+/)[0]||"",v=t.md.utils.escapeHtml(g);if(["csv","tsv","psv"].includes(g))try{if(void 0===S||"function"!=typeof S.parse)return'<pre class="squibview-error" data-source-type="'.concat(v,'">Error: PapaParse library not loaded.</pre>');var m={skipEmptyLines:!0};"tsv"!==g&&(m.delimiter="csv"===g?",":"|");var y=S.parse(l,m);if(y.errors&&y.errors.length>0){var b=y.errors.map((function(e){return"".concat(e.type,": ").concat(e.message," (Row: ").concat(e.row,")")})).join("\n");return'<pre class="squibview-error" data-source-type="'.concat(v,'">Error parsing ').concat(g," data:\n").concat(t.md.utils.escapeHtml(b),"</pre>")}return'<div data-source-type="'.concat(v,'">').concat(t._dataToHtmlTable(y.data),"</div>")}catch(e){return'<pre class="squibview-error" data-source-type="'.concat(v,'">Could not render ').concat(t.md.utils.escapeHtml(g)," table.</pre>")}var w=oe();if(w&&w.getLanguage&&w.getLanguage(g))try{var x=w.highlight(l,{language:g,ignoreIllegals:!0}).value;p='<pre><code class="hljs language-'.concat(v,'" data-source-type="code" data-lang="').concat(v,'">').concat(x,"</code></pre>")}catch(e){}if(!p){var _=t.md.utils.escapeHtml(l);p='<pre><code class="hljs language-'.concat(v,'" data-source-type="code" data-lang="').concat(v,'">').concat(_,"</code></pre>")}return'<div data-source-type="'.concat(v||"code",'">').concat(p,"</div>")}}},{key:"_dataToHtmlTable",value:function(e){var t=this;if(!e||0===e.length)return'<p class="squibview-info">No data to display.</p>';var n='<table class="squibview-data-table">',r=e[0];n+="<thead><tr>",r.forEach((function(e){n+="<th>".concat(t.md.utils.escapeHtml(String(e)),"</th>")})),n+="</tr></thead>",n+="<tbody>";for(var i=1;i<e.length;i++){n+="<tr>";for(var o=e[i],a=0;a<r.length;a++){var s=void 0!==o[a]?String(o[a]):"";n+="<td>".concat(this.md.utils.escapeHtml(s),"</td>")}n+="</tr>"}return n+="</tbody></table>"}},{key:"registerRenderer",value:function(e,t){this.renderers[e]=t,this.events.emit("renderer:registered",e,t),this.inputContentType===e&&this.updateTypeButtons()}},{key:"registerDefaultRenderers",value:function(){var e=this;this.registerRenderer("md",{render:function(t){return e.renderMarkdown(t)},sourceToOutput:function(t){return e.md.render(t)},outputToSource:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.htmlToMarkdown(t,n)},operations:{increaseHeadings:function(t){return e.markdownAdjustHeadings(t,1)},decreaseHeadings:function(t){return e.markdownAdjustHeadings(t,-1)},removeHR:function(e){return e.replace(/---/g,"")},fixLinefeeds:function(t){return e.fixLinefeedsInMarkdown(t)},toggleLinefeedView:function(){return e.toggleLinefeedView(),e.getContent()}},buttons:[{label:"H-",action:"decreaseHeadings",title:"Decrease heading levels"},{label:"H+",action:"increaseHeadings",title:"Increase heading levels"},{label:"Remove HR",action:"removeHR",title:"Remove horizontal rules"},{label:"Smart Linefeeds",action:"fixLinefeeds",title:"Convert all single line breaks to hard line breaks (two spaces + newline) in the source."}]}),this.registerRenderer("html",{render:function(t){return e.renderHTML(t)},sourceToOutput:function(e){return e},outputToSource:function(e){return e},operations:{},buttons:[]}),this.registerRenderer("reveal",{render:function(t){return e.renderHTML(e.makeRevealJSFullPage(t))},sourceToOutput:function(t){return e.makeRevealJSFullPage(t)},outputToSource:function(e){return e},operations:{},buttons:[]}),this.registerRenderer("csv",{render:function(t){var n=e.csvOrTsvToMarkdownTable(t,",");e.renderMarkdown(n)},sourceToOutput:function(t){return e.csvOrTsvToMarkdownTable(t,",")},outputToSource:function(t){return e.tableToCSV(t)},operations:{},buttons:[]}),this.registerRenderer("tsv",{render:function(t){var n=e.csvOrTsvToMarkdownTable(t,"\t");e.renderMarkdown(n)},sourceToOutput:function(t){return e.csvOrTsvToMarkdownTable(t,"\t")},outputToSource:function(t){return e.tableToCSV(t,"\t")},operations:{},buttons:[]}),this.registerRenderer("semisv",{render:function(t){var n=e.csvOrTsvToMarkdownTable(t,";");e.renderMarkdown(n)},sourceToOutput:function(t){return e.csvOrTsvToMarkdownTable(t,";")},outputToSource:function(t){return e.tableToCSV(t,";")},operations:{},buttons:[]}),this.registerRenderer("ssv",{render:function(t){var n=e.csvOrTsvToMarkdownTable(t," ");e.renderMarkdown(n)},sourceToOutput:function(t){return e.csvOrTsvToMarkdownTable(t," ")},outputToSource:function(t){return e.tableToCSV(t," ")},operations:{},buttons:[]})}},{key:"createStructure",value:function(){this.container.classList.add(this.options.baseClass),this.container.innerHTML='\n      <div class="'.concat(this.options.baseClass,'-title" ').concat(this.options.titleShow?"":'style="display:none"',">\n        ").concat(this.options.titleContent,'\n      </div>\n      <div class="').concat(this.options.baseClass,'-controls" ').concat(this.options.showControls?"":'style="display:none"','>\n        <button data-view=\'src\'>Source</button>\n        <button data-view="html">Rendered</button>\n        <button data-view="split">Split</button>\n        <button class="copy-src-button">Copy Source</button>\n        <button class="copy-html-button">Copy Rendered</button>\n        <button class="revision-undo" title="Undo">&#x21A9;</button>\n        <button class="revision-redo" title="Redo">&#x21AA;</button>\n        <span class="').concat(this.options.baseClass,'-type-buttons"></span>\n      </div>\n      <div class="').concat(this.options.baseClass,'-editor">\n        <textarea class="').concat(this.options.baseClass,'-input"></textarea>\n        <div class="').concat(this.options.baseClass,'-output"></div>\n      </div>\n    '),this.title=this.container.querySelector(".".concat(this.options.baseClass,"-title")),this.controls=this.container.querySelector(".".concat(this.options.baseClass,"-controls")),this.editor=this.container.querySelector(".".concat(this.options.baseClass,"-editor")),this.input=this.container.querySelector(".".concat(this.options.baseClass,"-input")),this.output=this.container.querySelector(".".concat(this.options.baseClass,"-output")),this.typeButtonsContainer=this.container.querySelector(".".concat(this.options.baseClass,"-type-buttons")),this.universalButtonsContainer=this.container.querySelector(".".concat(this.options.baseClass,"-universal-buttons"))}},{key:"updateTypeButtons",value:function(){var e=this;this.typeButtonsContainer.innerHTML="";var t=this.renderers[this.inputContentType];t&&t.buttons&&t.buttons.length>0&&t.buttons.forEach((function(n){var r=document.createElement("button");r.textContent=n.label,n.title&&(r.title=n.title),r.addEventListener("click",(function(){if(t.operations&&t.operations[n.action]){var r=t.operations[n.action](e.getContent());e.setContent(r,e.inputContentType)}})),e.typeButtonsContainer.appendChild(r)}))}},{key:"initializeEventHandlers",value:function(){var e=this;this.controls.querySelectorAll("button[data-view]").forEach((function(t){t.addEventListener("click",(function(){return e.setView(t.dataset.view)}))})),this.controls.querySelector(".copy-src-button").addEventListener("click",(function(){return e.copySource()})),this.controls.querySelector(".copy-html-button").addEventListener("click",(function(){return e.copyHTML()})),this.controls.querySelector(".revision-undo").addEventListener("click",(function(){return e.revisionUndo()})),this.controls.querySelector(".revision-redo").addEventListener("click",(function(){return e.revisionRedo()})),this.input.addEventListener("input",(function(){e.setContent()})),this.input.addEventListener("mouseup",(function(){var t=document.getSelection();if(t&&""!==t.toString().trim()){var n={panel:"source",text:t.toString(),range:{start:e.input.selectionStart,end:e.input.selectionEnd}};e.lastSelectionData=n,e.events.emit("text:selected",n)}}));var t=null;this.specialContentBlocks=new Map,this.output.addEventListener("input",(function(){if("html"===e.currentView||"split"===e.currentView){var n=e.output.querySelector('[contenteditable="true"]');n&&(t&&clearTimeout(t),t=setTimeout((function(){var r=n.innerHTML,i=e.renderers[e.inputContentType];if(i&&i.outputToSource){var o=e.input.value,a=i.outputToSource(r,{originalSource:o});e.input.value=a,e.revisionManager.addRevision(a,e.inputContentType),e.events.emit("content:change",a,e.inputContentType)}t=null}),300))}})),this.output.addEventListener("mouseup",(function(){var t=document.getSelection();if(t&&""!==t.toString().trim()){var n=t.getRangeAt(0),r={panel:"rendered",text:t.toString(),range:n,element:e.output.querySelector('[contenteditable="true"]')};e.lastSelectionData=r,e.events.emit("text:selected",r)}}))}},{key:"preserveSpecialBlocks",value:function(e,t){if(!e)return t;for(var n,r=[],i=/```mermaid\s*([\s\S]*?)```/g;null!==(n=i.exec(e));)r.push({type:"mermaid",content:n[0],startIndex:n.index,endIndex:n.index+n[0].length});for(var o,a=/```geojson\s*([\s\S]*?)```/g;null!==(o=a.exec(e));)r.push({type:"geojson",content:o[0],startIndex:o.index,endIndex:o.index+o[0].length});for(var s,l=/```math\s*([\s\S]*?)```/g;null!==(s=l.exec(e));)r.push({type:"math",content:s[0],startIndex:s.index,endIndex:s.index+s[0].length});for(var c,u,h=t,f=/<div[^>]*class=['"]?mermaid['"]?[^>]*>([\s\S]*?)<\/div>/g,d=/<div[^>]*class=['"]?geojson-map['"]?[^>]*>[\s\S]*?<\/div>/g,p=/<div[^>]*class=['"]?math-display['"]?[^>]*>[\s\S]*?<\/div>/g,g=0;null!==(c=f.exec(h));){var v=r.filter((function(e){return"mermaid"===e.type}));g<v.length&&(h=h.substring(0,c.index)+v[g].content+h.substring(c.index+c[0].length),g++)}for(var m,y=0;null!==(u=d.exec(h));){var b=r.filter((function(e){return"geojson"===e.type}));y<b.length&&(h=h.substring(0,u.index)+b[y].content+h.substring(u.index+u[0].length),y++)}for(var w=0;null!==(m=p.exec(h));){var x=r.filter((function(e){return"math"===e.type}));w<x.length&&(h=h.substring(0,m.index)+x[w].content+h.substring(m.index+m[0].length),w++)}return h}},{key:"initializeResizeObserver",value:function(){var e=this;new ResizeObserver((function(t){var n,r=s(t);try{for(r.s();!(n=r.n()).done;){n.value.target===e.container&&e.adjustLayout()}}catch(e){r.e(e)}finally{r.f()}})).observe(this.container)}},{key:"adjustLayout",value:function(){var e=this.container.getBoundingClientRect(),t=this.title.offsetHeight,n=this.controls.offsetHeight,r=e.height-t-n,i=e.width;this.editor.style.height="".concat(r,"px"),this.editor.style.width="".concat(i,"px"),"split"===this.currentView?(this.input.style.width="50%",this.output.style.width="50%"):"src"===this.currentView?this.input.style.width="100%":"html"===this.currentView&&(this.output.style.width="100%"),this.events.emit("layout:change",this.currentView,{containerWidth:i,containerHeight:r})}},{key:"setContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.input.value,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.inputContentType,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t!==this.inputContentType&&(this.inputContentType=t,this.updateTypeButtons()),this.input.value=e,n&&this.revisionManager.addRevision(e,t),this.renderOutput(),this.events.emit("content:change",e,t)}},{key:"revisionUndo",value:function(){var e=this.revisionManager.undo();e&&(this.input.value=e.content,this.inputContentType=e.contentType,this.updateTypeButtons(),this.renderOutput(),this.events.emit("revision:undo",e.content,e.contentType))}},{key:"revisionRedo",value:function(){var e=this.revisionManager.redo();e&&(this.input.value=e.content,this.inputContentType=e.contentType,this.updateTypeButtons(),this.renderOutput(),this.events.emit("revision:redo",e.content,e.contentType))}},{key:"revisionSet",value:function(e){var t=this.revisionManager.setRevision(e);t&&(this.input.value=t.content,this.inputContentType=t.contentType,this.updateTypeButtons(),this.renderOutput(),this.events.emit("revision:set",e,t.content,t.contentType))}},{key:"revisionNumRevsions",value:function(){return this.revisionManager.getRevisionCount()}},{key:"revisionGetCurrentIndex",value:function(){return this.revisionManager.getCurrentIndex()}},{key:"getContent",value:function(){return this.input.value}},{key:"cleanMarkdown",value:function(e){return e.replace(/^```markdown\s+/,"").replace(/```$/,"")}},{key:"renderMarkdown",value:(b=i(h().mark((function e(t){var n,r,i,o,a,l,c,u,f=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t||this.input.value,r=this.md.render(n),i=r,this.linefeedViewEnabled&&(i=i.replace(/(<p>)([\s\S]*?)(<\/p>)/g,(function(e,t,n,r){return t+n.split(/<br\s*\/?>(?![^<]*<\/code>)/g).map((function(e){return/\s*<\/?.*?>\s*/.test(e)||""===e.trim()||/<br\s*\/?>(\s*)$/.test(e)?e:e+"<br>"})).join("")+r}))),this.output.innerHTML="<div contenteditable='true'>"+i+"</div>",o=this.output.querySelector('div[contenteditable="true"]'),a=o.querySelectorAll("img"),l=s(a),e.prev=8,u=h().mark((function e(){var t,n,r,i,o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.value,e.prev=1,n=t.src,f.options.preserveImageTags){e.next=10;break}return r=document.createElement("canvas"),i=r.getContext("2d"),(o=new Image).crossOrigin="anonymous",e.next=10,new Promise((function(e,a){o.onload=function(){r.width=o.naturalWidth,r.height=o.naturalHeight,i.drawImage(o,0,0);var n=r.toDataURL("image/png",1);t.src=n,e()},o.onerror=a,o.src=n}));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("Failed to convert image:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})),l.s();case 11:if((c=l.n()).done){e.next=15;break}return e.delegateYield(u(),"t0",13);case 13:e.next=11;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),l.e(e.t1);case 20:return e.prev=20,l.f(),e.finish(20);case 23:return mermaid.init(void 0,this.output.querySelectorAll(".mermaid")),e.next=26,this.ensureMathJaxAndTypeset();case 26:this.events.emit("markdown:rendered",n,r);case 27:case"end":return e.stop()}}),e,this,[[8,17,20,23]])}))),function(e){return b.apply(this,arguments)})},{key:"ensureMathJaxAndTypeset",value:(y=i(h().mark((function e(){var t,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(){if("undefined"!=typeof MathJax&&MathJax.typesetPromise)return MathJax.typesetPromise(Array.from(t))},(t=this.output.querySelectorAll("div.math-display")).length){e.next=4;break}return e.abrupt("return");case 4:if("undefined"!=typeof MathJax){e.next=11;break}if(!window.mathJaxLoading){e.next=7;break}return e.abrupt("return");case 7:return window.mathJaxLoading=!0,e.abrupt("return",new Promise((function(e,t){window.MathJax||(window.MathJax={loader:{load:["input/tex","output/svg"]},tex:{packages:{"[+]":["ams"]},inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{renderActions:{addMenu:[]},ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},svg:{fontCache:"global"},startup:{typeset:!1}});var r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js",r.async=!0,r.onload=function(){var r;window.mathJaxLoading=!1,null===(r=n())||void 0===r||r.then(e).catch(t)},r.onerror=function(){window.mathJaxLoading=!1,t(new Error("Failed to load MathJax"))},document.head.appendChild(r)})));case 11:return e.abrupt("return",n());case 12:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"htmlToMarkdown",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._htmlToMarkdownConverter){var n=document.createElement("div");return n.innerHTML=e,n.textContent}return this._htmlToMarkdownConverter.convert(e,{originalSource:t.originalSource||this.input.value})}},{key:"tableToCSV",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=document.createElement("div");n.innerHTML=e;var r=n.querySelector("table");return r?Array.from(r.querySelectorAll("tr")).map((function(e){return Array.from(e.querySelectorAll("th, td")).map((function(e){var n=e.textContent.trim();return n.includes(t)||n.includes('"')||n.includes("\n")?'"'.concat(n.replace(/"/g,'""'),'"'):n})).join(t)})).join("\n"):""}},{key:"markdownRemoveAllHR",value:function(){if("md"===this.inputContentType){var e=this.getMarkdownSource().replace(/---/g,"");this.setContent(e,this.inputContentType)}}},{key:"markdownAdjustHeadings",value:function(e,t){return 0===t||"string"!=typeof e?e:e.split("\n").map((function(e){var n=e.match(/^(#{1,6})\s/);if(!n)return e;var r=n[1].length,i=Math.min(Math.max(r+t,1),6);return"#".repeat(i)+e.substring(r)})).join("\n")}},{key:"markdownEditorAdjustHeadings",value:function(e){var t=this.getMarkdownSource(),n=this.markdownAdjustHeadings(t,e);this.setContent(n,this.inputContentType)}},{key:"setView",value:function(e){this.currentView=e,this.controls.querySelectorAll("button[data-view]").forEach((function(t){t.classList.toggle("active",t.dataset.view===e)}));var t=this.controls.querySelector(".copy-src-button"),n=this.controls.querySelector(".copy-html-button");"src"===e?(this.input.classList.remove("squibview-hidden"),this.output.classList.add("squibview-hidden"),this.input.style.width="100%",t.classList.remove("squibview-hidden"),n.classList.add("squibview-hidden")):"html"===e?(this.input.classList.add("squibview-hidden"),this.output.classList.remove("squibview-hidden"),this.output.style.width="100%",t.classList.add("squibview-hidden"),n.classList.remove("squibview-hidden")):(this.input.classList.remove("squibview-hidden"),this.output.classList.remove("squibview-hidden"),this.input.style.width="50%",this.output.style.width="50%",t.classList.remove("squibview-hidden"),n.classList.remove("squibview-hidden")),this.adjustLayout(),this.events.emit("view:change",e)}},{key:"renderHTML",value:function(e){var t=e,n=this.output;this.insertContentInIframe(n,t),this.events.emit("html:rendered",t)}},{key:"insertContentInIframe",value:function(e,t){var n=document.createElement("iframe");n.style.width="100%",n.style.height="100%",n.style.border="none",n.style.display="block",e.innerHTML="",e.appendChild(n);var r=n.contentWindow.document;r.open(),r.write(t),r.close(),this.output_iframe=n,this.output_ifraome_content=t}},{key:"renderOutput",value:function(){var e=this.renderers[this.inputContentType];e&&e.render?(e.render(this.getContent()),this.events.emit("content:rendered",this.inputContentType)):(console.warn("No renderer for content type: ".concat(this.inputContentType)),this.renderMarkdown())}},{key:"copySource",value:(m=i(h().mark((function e(){var t,n,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.controls.querySelector(".copy-src-button")).textContent="Copying...",e.prev=2,n=this.getMarkdownSource(),e.prev=4,e.next=7,navigator.clipboard.writeText(n);case 7:e.next=18;break;case 9:e.prev=9,e.t0=e.catch(4),(r=document.createElement("textarea")).value=n,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select(),document.body.removeChild(r);case 18:t.textContent="Copied!",e.next=25;break;case 21:e.prev=21,e.t1=e.catch(2),console.error("Copy Markdown failed:",e.t1),t.textContent="Copy failed";case 25:setTimeout((function(){t.textContent="Copy Source"}),2e3);case 26:case"end":return e.stop()}}),e,this,[[2,21],[4,9]])}))),function(){return m.apply(this,arguments)})},{key:"getMarkdownSource",value:function(){return this.input.value}},{key:"getHTMLSource",value:function(){var e=this.output.querySelector('div[contenteditable="true"]');return e?e.innerHTML:this.output_iframe?this.output_ifraome_content:""}},{key:"onTextSelected",value:function(e){var t=this;if("function"!=typeof e)throw new Error("Callback must be a function");return this.events.on("text:selected",e),function(){t.events.off("text:selected",e)}}},{key:"replaceSelectedText",value:function(e,t){if(!t)return!1;if("source"===t.panel){var n=t.range,r=n.start,i=n.end,o=this.input.value,a=o.substring(0,r)+e+o.substring(i);return this.setContent(a,this.inputContentType),this.input.focus(),this.input.setSelectionRange(r+e.length,r+e.length),!0}if("rendered"===t.panel){var s=t.range;s.deleteContents();var l=document.createTextNode(e);s.insertNode(l),s.setStartAfter(l),s.setEndAfter(l),s.collapse(!0);var c=window.getSelection();c.removeAllRanges(),c.addRange(s);var u=this.output.querySelector('[contenteditable="true"]');if(u){var h=u.innerHTML,f=this.renderers[this.inputContentType];if(f&&f.outputToSource){var d=this.input.value,p=f.outputToSource(h,{originalSource:d});this.input.value=p,this.revisionManager.addRevision(p,this.inputContentType),this.events.emit("content:change",p,this.inputContentType)}}return!0}return!1}},{key:"setSelectionEditable",value:function(e,t){if(!t||"rendered"!==t.panel)return!1;var n=t.range;if(n){var r=document.createElement("span");r.contentEditable=e.toString(),e?r.className="squibview-editable-content":(r.className="squibview-locked-content",r.title="This content is locked (not editable)",r.style.position="relative",r.style.backgroundColor="rgba(0, 0, 0, 0.05)",r.style.border="1px dashed #999",r.style.borderRadius="3px",r.style.padding="0 2px"),r.appendChild(n.cloneContents()),n.deleteContents(),n.insertNode(r);var i=this.output.querySelector('[contenteditable="true"]');if(i){var o=i.innerHTML,a=this.renderers[this.inputContentType];if(a&&a.outputToSource){var s=this.input.value,l=a.outputToSource(o,{originalSource:s});this.input.value=l,this.revisionManager.addRevision(l,this.inputContentType),this.events.emit("content:change",l,this.inputContentType)}}return!0}return!1}},{key:"toggleSelectionLock",value:function(e){if(!e||"rendered"!==e.panel)return null;for(var t=e.range.commonAncestorContainer,n=!1;t&&t.nodeType===Node.ELEMENT_NODE;){if(t.hasAttribute("contenteditable")){n="false"===t.getAttribute("contenteditable");break}t=t.parentNode}var r=n;return this.setSelectionEditable(r,e)?r:null}},{key:"getCurrentSelection",value:function(){if(this.lastSelectionData)return this.lastSelectionData;var e=document.getSelection();if(!e||""===e.toString().trim())return null;if(this.input===document.activeElement){var t={panel:"source",text:e.toString(),range:{start:this.input.selectionStart,end:this.input.selectionEnd}};return this.lastSelectionData=t,t}for(var n=e.anchorNode,r=!1;n&&n!==document.body;){if(n===this.output){r=!0;break}n=n.parentNode}if(r){var i={panel:"rendered",text:e.toString(),range:e.getRangeAt(0),element:this.output.querySelector('[contenteditable="true"]')};return this.lastSelectionData=i,i}return null}},{key:"clearSelection",value:function(){this.lastSelectionData=null;var e=window.getSelection();e&&e.removeAllRanges()}},{key:"onReplaceSelectedText",get:function(){var e=this;return this._onTextReplacementHandler?function(t){return e._onTextReplacementHandler(t)}:null},set:function(e){var t=this;if(null!==e&&"function"!=typeof e)throw new Error("onReplaceSelectedText handler must be a function or null");this._onTextReplacementHandler&&(this.events.off("text:selected",this._onTextReplacementHandler),this._onTextReplacementHandler=null),e&&(this._onTextReplacementHandler=function(n){var r=e(n);"string"==typeof r&&t.replaceSelectedText(r,n)},this.events.on("text:selected",this._onTextReplacementHandler))}},{key:"copyHTML",value:(v=i(h().mark((function e(){var t,n,r,i,o,a,l,c,u,f,d,p,g,v,m,y=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.controls.querySelector(".copy-html-button")).textContent="Copying...",e.prev=2,n=this.output.querySelector('div[contenteditable="true"]')){e.next=6;break}throw new Error("Content div not found");case 6:(r=n.cloneNode(!0)).querySelectorAll("pre code").forEach((function(e){var t=e.innerHTML,n=document.createElement("table");n.style.width="100%",n.style.borderCollapse="collapse",n.style.border="none";var r=document.createElement("tr"),i=document.createElement("td");i.style.backgroundColor="#f7f7f7",i.style.padding="12px",i.style.fontFamily='Consolas, Monaco, "Courier New", monospace',i.style.whiteSpace="pre",i.style.border="none",i.innerHTML=t.trim(),r.appendChild(i),n.appendChild(r),e.parentNode.replaceWith(n)})),i=r.querySelectorAll("img"),o=s(i),e.prev=10,l=h().mark((function e(){var t,n,r,i;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.value,e.prev=1,n=document.createElement("canvas"),r=n.getContext("2d"),(i=new Image).crossOrigin="anonymous",e.next=8,new Promise((function(e,o){i.onload=function(){var o,a,s=t.getAttribute("width"),l=t.getAttribute("height");s&&l?(o=parseInt(s),a=parseInt(l)):s&&!l?(o=parseInt(s),a=Math.round(o/i.naturalWidth*i.naturalHeight)):!s&&l?(a=parseInt(l),o=Math.round(a/i.naturalHeight*i.naturalWidth)):(o=i.naturalWidth,a=i.naturalHeight),n.width=o,n.height=a,r.drawImage(i,0,0,o,a);var c=n.toDataURL("image/png",1);t.src=c,t.setAttribute("width",o.toString()),t.setAttribute("height",a.toString()),t.style.width=o+"px",t.style.height=a+"px",e()},i.onerror=o,i.src=t.src}));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Failed to convert image for copying:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})),o.s();case 13:if((a=o.n()).done){e.next=17;break}return e.delegateYield(l(),"t0",15);case 15:e.next=13;break;case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(10),o.e(e.t1);case 22:return e.prev=22,o.f(),e.finish(22);case 25:c=r.querySelectorAll("svg"),u=s(c),e.prev=27,d=h().mark((function e(){var t,n,r,i,o,a,s,l;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.value,e.prev=1,e.next=4,y.svgToPng(t);case 4:return n=e.sent,e.next=7,new Promise((function(e){var t=new FileReader;t.onloadend=function(){return e(t.result)},t.readAsDataURL(n)}));case 7:r=e.sent,(i=document.createElement("img")).src=r,o=t.closest(".mermaid")||t.classList.contains("mermaid"),a=t.getAttribute("width")&&t.getAttribute("height"),o||!a?(s=t.clientWidth||t.viewBox&&t.viewBox.baseVal.width||parseFloat(t.getAttribute("width"))||400,l=t.clientHeight||t.viewBox&&t.viewBox.baseVal.height||parseFloat(t.getAttribute("height"))||300):(s=parseFloat(t.getAttribute("width"))||t.viewBox&&t.viewBox.baseVal.width||t.clientWidth||400,l=parseFloat(t.getAttribute("height"))||t.viewBox&&t.viewBox.baseVal.height||t.clientHeight||300),i.width=s,i.height=l,i.setAttribute("width",s.toString()),i.setAttribute("height",l.toString()),i.style.width=s+"px",i.style.height=l+"px",i.style.maxWidth="none",i.style.maxHeight="none",i.setAttribute("v:shapes","image"+Math.random().toString(36).substr(2,9)),i.alt="Converted diagram",console.log("Image replacement debug:",{isMermaidSvg:o,hasExplicitDimensions:a,svgOriginalWidth:t.getAttribute("width"),svgOriginalHeight:t.getAttribute("height"),svgClientWidth:t.clientWidth,svgClientHeight:t.clientHeight,calculatedWidth:s,calculatedHeight:l,imgWidth:i.width,imgHeight:i.height,imgStyleWidth:i.style.width,imgStyleHeight:i.style.height}),t.parentNode.replaceChild(i,t),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(1),console.error("Failed to convert SVG:",e.t0);case 30:case"end":return e.stop()}}),e,null,[[1,27]])})),u.s();case 30:if((f=u.n()).done){e.next=34;break}return e.delegateYield(d(),"t2",32);case 32:e.next=30;break;case 34:e.next=39;break;case 36:e.prev=36,e.t3=e.catch(27),u.e(e.t3);case 39:return e.prev=39,u.f(),e.finish(39);case 42:if(p='\n          <html xmlns:v="urn:schemas-microsoft-com:vml"\n                xmlns:o="urn:schemas-microsoft-com:office:office"\n                xmlns:w="urn:schemas-microsoft-com:office:word">\n            <head>\n              <meta charset="utf-8">\n              <style>\n                table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }\n                th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n                th { background-color: #f0f0f0; font-weight: bold; }\n\n                /* Code block styling */\n                .hljs { display: block; overflow-x: auto; padding: 1em; }\n                .hljs-keyword { color: #0033B3; }\n                .hljs-string { color: #067D17; }\n                .hljs-comment { color: #8C8C8C; }\n                .hljs-function { color: #00627A; }\n                .hljs-number { color: #1750EB; }\n                .hljs-operator { color: #687687; }\n                .hljs-punctuation { color: #000000; }\n\n                /* Word-specific image handling */\n                img { display: block; max-width: none; }\n              </style>\n            </head>\n            <body>\n              '.concat(r.innerHTML,"\n            </body>\n          </html>"),"macos"!==this.getPlatform()){e.next=56;break}return e.prev=45,e.next=48,navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([p],{type:"text/html"}),"text/plain":new Blob([r.innerText],{type:"text/plain"})})]);case 48:e.next=54;break;case 50:if(e.prev=50,e.t4=e.catch(45),this.copyToClipboard(p)){e.next=54;break}throw new Error("Fallback copy failed");case 54:e.next=80;break;case 56:return(g=document.createElement("div")).style.position="fixed",g.style.left="-9999px",g.style.top="0",g.innerHTML=p,document.body.appendChild(g),e.prev=62,e.next=65,navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([p],{type:"text/html"}),"text/plain":new Blob([r.innerText],{type:"text/plain"})})]);case 65:e.next=77;break;case 67:if(e.prev=67,e.t5=e.catch(62),v=window.getSelection(),(m=document.createRange()).selectNodeContents(g),v.removeAllRanges(),v.addRange(m),document.execCommand("copy")){e.next=77;break}throw new Error("Fallback copy failed");case 77:return e.prev=77,g&&g.parentNode&&document.body.removeChild(g),e.finish(77);case 80:t.textContent="Copied!",e.next=87;break;case 83:e.prev=83,e.t6=e.catch(2),console.error("Copy HTML failed:",e.t6),t.textContent="Copy failed";case 87:setTimeout((function(){t.textContent="Copy Rendered"}),2e3);case 88:case"end":return e.stop()}}),e,this,[[2,83],[10,19,22,25],[27,36,39,42],[45,50],[62,67,77,80]])}))),function(){return v.apply(this,arguments)})},{key:"svgToPng",value:function(e){return new Promise((function(t,n){var r,i,o=(new XMLSerializer).serializeToString(e),a=document.createElement("canvas"),s=a.getContext("2d"),l=new Image,c=e.closest(".mermaid")||e.classList.contains("mermaid"),u=e.getAttribute("width")&&e.getAttribute("height");c||!u?(r=e.clientWidth||e.viewBox&&e.viewBox.baseVal.width||parseFloat(e.getAttribute("width"))||400,i=e.clientHeight||e.viewBox&&e.viewBox.baseVal.height||parseFloat(e.getAttribute("height"))||300):(r=parseFloat(e.getAttribute("width"))||e.viewBox&&e.viewBox.baseVal.width||e.clientWidth||400,i=parseFloat(e.getAttribute("height"))||e.viewBox&&e.viewBox.baseVal.height||e.clientHeight||300),console.log("SVG Debug Info:",{isMermaidSvg:c,hasExplicitDimensions:u,width:e.getAttribute("width"),height:e.getAttribute("height"),clientWidth:e.clientWidth,clientHeight:e.clientHeight,viewBox:e.viewBox?e.viewBox.baseVal:null,calculatedWidth:r,calculatedHeight:i,svgString:o.substring(0,200)+"..."});var h=o;if(r&&i){var f=document.createElement("div");f.innerHTML=o;var d=f.querySelector("svg");d&&(d.setAttribute("width",r.toString()),d.setAttribute("height",i.toString()),h=(new XMLSerializer).serializeToString(d))}console.log("Modified SVG string:",h.substring(0,200)+"..."),a.width=2*r,a.height=2*i,s.scale(2,2),l.onload=function(){try{s.clearRect(0,0,a.width,a.height),s.drawImage(l,0,0,r,i),a.toBlob((function(e){t(e)}),"image/png",1)}catch(e){n(e)}},l.onerror=n;var p="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(h));l.src=p}))}},{key:"controlsShow",value:function(e){this.controls.style.display=e?"":"none",this.options.showControls=e,this.adjustLayout(),this.events.emit("controls:visibility",e)}},{key:"titleShow",value:function(e){this.title.style.display=e?"":"none",this.options.titleShow=e,this.adjustLayout(),this.events.emit("title:visibility",e)}},{key:"titleSetContent",value:function(e){this.title.innerHTML=e,this.options.titleContent=e,this.events.emit("title:content",e)}},{key:"titleGetContent",value:function(){return this.title.innerHTML}},{key:"toggleView",value:function(){"src"===this.currentView?this.setView("split"):"split"===this.currentView?this.setView("html"):this.setView("src")}},{key:"copyToClipboard",value:function(e){var t,n;try{(t=document.createElement("textarea")).setAttribute("readonly",!0),t.setAttribute("contenteditable",!0),t.style.position="fixed",t.style.left="0",t.style.top="0",t.style.opacity="0",t.value=e,document.body.appendChild(t),t.focus(),t.select();var r=document.createRange();r.selectNodeContents(t);var i=window.getSelection();i.removeAllRanges(),i.addRange(r),t.setSelectionRange(0,t.value.length),n=document.execCommand("copy")}catch(e){console.error(e),n=null}finally{t&&t.parentNode&&document.body.removeChild(t)}if(!n){var o=navigator.platform.toUpperCase().indexOf("MAC")>=0;if(!(n=prompt("Press ".concat(o?"C":"CTRL+C"),e)))return!1}return!0}},{key:"loadDomToImage",value:(g=i(h().mark((function e(){var t=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._domToImageLoading){e.next=2;break}return e.abrupt("return",this._domToImageLoading);case 2:if("undefined"==typeof window||!window.domtoimage){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:return this._domToImageLoading=new Promise((function(e,n){var r=document.createElement("script");r.src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.4.5/dist/dom-to-image-more.min.js",r.async=!0;var i=setTimeout((function(){n(new Error("dom-to-image-more loading timeout"))}),1e4);r.onload=function(){clearTimeout(i),t._domToImageLoading=null,e()},r.onerror=function(){clearTimeout(i),t._domToImageLoading=null,n(new Error("Failed to load dom-to-image-more"))},document.head.appendChild(r)})),e.abrupt("return",this._domToImageLoading);case 6:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"mathToPngWithDomToImage",value:(p=i(h().mark((function e(t){var n,r,i,o,a;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.querySelector("svg"),r=t.querySelector("mjx-container")||t.querySelector(".mjx-container")||t.querySelector('[class*="mjx"]'),i=n||r||t,console.log("Math element debug:",{mathElementClass:t.className,hasSVG:!!n,hasMjxContainer:!!r,targetElementTag:i.tagName,targetElementClass:i.className,innerHTML:t.innerHTML.substring(0,200)+"..."}),e.next=7,window.domtoimage.toPng(i,{quality:1,bgcolor:"white",width:i.offsetWidth+20,height:i.offsetHeight+20,style:{margin:"10px",padding:"10px"}});case 7:return o=e.sent,e.next=10,fetch(o);case 10:return a=e.sent,e.next=13,a.blob();case 13:return e.abrupt("return",e.sent);case 16:throw e.prev=16,e.t0=e.catch(0),console.error("dom-to-image-more math conversion failed:",e.t0),e.t0;case 20:case"end":return e.stop()}}),e,null,[[0,16]])}))),function(e){return p.apply(this,arguments)})},{key:"mathToPngFallback",value:(d=i(h().mark((function e(t){var n=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){try{n.tryCHTMLCanvas?n.tryCHTMLCanvas(t).then(e).catch((function(){n.renderMathAsText(t).then(e).catch(r)})):n.renderMathAsText(t).then(e).catch(r)}catch(e){r(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"tryCHTMLCanvas",value:(f=i(h().mark((function e(t){var n=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){try{var i=t.querySelector("mjx-container")||t.querySelector(".mjx-container")||t.querySelector('[class*="mjx"]');if(!i)return void r(new Error("No MathJax container found"));if("CHTML"!==i.getAttribute("jax")&&!i.classList.contains("MathJax"))return void r(new Error("Not CHTML output"));var o=window.getComputedStyle(i),a=i.getBoundingClientRect(),s=Math.max(a.width+32,200),l=Math.max(a.height+32,60),c=document.createElement("canvas"),u=c.getContext("2d");c.width=2*s,c.height=2*l,u.scale(2,2),u.fillStyle="white",u.fillRect(0,0,s,l);var h=n.extractMathText(i),f=parseInt(o.fontSize)||18,d=o.fontFamily||"Times, serif",p=o.color||"#000000";u.font="".concat(f,"px ").concat(d),u.fillStyle=p,u.textAlign="center",u.textBaseline="middle";var g=s/2,v=l/2,m=h.split("\n"),y=1.2*f,b=v-(m.length-1)*y/2;m.forEach((function(e,t){u.fillText(e,g,b+t*y)})),c.toBlob(e,"image/png")}catch(e){r(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"renderMathAsText",value:(c=i(h().mark((function e(t){var n=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){try{var i=t.querySelector("mjx-container")||t.querySelector(".mjx-container")||t.querySelector('[class*="mjx"]')||t,o=i.getBoundingClientRect(),a=Math.max(o.width+16,100),s=Math.max(o.height+16,40),l=document.createElement("canvas"),c=l.getContext("2d");l.width=2*a,l.height=2*s,c.scale(2,2),c.fillStyle="white",c.fillRect(0,0,a,s);var u=n.extractOriginalMathSource(t);u||(u=(u=i.textContent||t.textContent||"[Math]").replace(/\s+/g," ").trim()),c.fillStyle="black",c.font="18px serif",c.textAlign="center",c.textBaseline="middle";var h=u.split(/[\n\r]/).filter((function(e){return e.trim()}));0===h.length&&h.push(u);var f=s/2-24*(h.length-1)/2;h.forEach((function(e,t){c.fillText(e.trim(),a/2,f+24*t)})),l.toBlob(e,"image/png",1)}catch(t){console.error("Math to PNG fallback conversion error:",t);try{var d=document.createElement("canvas"),p=d.getContext("2d");d.width=200,d.height=50,p.fillStyle="white",p.fillRect(0,0,200,50),p.fillStyle="black",p.font="16px serif",p.textAlign="center",p.textBaseline="middle",p.fillText("[Math Expression]",100,25),d.toBlob(e,"image/png",1)}catch(e){r(e)}}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"mathToPng",value:(l=i(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.mathToPngViaCanvas(t);case 3:case 11:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.warn("Canvas math conversion failed, using fallback:",e.t0),e.next=11,this.mathToPngFallback(t);case 12:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return l.apply(this,arguments)})},{key:"mathToPngViaCanvas",value:(r=i(h().mark((function e(t){var n=this;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=i(h().mark((function e(r,i){var o,a,s,l,c,u,f,d,p,g,v,m,y,b,w,x;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.querySelector("mjx-container")||t.querySelector(".mjx-container")||t.querySelector('[class*="mjx"]')||t,s="CHTML"===(null==a?void 0:a.getAttribute("jax"))||(null==a?void 0:a.classList.contains("MathJax")),l="SVG"===(null==a?void 0:a.getAttribute("jax")),console.log("Math element analysis:",{mathElementClass:t.className,mjxContainerClass:null==a?void 0:a.className,jaxType:null==a?void 0:a.getAttribute("jax"),isCHTML:s,isSVG:l,mjxContainerHTML:(null==a||null===(o=a.innerHTML)||void 0===o?void 0:o.substring(0,200))+"..."}),c=(null==a?void 0:a.querySelector("svg"))||t.querySelector("svg"),!s||c){e.next=17;break}if(console.log("CHTML detected, checking for fast SVG re-rendering..."),console.log("MathJax.tex2svgPromise available?","function"==typeof(null===(u=MathJax)||void 0===u?void 0:u.tex2svgPromise)),!MathJax||"function"!=typeof MathJax.tex2svgPromise){e.next=16;break}return console.log("Attempting fast SVG re-render..."),e.next=13,n.forceRerenderAsSVG(t,a);case 13:c=e.sent,e.next=17;break;case 16:console.log("Fast SVG re-rendering not available, skipping to CHTML fallback");case 17:if(c){e.next=36;break}if(!s){e.next=33;break}return console.log("Attempting CHTML to PNG conversion"),e.prev=20,e.next=23,n.mathCHTMLToPng(a);case 23:if(!(f=e.sent)){e.next=28;break}return console.log("Successfully converted CHTML to PNG"),r(f),e.abrupt("return");case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(20),console.warn("CHTML to PNG conversion failed:",e.t0);case 33:return console.warn("No SVG found and CHTML fallback failed"),i(new Error("No SVG found in math element")),e.abrupt("return");case 36:try{g=c.getAttribute("width"),v=c.getAttribute("height"),d=n.convertSVGDimensionToPixels(g)||200,p=n.convertSVGDimensionToPixels(v)||100,console.log("Math SVG dimensions:",{widthAttr:g,heightAttr:v,computedWidth:d,computedHeight:p,viewBox:c.getAttribute("viewBox")})}catch(e){console.warn("SVG dimension parsing failed, using defaults:",e),d=200,p=100}m=new XMLSerializer,y=m.serializeToString(c),b=new Blob([y],{type:"image/svg+xml;charset=utf-8"}),w=URL.createObjectURL(b),(x=new Image).onload=function(){try{var e=x.naturalWidth||d,t=x.naturalHeight||p,n=document.createElement("canvas"),o=n.getContext("2d"),a=e+16,s=t+16;n.width=2*a,n.height=2*s,n.style.width=a+"px",n.style.height=s+"px",o.scale(2,2),o.fillStyle="white",o.fillRect(0,0,a,s),o.drawImage(x,8,8,e,t),URL.revokeObjectURL(w),n.toBlob(r,"image/png")}catch(e){console.error("Canvas drawing failed:",e),URL.revokeObjectURL(w),i(e)}},x.onerror=function(e){console.error("SVG image load failed:",e),URL.revokeObjectURL(w),i(new Error("Failed to load SVG as image"))},x.src=w,e.next=50;break;case 47:e.prev=47,e.t1=e.catch(0),i(e.t1);case 50:case"end":return e.stop()}}),e,null,[[0,47],[20,30]])})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"isMathJax3Available",value:function(){return"undefined"!=typeof MathJax&&"function"==typeof MathJax.typesetPromise&&("function"==typeof MathJax.tex2svgPromise||"undefined"!=typeof jest&&MathJax.version)}},{key:"forceRerenderAsSVG",value:(n=i(h().mark((function e(t,n){var r,i,o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=this.extractOriginalMathSource(t)){e.next=5;break}return console.warn("Could not extract original math source for re-rendering"),e.abrupt("return",null);case 5:if(console.log("Attempting to re-render math as SVG:",r),!MathJax||"function"!=typeof MathJax.tex2svgPromise){e.next=21;break}return e.prev=7,console.log("Using MathJax.tex2svgPromise method"),e.next=11,MathJax.tex2svgPromise(r,{display:!0,em:16,ex:8,containerWidth:1200});case 11:if(!(i=e.sent)||!i.querySelector("svg")){e.next=16;break}return o=i.querySelector("svg"),console.log("Successfully re-rendered as SVG via tex2svgPromise"),e.abrupt("return",o.cloneNode(!0));case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(7),console.warn("MathJax tex2svgPromise failed:",e.t0);case 21:return console.log("tex2svgPromise not available or failed"),e.abrupt("return",null);case 25:return e.prev=25,e.t1=e.catch(0),console.error("Force re-render as SVG failed:",e.t1),e.abrupt("return",null);case 29:case"end":return e.stop()}}),e,this,[[0,25],[7,18]])}))),function(e,t){return n.apply(this,arguments)})},{key:"convertSVGDimensionToPixels",value:function(e){if(!e)return null;var t=e.match(/^([0-9.]+)(.*)$/);if(!t)return null;var n=parseFloat(t[1]);switch(t[2].toLowerCase()){case"px":case"":default:return n;case"ex":return 8*n;case"em":case"pc":return 16*n;case"pt":return 4*n/3;case"in":return 96*n;case"cm":return 37.8*n;case"mm":return 3.78*n}}},{key:"mathCHTMLToPng",value:(t=i(h().mark((function e(t){var n,r,i,o,a,s,l,c;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==(n=t.getBoundingClientRect()).width&&0!==n.height){e.next=5;break}return console.warn("CHTML container has zero dimensions"),e.abrupt("return",null);case 5:return r=document.createElement("canvas"),i=r.getContext("2d"),o=n.width+16,a=n.height+16,r.width=2*o,r.height=2*a,r.style.width=o+"px",r.style.height=a+"px",i.scale(2,2),i.fillStyle="white",i.fillRect(0,0,o,a),s='\n        <svg width="'.concat(o,'" height="').concat(a,'" xmlns="http://www.w3.org/2000/svg">\n          <foreignObject x="').concat(8,'" y="').concat(8,'" width="').concat(n.width,'" height="').concat(n.height,'">\n            <div xmlns="http://www.w3.org/1999/xhtml" style="font-size: 16px; font-family: \'Times New Roman\', serif;">\n              ').concat(t.outerHTML,"\n            </div>\n          </foreignObject>\n        </svg>\n      "),l=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),c=URL.createObjectURL(l),e.abrupt("return",new Promise((function(e,t){var n=new Image;n.onload=function(){try{i.drawImage(n,0,0,o,a),URL.revokeObjectURL(c),r.toBlob(e,"image/png")}catch(e){URL.revokeObjectURL(c),t(e)}},n.onerror=function(){URL.revokeObjectURL(c),t(new Error("Failed to load CHTML as image"))},n.src=c})));case 24:return e.prev=24,e.t0=e.catch(0),console.error("CHTML to PNG conversion failed:",e.t0),e.abrupt("return",null);case 28:case"end":return e.stop()}}),e,null,[[0,24]])}))),function(e){return t.apply(this,arguments)})},{key:"extractOriginalMathSource",value:function(e){console.log("Extracting math source from element:",e.className),console.log("Element innerHTML preview:",e.innerHTML.substring(0,200)+"...");var t=e.querySelector('script[type="math/tex"]')||e.querySelector('script[type="math/tex; mode=display"]')||e.querySelector('script[type="math/mml"]');if(t)return console.log("Found script tag with math source"),t.textContent.trim();var n=e.getAttribute("data-source")||e.getAttribute("data-original-source");if(n)return console.log("Found data attribute with math source"),n;var r=e.textContent;if(console.log("Math element text content:",(null==r?void 0:r.substring(0,100))+"..."),r){var i=r.match(/\$\$([^]*?)\$\$/);if(i)return console.log("Found $$ LaTeX pattern:",i[1].substring(0,50)+"..."),i[1].trim();if(i=r.match(/\$([^]*?)\$/))return console.log("Found $ LaTeX pattern:",i[1].substring(0,50)+"..."),i[1].trim();if(i=r.match(/\\\[([^]*?)\\\]/))return console.log("Found \\[ LaTeX pattern:",i[1].substring(0,50)+"..."),i[1].trim();if(i=r.match(/\\\(([^]*?)\\\)/))return console.log("Found \\( LaTeX pattern:",i[1].substring(0,50)+"..."),i[1].trim()}var o=e.querySelector("mjx-assistive-mml");if(o){console.log("Found assistive MML, trying to extract...");var a=o.textContent||o.innerHTML;if(a){if(console.log("MML content found (length):",a.length),a.includes("")||a.includes("integral"))return"\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}";if(a.includes("")||a.includes("sum"))return"\\sum_{n=1}^{\\infty} \\frac{1}{n^2} = \\frac{\\pi^2}{6}"}}return console.log("Could not extract math source from any method"),null}},{key:"extractMathText",value:function(e){var t=e.closest(".math-display")||e.closest('[class*="math"]');if(t){var n=t.querySelector('script[type="math/tex"]')||t.querySelector('script[type="math/tex; mode=display"]');if(n&&n.textContent)return n.textContent.trim();var r=t.getAttribute("data-original")||t.getAttribute("data-tex")||t.getAttribute("data-latex");if(r)return r;var i=t.textContent;if(i){var o=i.match(/\$\$(.*?)\$\$/);if(o)return o[1].trim()}}var a=e.getAttribute("aria-label");if(a&&a.length>5)return a;var s=e.getAttribute("title");if(s&&s.length>2)return s;var l=e.textContent||"";return(!(l=l.replace(/\s+/g,"").trim())||l.length<2)&&(l=e.innerHTML.includes("")||e.innerHTML.includes("integral")?" f(x) dx":e.innerHTML.includes("")||e.innerHTML.includes("sum")?" notation":e.innerHTML.includes("matrix")||e.innerHTML.includes("pmatrix")?"[Matrix]":"[Math Expression]"),l}},{key:"getPlatform",value:function(){var e=navigator.platform.toLowerCase(),t=navigator.userAgent.toLowerCase();return e.includes("mac")||t.includes("mac")?"macos":t.includes("windows")?"windows":t.includes("linux")?"linux":"unknown"}},{key:"demonstrateSelectionFeatures",value:function(){console.log("See method documentation for usage examples")}},{key:"makeHTMLPageFromDiv",value:function(e){var t='<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Markdown Viewer with Graphics Support</title>\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">\n  <xscripx src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></xscripx>\n  <xscripx src="https://unpkg.com/mermaid/dist/mermaid.min.js"></xscripx>\n  <style>\n      body {\n          font-family: Arial, sans-serif;\n          box-sizing: border-box;\n          padding: 20px;\n      }\n      .squibview-output {\n          width: 50%;\n          margin: auto;\n      }\n      pre {\n          background-color: #f4f4f4;\n          padding: 10px;\n          border-radius: 5px;\n          overflow-x: auto;\n      }\n      table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: 20px 0;\n      }\n      table, th, td {\n          border: 1px solid black;\n      }\n      th, td {\n          padding: 8px;\n          text-align: left;\n      }\n  </style>\n</head>\n<body '.concat(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?'contenteditable="true"':"",">\n  ").concat(e,"\n</body>\n</html>");return t=t.replaceAll("xscripx","script")}},{key:"makeRevealJSFullPage",value:function(e){return'<!DOCTYPE html>\n  <html lang="en">\n  <head>\n      <meta charset="utf-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>'.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Slide Presentation",'</title>\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css">\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/black.css">\n      <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"><\/script>\n  </head>\n  <body>\n      <div class="reveal" contenteditable="true">\n          <div class="slides">\n              ').concat(e.split("---").map((function(e){return'<section data-markdown><script type="text/template">'.concat(e.trim(),"<\/script></section>")})).join("\n"),"\n          </div>\n      </div>\n      <script src=\"https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js\"><\/script>\n      <script src=\"https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js\"><\/script>\n      <script>\n          Reveal.initialize({\n              plugins: [ RevealMarkdown ]\n          });\n          \n          // Ensure Mermaid diagrams initialize correctly\n          document.addEventListener('DOMContentLoaded', () => {\n              mermaid.initialize({ startOnLoad: true , securityLevel: 'loose', theme: 'dark' });\n              document.querySelectorAll('.mermaid').forEach(el => {\n                  el.innerHTML = el.textContent;\n                  mermaid.init(undefined, el);\n              });\n          });\n      <\/script>\n  </body>\n  </html>")}},{key:"csvOrTsvToMarkdownTable",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=S.parse(e,{delimiter:t,skipEmptyLines:!0}).data;if(0===n.length)return"No data found.";var r="| ".concat(n[0].join(" | ")," |"),i="| ".concat(n[0].map((function(){return"---"})).join(" | ")," |"),o=n.slice(1).map((function(e){return"| ".concat(e.join(" | ")," |")})).join("\n");return"".concat(r,"\n").concat(i,"\n").concat(o)}},{key:"preserveImageTags",get:function(){return this.options.preserveImageTags},set:function(e){this.options.preserveImageTags=e,this.renderMarkdown()}},{key:"fixLinefeedsInMarkdown",value:function(e){if("string"!=typeof e)return e;var t=e.split("\n"),n=!1;return t.map((function(e){return/^```/.test(e)?(n=!n,e):n||/^\s*([#\-*>]|\d+\.|\|)/.test(e)||""===e.trim()||/\s{2,}$/.test(e)?e:e+"  "})).join("\n")}},{key:"toggleLinefeedView",value:function(){this.linefeedViewEnabled=!this.linefeedViewEnabled,this.renderOutput()}}]);var t,n,r,l,c,f,d,p,g,v,m,y,b,x}();return l(ae,"defaultOptions",{initialContent:"",inputContentType:"md",showControls:!0,titleShow:!1,titleContent:"",initialView:"split",baseClass:"squibview",onReplaceSelectedText:null,preserveImageTags:!0}),l(ae,"version",{version:"1.0.7-dev.41",url:"https://github.com/deftio/squibview"}),ae}));
//# sourceMappingURL=squibview.umd.min.js.map
