!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).SquibView=e()}(this,(function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function e(t,e,n,r,i,o,a){try{var s=t[o](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function n(t){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=t.apply(n,r);function s(t){e(a,i,o,s,c,"next",t)}function c(t){e(a,i,o,s,c,"throw",t)}s(void 0)}))}}function r(t,e,n){return function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,l(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var t=r.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function o(t,e,n){return(e=l(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(){c=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),s=new q(r||[]);return i(a,"_invoke",{value:T(t,n,s)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p="suspendedStart",f="suspendedYield",v="executing",m="completed",y={};function b(){}function g(){}function w(){}var x={};u(x,a,(function(){return this}));var k=Object.getPrototypeOf,C=k&&k(k(A([])));C&&C!==n&&r.call(C,a)&&(x=C);var L=w.prototype=b.prototype=Object.create(x);function j(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(i,o,a,s){var c=h(t[i],t,o);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(u).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=p;return function(o,a){if(i===v)throw Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var c=E(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=v;var l=h(e,n,r);if("normal"===l.type){if(i=r.done?m:f,l.arg===y)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=m,r.method="throw",r.arg=l.arg)}}}function E(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=h(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function q(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function A(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return g.prototype=w,i(L,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:g,configurable:!0}),g.displayName=u(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,u(t,l,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},j(S.prototype),u(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new S(d(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},j(L),u(L,l,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=A,q.prototype={constructor:q,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),M(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function l(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var u=function(){return r((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options=s(s({},t.defaultOptions),n),this.options.show_md_buttons=this.options.show_md_buttons&&"md"===this.options.inputContentType,this.container="string"==typeof e?document.querySelector(e):e,!this.container)throw new Error("Container element not found");this.revisions={buffer:[],index:0},this.initializeLibraries(),this.createStructure(),this.initializeEventHandlers(),this.initializeResizeObserver(),this.options.initialContent&&this.setContent(this.options.initialContent,this.options.inputContentType),this.setView(this.options.initialView)}),[{key:"initializeLibraries",value:function(){mermaid.initialize({startOnLoad:!1,securityLevel:"loose",theme:"default",errorCallback:function(t){return console.warn("Mermaid error:",t),"<div class='mermaid-error'></div>"}}),mermaid.init(void 0,".mermaid"),this.md=window.markdownit({html:!0,linkify:!0,typographer:!0,highlight:function(t,e){if(e&&hljs.getLanguage(e))try{return hljs.highlight(t,{language:e}).value}catch(t){}return""}});var t=this.md.renderer.rules.fence||function(t,e,n,r,i){return i.renderToken(t,e,n)};this.md.renderer.rules.fence=function(e,n,r,i,o){var a=e[n],s=a.info.trim();return"mermaid"===s?'<div class="mermaid">'+a.content+"</div>":"svg"===s?a.content:t(e,n,r,i,o)}}},{key:"createStructure",value:function(){this.container.classList.add(this.options.baseClass),this.md_buttons=this.options.show_md_buttons?'<button  onclick="editor.markdownRemoveAllHR()">Remove HR</button>\n  <button  onclick="editor.markdownEditorAdjustHeadings(-1)">H-</button>\n  <button  onclick="editor.markdownEditorAdjustHeadings(+1)">H+</button>\n  <button  onclick="editor.revisionUndo()">&#x21A9</button>\n  <button  onclick="editor.revisionRedo()">&#x21AA</button>':"",this.container.innerHTML='\n        <div class="'.concat(this.options.baseClass,'-title" ').concat(this.options.titleShow?"":'style="display:none"',">\n          ").concat(this.options.titleContent,'\n        </div>\n        <div class="').concat(this.options.baseClass,'-controls" ').concat(this.options.showControls?"":'style="display:none"','>\n          <button data-view=\'src\'>Source</button>\n          <button data-view="html">Rendered</button>\n          <button data-view="split">Split</button>\n          <button class="copy-src-button">Copy Source</button>\n          <button class="copy-html-button">Copy Rendered</button>\n          <span>').concat(this.md_buttons,'</span>\n        </div>\n        <div class="').concat(this.options.baseClass,'-editor">\n          <textarea class="').concat(this.options.baseClass,'-input"></textarea>\n          <div class="').concat(this.options.baseClass,'-output"></div>\n        </div>\n      '),this.title=this.container.querySelector(".".concat(this.options.baseClass,"-title")),this.controls=this.container.querySelector(".".concat(this.options.baseClass,"-controls")),this.editor=this.container.querySelector(".".concat(this.options.baseClass,"-editor")),this.input=this.container.querySelector(".".concat(this.options.baseClass,"-input")),this.output=this.container.querySelector(".".concat(this.options.baseClass,"-output"))}},{key:"initializeEventHandlers",value:function(){var t=this;this.controls.querySelectorAll("button[data-view]").forEach((function(e){e.addEventListener("click",(function(){return t.setView(e.dataset.view)}))})),this.controls.querySelector(".copy-src-button").addEventListener("click",(function(){return t.copySource()})),this.controls.querySelector(".copy-html-button").addEventListener("click",(function(){return t.copyHTML()})),this.input.addEventListener("input",(function(){t.setContent()}))}},{key:"initializeResizeObserver",value:function(){var t=this;new ResizeObserver((function(e){var n,r=i(e);try{for(r.s();!(n=r.n()).done;){n.value.target===t.container&&t.adjustLayout()}}catch(t){r.e(t)}finally{r.f()}})).observe(this.container)}},{key:"adjustLayout",value:function(){var t=this.container.getBoundingClientRect(),e=this.title.offsetHeight,n=this.controls.offsetHeight,r=t.height-e-n,i=t.width;this.editor.style.height="".concat(r,"px"),this.editor.style.width="".concat(i,"px"),"split"===this.currentView?(this.input.style.width="50%",this.output.style.width="50%"):"src"===this.currentView?this.input.style.width="100%":"html"===this.currentView&&(this.output.style.width="100%")}},{key:"setContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.input.value,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.inputContentType,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.input.value=t,this.inputContentType=e,n&&(this.revisions.buffer.push({content:t,contentType:e}),this.revisions.index=this.revisions.buffer.length-1,this.revisions.buffer=this.revisions.buffer.slice(0,this.revisions.index+1)),this.renderOutput()}},{key:"revisionUndo",value:function(){if(this.revisions.buffer.length>0&&this.revisions.index>0){this.revisions.index--;var t=this.revisions.buffer[this.revisions.index];this.input.value=t.content,this.inputContentType=t.contentType,this.renderOutput()}}},{key:"revisionRedo",value:function(){if(this.revisions.index<this.revisions.buffer.length-1){this.revisions.index++;var t=this.revisions.buffer[this.revisions.index];this.input.value=t.content,this.inputContentType=t.contentType,this.renderOutput()}}},{key:"revisionSet",value:function(t){if(t>=0&&t<this.revisions.buffer.length){this.revisions.index=t;var e=this.revisions.buffer[this.revisions.index];this.input.value=e.content,this.inputContentType=e.contentType,this.renderOutput()}}},{key:"revisionNumRevsions",value:function(){return this.revisions.buffer.length}},{key:"revisionGetCurrentIndex",value:function(){return this.revisions.index}},{key:"getContent",value:function(){return this.input.value}},{key:"cleanMarkdown",value:function(t){return t.replace(/^```markdown\s+/,"").replace(/```$/,"")}},{key:"renderMarkdown",value:(a=n(c().mark((function t(e){var n,r,o,a,s,l,u;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e||this.input.value,r=this.md.render(n),this.output.innerHTML="<div contenteditable='true'>"+r+"</div>",o=this.output.querySelector('div[contenteditable="true"]'),a=o.querySelectorAll("img"),s=i(a),t.prev=6,u=c().mark((function t(){var e,n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=l.value,t.prev=1,n=document.createElement("canvas"),r=n.getContext("2d"),(i=new Image).crossOrigin="anonymous",t.next=8,new Promise((function(t,o){i.onload=function(){n.width=i.naturalWidth,n.height=i.naturalHeight,r.drawImage(i,0,0);var o=n.toDataURL("image/png",1);e.src=o,t()},i.onerror=o,i.src=e.src}));case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("Failed to convert image:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,10]])})),s.s();case 9:if((l=s.n()).done){t.next=13;break}return t.delegateYield(u(),"t0",11);case 11:t.next=9;break;case 13:t.next=18;break;case 15:t.prev=15,t.t1=t.catch(6),s.e(t.t1);case 18:return t.prev=18,s.f(),t.finish(18);case 21:mermaid.init(void 0,this.output.querySelectorAll(".mermaid"));case 22:case"end":return t.stop()}}),t,this,[[6,15,18,21]])}))),function(t){return a.apply(this,arguments)})},{key:"markdownRemoveAllHR",value:function(){if("md"===this.inputContentType){var t=this.getMarkdownSource().replace(/---/g,"");this.setContent(t,this.inputContentType)}}},{key:"markdownAdjustHeadings",value:function(t,e){return 0===e||"string"!=typeof t?t:t.split("\n").map((function(t){var n=t.match(/^(#{1,6})\s/);if(!n)return t;var r=n[1].length,i=Math.min(Math.max(r+e,1),6);return"#".repeat(i)+t.substring(r)})).join("\n")}},{key:"markdownEditorAdjustHeadings",value:function(t){var e=this.getMarkdownSource(),n=this.markdownAdjustHeadings(e,t);this.setContent(n,this.inputContentType)}},{key:"setView",value:function(t){this.currentView=t,this.controls.querySelectorAll("button[data-view]").forEach((function(e){e.classList.toggle("active",e.dataset.view===t)}));var e=this.controls.querySelector(".copy-src-button"),n=this.controls.querySelector(".copy-html-button");"src"===t?(this.input.classList.remove("squibview-hidden"),this.output.classList.add("squibview-hidden"),this.input.style.width="100%",e.classList.remove("squibview-hidden"),n.classList.add("squibview-hidden")):"html"===t?(this.input.classList.add("squibview-hidden"),this.output.classList.remove("squibview-hidden"),this.output.style.width="100%",e.classList.add("squibview-hidden"),n.classList.remove("squibview-hidden")):(this.input.classList.remove("squibview-hidden"),this.output.classList.remove("squibview-hidden"),this.input.style.width="50%",this.output.style.width="50%",e.classList.remove("squibview-hidden"),n.classList.remove("squibview-hidden")),this.adjustLayout()}},{key:"copyContent",value:(o=n(c().mark((function t(){var e,r,o,a,s,l,u,d,h,p=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=this.controls.querySelector(".copy-button")).textContent="Copying...",t.prev=2,r=this.output.querySelector('div[contenteditable="true"]')){t.next=6;break}throw new Error("Content div not found");case 6:(o=r.cloneNode(!0)).querySelectorAll("pre code").forEach((function(t){var e=t.innerHTML,n=document.createElement("table");n.style.width="100%",n.style.borderCollapse="collapse",n.style.border="none";var r=document.createElement("tr"),i=document.createElement("td");i.style.backgroundColor="#f7f7f7",i.style.padding="12px",i.style.fontFamily='Consolas, Monaco, "Courier New", monospace',i.style.whiteSpace="pre",i.style.border="none",i.innerHTML=e.trim(),r.appendChild(i),n.appendChild(r),t.parentNode.replaceWith(n)})),a=o.querySelectorAll("svg"),s=i(a),t.prev=10,u=c().mark((function t(){var e,n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=l.value,t.prev=1,t.next=4,p.svgToPng(e);case 4:return n=t.sent,t.next=7,new Promise((function(t){var e=new FileReader;e.onloadend=function(){return t(e.result)},e.readAsDataURL(n)}));case 7:r=t.sent,(i=document.createElement("img")).src=r,i.width=e.clientWidth||e.viewBox.baseVal.width||100,i.height=e.clientHeight||e.viewBox.baseVal.height||100,i.setAttribute("v:shapes","image"+Math.random().toString(36).substr(2,9)),i.style.width=i.width+"px",i.style.height=i.height+"px",i.alt="Converted diagram",e.parentNode.replaceChild(i,e),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(1),console.error("Failed to convert SVG:",t.t0);case 22:case"end":return t.stop()}}),t,null,[[1,19]])})),s.s();case 13:if((l=s.n()).done){t.next=17;break}return t.delegateYield(u(),"t0",15);case 15:t.next=13;break;case 17:t.next=22;break;case 19:t.prev=19,t.t1=t.catch(10),s.e(t.t1);case 22:return t.prev=22,s.f(),t.finish(22);case 25:return d=o.querySelectorAll("img"),t.next=28,Promise.all(d.map(function(){var t=n(c().mark((function t(e){var n,r,i,o,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Converting image:",e.src),n=document.createElement("canvas"),r=n.getContext("2d"),(i=new Image).crossOrigin="anonymous",t.prev=5,t.next=8,new Promise((function(t,n){i.onload=t,i.onerror=n,i.src=e.src}));case 8:return n.width=i.offsetWidth||e.offsetWidth||200,n.height=i.offsetHeight||e.offsetHeight||200,r.drawImage(i,0,0),o=n.toDataURL("image/png",1),a=new Image,t.next=15,new Promise((function(t,r){a.onload=function(){a.alt=e.alt||"Converted image",a.width=n.width,a.height=n.height,a.style.cssText=e.style.cssText,a.setAttribute("data-embedded","true"),e.parentNode.replaceChild(a,e),console.log("Successfully converted image to data URL"),t()},a.onerror=r,a.src=o}));case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),console.error("Error converting image:",t.t0,e.src);case 20:case"end":return t.stop()}}),t,null,[[5,17]])})));return function(e){return t.apply(this,arguments)}}()));case 28:return h=new ClipboardItem({"text/html":new Blob(['\n            <html xmlns:v="urn:schemas-microsoft-com:vml"\n                  xmlns:o="urn:schemas-microsoft-com:office:office"\n                  xmlns:w="urn:schemas-microsoft-com:office:word">\n              <head>\n                <meta charset="utf-8">\n                <style>\n                  table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }\n                  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n                  th { background-color: #f0f0f0; font-weight: bold; }\n\n                  /* Code block styling */\n                  .hljs { display: block; overflow-x: auto; padding: 1em; }\n                  .hljs-keyword { color: #0033B3; }\n                  .hljs-string { color: #067D17; }\n                  .hljs-comment { color: #8C8C8C; }\n                  .hljs-function { color: #00627A; }\n                  .hljs-number { color: #1750EB; }\n                  .hljs-operator { color: #687687; }\n                  .hljs-punctuation { color: #000000; }\n\n                  /* Word-specific image handling */\n                  img { display: block; max-width: none; }\n                </style>\n              </head>\n              <body>\n                '.concat(o.innerHTML,"\n              </body>\n            </html>\n          ")],{type:"text/html"}),"text/plain":new Blob([o.innerText],{type:"text/plain"})}),t.next=31,navigator.clipboard.write([h]);case 31:e.textContent="Copied!",t.next=38;break;case 34:t.prev=34,t.t2=t.catch(2),console.error("Copy failed:",t.t2),e.textContent="Copy failed";case 38:setTimeout((function(){e.textContent="Copy"}),2e3);case 39:case"end":return t.stop()}}),t,this,[[2,34],[10,19,22,25]])}))),function(){return o.apply(this,arguments)})},{key:"svgToPng",value:function(t){return new Promise((function(e,n){var r=(new XMLSerializer).serializeToString(t),i=document.createElement("canvas"),o=i.getContext("2d"),a=new Image,s=t.clientWidth||t.viewBox.baseVal.width||100,c=t.clientHeight||t.viewBox.baseVal.height||100;i.width=2*s,i.height=2*c,o.scale(2,2),a.onload=function(){try{o.clearRect(0,0,i.width,i.height),o.drawImage(a,0,0,s,c),i.toBlob((function(t){e(t)}),"image/png",1)}catch(t){n(t)}},a.onerror=n;var l="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(r));a.src=l}))}},{key:"controlsShow",value:function(t){this.controls.style.display=t?"":"none",this.options.showControls=t,this.adjustLayout()}},{key:"titleShow",value:function(t){this.title.style.display=t?"":"none",this.options.titleShow=t,this.adjustLayout()}},{key:"titleSetContent",value:function(t){this.title.innerHTML=t,this.options.titleContent=t}},{key:"titleGetContent",value:function(){return this.title.innerHTML}},{key:"getMarkdownSource",value:function(){return this.input.value}},{key:"getHTMLSource",value:function(){return this.output.querySelector('div[contenteditable="true"]').innerHTML}},{key:"toggleView",value:function(){var t=window.editor;"src"===t.currentView?t.setView("split"):"split"===t.currentView?t.setView("html"):t.setView("src"),console.log(t.currentView)}},{key:"insertContentInIframe",value:function(t,e){var n=document.createElement("iframe");n.style.width="100%",n.style.height="100%",n.style.border="none",n.style.display="block",t.innerHTML="",t.appendChild(n);var r=n.contentWindow.document;r.open(),r.write(e),r.close(),this.output_iframe=n,this.output_ifraome_content=e}},{key:"renderHTML",value:function(t){var e=t,n=this.output;this.insertContentInIframe(n,e)}},{key:"renderOutput",value:function(){switch(this.inputContentType){case"html":this.renderHTML(this.input.value);break;case"reveal":this.renderHTML(this.makeRevealJSFullPage(this.input.value));break;case"csv":case"tsv":case"semisv":case"ssv":var t=this.getContent(),e=",",n={tsv:",",semisv:";",ssv:" "};this.inputContentType in n&&(e=n[this.inputContentType]);var r=this.csvOrTsvToMarkdownTable(t,e);this.renderMarkdown(r);break;case"md":this.renderMarkdown();break;default:this.renderMarkdown(),console.log("Unsupported content type: ",this.inputContentType)}}},{key:"copySource",value:(e=n(c().mark((function t(){var e,n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=this.controls.querySelector(".copy-src-button")).textContent="Copying...",t.prev=2,n=this.getMarkdownSource(),t.prev=4,t.next=7,navigator.clipboard.writeText(n);case 7:t.next=18;break;case 9:t.prev=9,t.t0=t.catch(4),(r=document.createElement("textarea")).value=n,r.style.position="fixed",r.style.opacity="0",document.body.appendChild(r),r.select(),document.body.removeChild(r);case 18:e.textContent="Copied!",t.next=25;break;case 21:t.prev=21,t.t1=t.catch(2),console.error("Copy Markdown failed:",t.t1),e.textContent="Copy failed";case 25:setTimeout((function(){e.textContent="Copy Source"}),2e3);case 26:case"end":return t.stop()}}),t,this,[[2,21],[4,9]])}))),function(){return e.apply(this,arguments)})},{key:"copyHTML",value:(t=n(c().mark((function t(){var e,n,r,o,a,s,l,u,d,h,p,f=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=this.controls.querySelector(".copy-html-button")).textContent="Copying...",t.prev=2,n=this.output.querySelector('div[contenteditable="true"]')){t.next=6;break}throw new Error("Content div not found");case 6:(r=n.cloneNode(!0)).querySelectorAll("pre code").forEach((function(t){var e=t.innerHTML,n=document.createElement("table");n.style.width="100%",n.style.borderCollapse="collapse",n.style.border="none";var r=document.createElement("tr"),i=document.createElement("td");i.style.backgroundColor="#f7f7f7",i.style.padding="12px",i.style.fontFamily='Consolas, Monaco, "Courier New", monospace',i.style.whiteSpace="pre",i.style.border="none",i.innerHTML=e.trim(),r.appendChild(i),n.appendChild(r),t.parentNode.replaceWith(n)})),o=r.querySelectorAll("svg"),a=i(o),t.prev=10,l=c().mark((function t(){var e,n,r,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=s.value,t.prev=1,t.next=4,f.svgToPng(e);case 4:return n=t.sent,t.next=7,new Promise((function(t){var e=new FileReader;e.onloadend=function(){return t(e.result)},e.readAsDataURL(n)}));case 7:r=t.sent,(i=document.createElement("img")).src=r,i.width=e.clientWidth||e.viewBox.baseVal.width||100,i.height=e.clientHeight||e.viewBox.baseVal.height||100,i.setAttribute("v:shapes","image"+Math.random().toString(36).substr(2,9)),i.style.width=i.width+"px",i.style.height=i.height+"px",i.alt="Converted diagram",e.parentNode.replaceChild(i,e),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(1),console.error("Failed to convert SVG:",t.t0);case 22:case"end":return t.stop()}}),t,null,[[1,19]])})),a.s();case 13:if((s=a.n()).done){t.next=17;break}return t.delegateYield(l(),"t0",15);case 15:t.next=13;break;case 17:t.next=22;break;case 19:t.prev=19,t.t1=t.catch(10),a.e(t.t1);case 22:return t.prev=22,a.f(),t.finish(22);case 25:if(u='\n          <html xmlns:v="urn:schemas-microsoft-com:vml"\n                xmlns:o="urn:schemas-microsoft-com:office:office"\n                xmlns:w="urn:schemas-microsoft-com:office:word">\n            <head>\n              <meta charset="utf-8">\n              <style>\n                table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }\n                th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n                th { background-color: #f0f0f0; font-weight: bold; }\n\n                /* Code block styling */\n                .hljs { display: block; overflow-x: auto; padding: 1em; }\n                .hljs-keyword { color: #0033B3; }\n                .hljs-string { color: #067D17; }\n                .hljs-comment { color: #8C8C8C; }\n                .hljs-function { color: #00627A; }\n                .hljs-number { color: #1750EB; }\n                .hljs-operator { color: #687687; }\n                .hljs-punctuation { color: #000000; }\n\n                /* Word-specific image handling */\n                img { display: block; max-width: none; }\n              </style>\n            </head>\n            <body>\n              '.concat(r.innerHTML,"\n            </body>\n          </html>"),"macos"!==this.getPlatform()){t.next=39;break}return t.prev=28,t.next=31,navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([u],{type:"text/html"}),"text/plain":new Blob([r.innerText],{type:"text/plain"})})]);case 31:t.next=37;break;case 33:if(t.prev=33,t.t2=t.catch(28),this.copyToClipboard(u)){t.next=37;break}throw new Error("Fallback copy failed");case 37:t.next=63;break;case 39:return(d=document.createElement("div")).style.position="fixed",d.style.left="-9999px",d.style.top="0",d.innerHTML=u,document.body.appendChild(d),t.prev=45,t.next=48,navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([u],{type:"text/html"}),"text/plain":new Blob([r.innerText],{type:"text/plain"})})]);case 48:t.next=60;break;case 50:if(t.prev=50,t.t3=t.catch(45),h=window.getSelection(),(p=document.createRange()).selectNodeContents(d),h.removeAllRanges(),h.addRange(p),document.execCommand("copy")){t.next=60;break}throw new Error("Fallback copy failed");case 60:return t.prev=60,d&&d.parentNode&&document.body.removeChild(d),t.finish(60);case 63:e.textContent="Copied!",t.next=70;break;case 66:t.prev=66,t.t4=t.catch(2),console.error("Copy HTML failed:",t.t4),e.textContent="Copy failed";case 70:setTimeout((function(){e.textContent="Copy Formatted"}),2e3);case 71:case"end":return t.stop()}}),t,this,[[2,66],[10,19,22,25],[28,33],[45,50,60,63]])}))),function(){return t.apply(this,arguments)})},{key:"copyToClipboard",value:function(t){var e,n;try{(e=document.createElement("textarea")).setAttribute("readonly",!0),e.setAttribute("contenteditable",!0),e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.opacity="0",e.value=t,document.body.appendChild(e),e.focus(),e.select();var r=document.createRange();r.selectNodeContents(e);var i=window.getSelection();i.removeAllRanges(),i.addRange(r),e.setSelectionRange(0,e.value.length),n=document.execCommand("copy")}catch(t){console.error(t),n=null}finally{e&&e.parentNode&&document.body.removeChild(e)}if(!n){var o=navigator.platform.toUpperCase().indexOf("MAC")>=0;if(!(n=prompt("Press ".concat(o?"⌘C":"CTRL+C"),t)))return!1}return!0}},{key:"getPlatform",value:function(){var t=navigator.platform.toLowerCase(),e=navigator.userAgent.toLowerCase();return t.includes("mac")||e.includes("mac")?"macos":e.includes("windows")?"windows":e.includes("linux")?"linux":"unknown"}},{key:"makeHTMLPageFromDiv",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?'contenteditable="true"':"",n='<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>Markdown Viewer with Graphics Support</title>\n  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">\n  <xscripx src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></xscripx>\n  <xscripx src="https://unpkg.com/mermaid/dist/mermaid.min.js"></xscripx>\n  <style>\n      body {\n          font-family: Arial, sans-serif;\n          box-sizing: border-box;\n          padding: 20px;\n      }\n      .squibview-output {\n          width: 50%;\n          margin: auto;\n      }\n      pre {\n          background-color: #f4f4f4;\n          padding: 10px;\n          border-radius: 5px;\n          overflow-x: auto;\n      }\n      table {\n          width: 100%;\n          border-collapse: collapse;\n          margin: 20px 0;\n      }\n      table, th, td {\n          border: 1px solid black;\n      }\n      th, td {\n          padding: 8px;\n          text-align: left;\n      }\n  </style>\n</head>\n<body '.concat(e,">\n  ").concat(t,"\n</body>\n</html>");return n=n.replaceAll("xscripx","script"),console.log(e),n}},{key:"makeRevealJSFullPage",value:function(t){return'<!DOCTYPE html>\n  <html lang="en">\n  <head>\n      <meta charset="utf-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>'.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Slide Presentation",'</title>\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.css">\n      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js/dist/theme/black.css">\n      <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"><\/script>\n  </head>\n  <body>\n      <div class="reveal" contenteditable="true">\n          <div class="slides">\n              ').concat(t.split("---").map((function(t){return'<section data-markdown><script type="text/template">'.concat(t.trim(),"<\/script></section>")})).join("\n"),"\n          </div>\n      </div>\n      <script src=\"https://cdn.jsdelivr.net/npm/reveal.js/dist/reveal.js\"><\/script>\n      <script src=\"https://cdn.jsdelivr.net/npm/reveal.js/plugin/markdown/markdown.js\"><\/script>\n      <script>\n          Reveal.initialize({\n              plugins: [ RevealMarkdown ]\n          });\n          \n          // Ensure Mermaid diagrams initialize correctly\n          document.addEventListener('DOMContentLoaded', () => {\n              mermaid.initialize({ startOnLoad: true , securityLevel: 'loose', theme: 'dark' });\n              document.querySelectorAll('.mermaid').forEach(el => {\n                  el.innerHTML = el.textContent;\n                  mermaid.init(undefined, el);\n              });\n          });\n      <\/script>\n  </body>\n  </html>")}},{key:"csvOrTsvToMarkdownTable",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=Papa.parse(t,{delimiter:e,skipEmptyLines:!0}).data;if(0===n.length)return"No data found.";var r="| ".concat(n[0].join(" | ")," |"),i="| ".concat(n[0].map((function(){return"---"})).join(" | ")," |"),o=n.slice(1).map((function(t){return"| ".concat(t.join(" | ")," |")})).join("\n");return"".concat(r,"\n").concat(i,"\n").concat(o)}}]);var t,e,o,a}();return o(u,"defaultOptions",{initialContent:"",inputContentType:"md",showControls:!0,titleShow:!1,titleContent:"",initialView:"split",baseClass:"squibview",show_md_buttons:!0}),o(u,"version",{version:"0.0.27",url:"https://github.com/deftio/squibview"}),u}));
//# sourceMappingURL=squibview.umd.min.js.map
