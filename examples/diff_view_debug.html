<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SquibView - Inline Diff Debug</title>  
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><circle cx='16' cy='16' r='14' fill='%23f57c00' stroke='%23000' stroke-width='1'/><path d='M2 16h28M16 2a14 14 0 0114 14 14 14 0 01-14 14a14 14 0 01-14-14A14 14 0 0116 2zm0 0v28M9 16a7 7 0 0014 0a7 7 0 00-14 0z' fill='none' stroke='%23000' stroke-width='1'/></svg>">

  <link rel="stylesheet" href="../dist/squibview.css">

  <!-- External libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .editor-container {
      height: 200px;
      margin: 20px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .controls {
      margin: 20px 0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    button {
      background: #2a57d3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    button:hover {
      background: #1e3f8f;
    }
    
    .output {
      margin: 20px 0;
      padding: 20px;
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
    }
    
    .output h3 {
      margin-top: 0;
    }
    
    .diff-output {
      margin: 10px 0;
      padding: 10px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      max-height: 300px;
      overflow: auto;
    }
    
    .debug-output {
      margin: 10px 0;
      padding: 10px;
      background: #2d3748;
      color: #e2e8f0;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 200px;
      overflow: auto;
    }
    
    /* Test the inline diff classes directly */
    .test-inline-added {
      background-color: #cfe2ff;
      color: #004085;
      padding: 0.1em 0.2em;
      border-radius: 3px;
      font-weight: 500;
    }
    
    .test-inline-removed {
      background-color: #f8d7da;
      color: #721c24;
      padding: 0.1em 0.2em;
      border-radius: 3px;
      text-decoration: line-through;
      font-weight: 500;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>SquibView Inline Diff Debug</h1>
    <div id="version-info" style="background: #e8edff; padding: 10px; border-radius: 4px; margin: 10px 0;">
      Loading version info...
    </div>
    
    <h2>Editor</h2>
    <div class="editor-container">
      <div id="editor"></div>
    </div>
    
    <div class="controls">
      <button id="makeChange">Make Simple Change</button>
      <button id="showInlineDiff">Show Inline Diff</button>
      <button id="showSideBySide">Show Side-by-Side</button>
      <button id="clearAll">Clear All</button>
    </div>
    
    <div class="output">
      <h3>CSS Class Test</h3>
      <p>This text has <span class="test-inline-added">blue additions</span> and <span class="test-inline-removed">red deletions</span>.</p>
      <p>Using SquibView classes: <span class="diff-inline-added">blue addition</span> and <span class="diff-inline-removed">red deletion</span>.</p>
    </div>
    
    <div class="output">
      <h3>Inline Diff Output</h3>
      <div id="inlineDiff" class="diff-output"></div>
      <h4>Debug HTML:</h4>
      <div id="inlineDebug" class="debug-output"></div>
    </div>
    
    <div class="output">
      <h3>Side-by-Side Diff Output</h3>
      <div id="sideBySideDiff" class="diff-output"></div>
    </div>
  </div>

  <script type="module">
    // Fix global variable name mapping
    if (typeof window.markdownit !== 'undefined') {
      window.MarkdownIt = window.markdownit;
    }
    
    // Load SquibView
    const script = document.createElement('script');
    script.src = '../dist/squibview.umd.min.js';
    script.onload = function() {
      initializeDebug();
    };
    document.head.appendChild(script);
    
    function initializeDebug() {
      // Display version info
      document.getElementById('version-info').innerHTML = 
        `SquibView Version: ${SquibView.version.version} | Repository: <a href="${SquibView.version.url}" target="_blank">${SquibView.version.url}</a>`;
      
      // Create editor
      const editor = new SquibView('#editor', {
        initialContent: 'This is the original text.',
        initialView: 'src'
      });
      
      // Make change button
      document.getElementById('makeChange').addEventListener('click', () => {
        editor.setContent('This is the modified text with changes.');
        alert('Content changed! Now click "Show Inline Diff" to see the diff.');
      });
      
      // Show inline diff
      document.getElementById('showInlineDiff').addEventListener('click', () => {
        try {
          const inlineDiffHTML = editor.getSourceDiffInline();
          document.getElementById('inlineDiff').innerHTML = inlineDiffHTML;
          
          // Show debug info
          document.getElementById('inlineDebug').textContent = inlineDiffHTML;
          
          // Log to console
          console.log('Inline Diff HTML:', inlineDiffHTML);
          
          // Check if the method exists
          console.log('getSourceDiffInline exists:', typeof editor.getSourceDiffInline === 'function');
          
          // Get the diff data
          const diffData = editor.getSourceDiff();
          console.log('Diff Data:', diffData);
          
        } catch (e) {
          document.getElementById('inlineDiff').innerHTML = `<div style="color: red;">Error: ${e.message}</div>`;
          document.getElementById('inlineDebug').textContent = `Error: ${e.message}\n\nStack: ${e.stack}`;
          console.error('Error:', e);
        }
      });
      
      // Show side-by-side diff
      document.getElementById('showSideBySide').addEventListener('click', () => {
        try {
          const sideBySideHTML = editor.getSourceDiffHTML();
          document.getElementById('sideBySideDiff').innerHTML = sideBySideHTML;
        } catch (e) {
          document.getElementById('sideBySideDiff').innerHTML = `<div style="color: red;">Error: ${e.message}</div>`;
          console.error('Error:', e);
        }
      });
      
      // Clear all
      document.getElementById('clearAll').addEventListener('click', () => {
        document.getElementById('inlineDiff').innerHTML = '';
        document.getElementById('inlineDebug').textContent = '';
        document.getElementById('sideBySideDiff').innerHTML = '';
      });
    }
  </script>
</body>
</html>