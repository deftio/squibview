<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SquibView UMD Clean Test</title>
  <link rel="stylesheet" href="../dist/squibview.css">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .test-container {
      margin-bottom: 40px;
    }
    
    h1 {
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 10px;
      color: #333;
    }
    
    h2 {
      font-size: 1.3rem;
      margin-top: 30px;
      color: #555;
    }
    
    .editor-container {
      height: 400px;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
      margin-top: 20px;
    }
    
    .info {
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      margin: 20px 0;
      font-size: 15px;
      line-height: 1.5;
    }
    
    .version {
      font-family: monospace;
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 4px;
    }
    
    pre {
      background-color: #f5f5f5;
      padding: 12px;
      border-radius: 6px;
      overflow: auto;
      font-size: 14px;
    }
    
    button {
      padding: 8px 16px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      margin-right: 8px;
      margin-top: 10px;
    }
    
    button:hover {
      background: #3b78e7;
    }
  </style>
</head>
<body>
  <h1>SquibView UMD Clean Test</h1>
  
  <div class="info">
    This page tests SquibView UMD build with improved configuration that doesn't require any hacks.
    <div id="version-info"></div>
  </div>
  
  <div class="test-container">
    <h2>Editor Test</h2>
    <div id="editor" class="editor-container"></div>
    
    <button id="btn-source">Source View</button>
    <button id="btn-rendered">Rendered View</button>
    <button id="btn-split">Split View</button>
  </div>
  
  <div class="test-container">
    <h2>UMD Access Test</h2>
    <pre id="test-results"></pre>
    <button id="btn-test">Run Tests</button>
  </div>
  
  <!-- Load dependencies first -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.3.2/markdown-it.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
  <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
  
  <!-- Load SquibView UMD build directly - no hacks needed with proper configuration -->
  <script src="../dist/squibview.umd.min.js"></script>
  
  <script>
    // Test accessing SquibView directly
    document.addEventListener('DOMContentLoaded', function() {
      // SquibView should be available directly as a global variable
      if (typeof SquibView !== 'function') {
        document.getElementById('version-info').innerHTML = 
          '<span style="color:red;font-weight:bold">Error: SquibView not available as a function</span>';
      } else {
        document.getElementById('version-info').innerHTML = 
          'SquibView version: <span class="version">' + SquibView.version.version + '</span>';
      }
      
      // Initialize the editor
      try {
        const editor = new SquibView('#editor', {
          titleShow: true,
          titleContent: 'SquibView UMD Test Editor',
          showControls: true,
          initialView: 'split'
        });
        
        // Make editor globally available for console testing
        window.editor = editor;
        
        // Set initial content
        editor.setContent('# SquibView UMD Test\n\nThis is a test of the clean UMD build.\n\n## Features\n\n- No hacks needed\n- Proper UMD configuration\n- Works directly with script tags\n\n```javascript\nconst editor = new SquibView("#editor");\n```\n\n> This should render correctly as a blockquote', 'md');
        
        // Set up buttons
        document.getElementById('btn-source').addEventListener('click', function() {
          editor.setView('src');
        });
        
        document.getElementById('btn-rendered').addEventListener('click', function() {
          editor.setView('html');
        });
        
        document.getElementById('btn-split').addEventListener('click', function() {
          editor.setView('split');
        });
        
        // Set up test button
        document.getElementById('btn-test').addEventListener('click', function() {
          const results = [];
          
          // Test 1: SquibView is a constructor
          results.push('SquibView is a constructor: ' + (typeof SquibView === 'function'));
          
          // Test 2: SquibView.version exists and is accessible
          results.push('SquibView.version exists: ' + (typeof SquibView.version === 'object'));
          
          // Test 3: Editor instance methods are accessible
          results.push('editor.setContent is a function: ' + (typeof editor.setContent === 'function'));
          
          // Test 4: Check if editor API works
          try {
            editor.setContent('Test content changed by API', 'md');
            results.push('setContent API works: true');
            
            // Get content back
            const content = editor.getContent();
            results.push('getContent returns valid content: ' + (content.includes('Test content changed by API')));
            
            // Restore original content
            editor.setContent('# SquibView UMD Test\n\nTest completed successfully!', 'md');
          } catch(e) {
            results.push('API test error: ' + e.message);
          }
          
          // Display results
          document.getElementById('test-results').textContent = results.join('\n');
        });
        
      } catch(e) {
        console.error('Error initializing editor:', e);
        document.getElementById('editor').innerHTML = 
          '<div style="color:red;padding:20px;">Error initializing editor: ' + e.message + '</div>';
      }
    });
  </script>
</body>
</html>